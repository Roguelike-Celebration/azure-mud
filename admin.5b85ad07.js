require("./admin.8b47f750.js");var e=require("react"),t=m(e),{createElement:o,useEffect:a,createContext:n,useRef:r,useContext:i}=e,{render:l}=require("react-dom"),d=m(require("react-ace"));require("ace-builds/src-noconflict/mode-json"),require("ace-builds/src-noconflict/theme-solarized_dark"),require("ace-builds/src-noconflict/ext-language_tools");var s=m(require("firebase/app")),c=m(require("react-firebaseui/StyledFirebaseAuth"));require("firebase/auth");var u=m(require("lodash"));function m(e){return e&&e.__esModule?e.default:e}var g="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},p={},f={},h=g.parcelRequire4f3a;null==h&&((h=function(e){if(e in p)return p[e].exports;if(e in f){let t=f[e];delete f[e];let o={id:e,exports:{}};return p[e]=o,t.call(o.exports,o,o.exports),o.exports}var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}).register=function(e,t){f[e]=t},g.parcelRequire4f3a=h);var y,R,E=h("3CjRg"),I=h("5K3Zs"),b=h("Fqklz");(R=y||(y={})).LoggedIn="LOGGED_IN",R.UpdateRoomIds="UPDATE_ROOM_IDS",R.UpdateAndShowRoom="UPDATE_AND_SHOW_ROOM";const w=(e,t)=>({type:y.UpdateAndShowRoom,value:{roomId:e,roomData:t}}),v={firebaseApp:s.initializeApp(b.default.FIREBASE_CONFIG),isLoggedIn:!1,roomData:{}};var k=(e,t)=>{const o=JSON.parse(JSON.stringify(e));return t.type===y.LoggedIn&&(o.isLoggedIn=!0),t.type===y.UpdateRoomIds&&(o.roomIds=t.value),t.type===y.UpdateAndShowRoom&&(o.roomData[t.value.roomId]=t.value.roomData,o.displayedRoomId=t.value.roomId),o},D=h("3Evbi");E=h("3CjRg");const A={callbacks:{signInSuccessWithAuthResult:function(e,t){const o=E.currentUser();return o.shouldVerifyEmail&&E.sendSignInLinkToEmail(o.email),window.location.reload(),!1}},signInOptions:[s.auth.EmailAuthProvider.PROVIDER_ID,s.auth.GoogleAuthProvider.PROVIDER_ID,s.auth.TwitterAuthProvider.PROVIDER_ID]};function O(){return t.createElement("div",null,t.createElement("header",{role:"banner"},t.createElement("h1",null,"Welcome to the secret Roguelike Celebration backstage area!")),t.createElement("main",{role:"main"},t.createElement("p",null,"If you're not a Roguelike Celebration admin, this isn't for you. If you should be an admin, but can't log in, ask in our other chat."),t.createElement(c,{uiConfig:A,firebaseAuth:s.auth()})))}I=h("5K3Zs");function S(e){const o=i(_),a=u.sortBy(e.roomIds||[]),n=async e=>{const t=e.target&&e.target.getAttribute&&e.target.getAttribute("data-room");if(t){const e=await I.getRoom(t);console.log("got room data",t,e),o(w(t,e))}};return t.createElement("ul",{id:"room-list"},a.map((e=>t.createElement("li",{key:`room-button-${e}`},t.createElement("button",{"data-room":e,className:"nav-item",onClick:n},e)))),t.createElement("button",{onClick:async()=>{confirm("Are you sure you'd like to reset room data?")&&(await I.resetRoomData(),await I.getAllRooms())},style:{marginTop:"1em"}},"Reset Room Data to Disk Copy"),t.createElement("button",{onClick:async()=>{const e=await I.getAllRooms(),t=JSON.stringify(e,null,2);var o=document.createElement("a"),a=new Blob([t],{type:"application/json"});o.href=URL.createObjectURL(a),o.download="roomData.json",o.click()},style:{marginTop:"1em",display:"block"}},"Download Local JSON"))}I=h("5K3Zs");function C(e){return t.createElement("div",{id:"room-options-view"},t.createElement("button",{onClick:async()=>{const t=prompt("What would you like the room to be called?");t&&await e.createRoom(t)}},"Create"),t.createElement("button",{onClick:async()=>{confirm("Are you SURE you want to delete this? This will delete it from the server memory, and you will only be able to restore it if it is saved on disk.")&&await I.deleteRoom(e.roomId)}},"Delete"),t.createElement("button",{onClick:()=>{e.updateRoom()}},"Save"))}const _=n(null);var L=function(){const e=r(null),[o,n]=D.useReducerWithThunk(k,v);console.log("In app",o),a((()=>{E.onAuthenticationStateChange((async e=>{if(!e||e.shouldVerifyEmail)return;const{isMod:t,isBanned:o}=await I.checkIsRegistered();t&&!o?n({type:y.LoggedIn,value:void 0}):(alert("You shouldn't have access to this page."),await E.signOut(),window.location.reload())}))}),[]),a((()=>{o.isLoggedIn&&(async()=>{const e=await I.getRoomIds();n((e=>({type:y.UpdateRoomIds,value:e}))(e))})()}),[o.isLoggedIn]);return o.isLoggedIn?t.createElement(_.Provider,{value:n},t.createElement("div",null,t.createElement("h1",null,"Room Editor: ",o.displayedRoomId||"no room selected"),t.createElement(C,{roomId:o.displayedRoomId,updateRoom:()=>{const t=e.current.editor.getValue();I.updateRoom(o.displayedRoomId,JSON.parse(t))},createRoom:e=>{n(w(e,{displayName:e,shortName:e,id:e,description:""}))}}),t.createElement(S,{roomIds:o.roomIds}),t.createElement(d,{mode:"json",theme:"solarized_dark",name:"editor",editorProps:{$blockScrolling:!0},height:"100%",ref:e,value:JSON.stringify(o.roomData[o.displayedRoomId]||"",null,2),wrapEnabled:!0,width:"70vw"}))):t.createElement(O,null)};window.addEventListener("DOMContentLoaded",(async()=>{l(o(L,null),document.getElementById("root"))}));
//# sourceMappingURL=admin.5b85ad07.js.map

require("./admin.95153f0e.js"),require("./admin.5e70d957.css"),require("./stream.02c296a4.css");var e=require("react"),t=z(e),{createElement:a,createContext:n,useEffect:o,useRef:r,useState:l,useContext:i}=e,s=require("react-dom"),c=z(s),{render:d}=s,{IconContext:m}=require("react-icons/lib"),u=require("lodash"),h=z(u),{findLastIndex:p}=u,{FaChevronDown:g,FaChevronUp:y,FaVolumeUp:E,FaVideo:f,FaVolumeMute:v,FaUser:b,FaVideoSlash:w,FaCog:k,FaThumbsUp:I,FaRegThumbsUp:C}=require("react-icons/fa"),M=z(require("localforage")),{v4:S}=require("uuid"),{ContextMenu:A,MenuItem:T,ContextMenuTrigger:N}=require("react-contextmenu"),D=z(require("react-tooltip")),x=z(require("react-linkify")),{emojify:R}=require("node-emoji"),O=z(require("firebase/app")),W=z(require("react-firebaseui/StyledFirebaseAuth"));require("firebase/auth");var L=z(require("react-page-visibility")),{connect:F,createLocalVideoTrack:P,createLocalAudioTrack:H}=require("twilio-video"),{SpeechConfig:U,ResultReason:$,SpeechRecognizer:V,AudioConfig:Y,CancellationReason:B}=require("microsoft-cognitiveservices-speech-sdk");function z(e){return e&&e.__esModule?e.default:e}var _="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},q={},j={},G=_.parcelRequire4f3a;null==G&&((G=function(e){if(e in q)return q[e].exports;if(e in j){let t=j[e];delete j[e];let a={id:e,exports:{}};return q[e]=a,t.call(a.exports,a,a.exports),a.exports}var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}).register=function(e,t){j[e]=t},_.parcelRequire4f3a=G);var J=G("3Loy2"),Z=G("3Wbh2"),K=G("1qZWk");function X(e){return e.text&&("string"==typeof e.text||e.text instanceof String)&&e.roomId?"string"==typeof e.roomId||e.roomId instanceof String:!e.externalLink||("string"==typeof e.externalLink||e.externalLink instanceof String)}var Q,ee,te,ae;(ee=Q||(Q={})).Blue="Blue",ee.Cyan="Cyan",ee.Green="Green",ee.Magenta="Magenta",ee.Orange="Orange",ee.Red="Red",ee.Violet="Violet",ee.Yellow="Yellow",(ae=te||(te={})).Comic="Comic",ae.Classic="Classic",ae.Impactful="Impactful";Z=G("3Wbh2"),K=G("1qZWk");async function ne(e,t){await M.setItem(se,e),await M.setItem(ce,t||new Date)}async function oe(){return await M.getItem(me)||0}async function re(e){await M.setItem(ue,e)}async function le(){return await M.getItem(he)||"default"}async function ie(e){await M.setItem(ye,e)}const se="messages",ce="messageTimeStamp",de="whispers",me="FeatureRainbowGateVisited",ue="WasColoredEntering",he="UserSelectedTheme",pe="UseSimpleNames",ge="KeepCameraWhenMoving",ye="TextOnlyMode",Ee="CaptionsEnabled",fe=()=>{const e=t.useContext(wa);return t.createElement("div",{id:"rainbow-gate-div",className:"feature-room-view"},t.createElement("p",null,"Do you, in fact, approach the chair? ",t.createElement("button",{id:"rainbow-gate-button",className:"link-styled-button",onClick:async()=>{await async function(){const e=await oe()+1;return await M.setItem(me,e),e}();e(Z.UpdateProfileColorAction(function(e){const t=Object.values(e);return t[Math.floor(Math.random()*t.length)]}(Q))),e(Z.ShowModalAction(K.Modal.FeatureRainbowGate))}},"Approach the chair.")))};function ve(){const{userMap:e,myId:a}=i(ka),[n,r]=l(0);return o((()=>{(async()=>{r(await oe())})()}),[]),1===n?t.createElement("div",null,t.createElement("h1",null,"It's a miracle of modern science!"),t.createElement("p",null,"\"Oho! Why, you've arrived just in time for the most amazing experience you'll ever... experience! Just sit in this chair, pull that lever, and you'll in for a truly eye-opening journey. Why, it's a miracle of modern science!\""),t.createElement("p",null,"You sit in the chair (it's not especially comfortable and it's... slightly wet?) and pull the lever. There's a shudder as the machine rumbles to life and things start happening. Gears spin, lightning arcs up two metal trusses you hadn't noticed. Your hair begins to stand on end. The doctor (you didn't see any diplomas, so who's to say?) starts to cackle wildly, yelling, \"It works! It WORKS!\" to no one in particular. The machine's hum hits a crescendo when suddenly everything comes to a stop. All is silence. You wait for a moment when you hear a buzz above you."),t.createElement("p",null,'Looking up, you see a mechanical arm holding a bucket extend out and rotate, spilling a bucket of paint all over you. "Yes!" yells the doctor (?) "They said it couldn\'t be done! Now... if you\'ll excuse me, I need to clean the paint off the chair." They hold up a sponge and bucket of water and gesture at you to make yourself scarce.'),t.createElement("p",null,t.createElement("em",null,"Your chat name color is now ",t.createElement("span",{className:`name ${e[a].nameColor}`},e[a].nameColor)),".")):t.createElement("div",null,t.createElement("h1",null,"Back for more?"),t.createElement("p",null,'The ambiguously credentialed operator gives you a nod. "Back for more, huh? Er, wait, no. I mean... *ahem* So! You\'ve returned for another glimpse at the uncanny realities beyond human perception! Well sit right down and pull yon lever, my friend." They floridly gesture to the chair at the center of the paint-dumping apparatus.'),t.createElement("p",null,'You pull the lever and nothing appears to happen. Then the machine operator runs up with a bucket of paint and spills it all over you. "So sorry, we only have the aetheric budget to do the big show once per person. Grant writing, am I right?" They look you over. "You know, you don\'t look that different to me, but what do I know?" They tap the multi-lensed googles obscuring most of their face. "With these things on it\'s a wonder I can see at all. Everything is coming through like an original Game Boy screen."'),t.createElement("p",null,t.createElement("em",null,"Your chat name color is now ",t.createElement("span",{className:`name ${e[a].nameColor}`},e[a].nameColor)),"."))}Z=G("3Wbh2"),K=G("1qZWk");const be=()=>{const e=t.useContext(wa),{userMap:a,myId:n}=i(ka),o=a[n];return t.createElement("div",{id:"dull-door-div",className:"feature-room-view"},t.createElement("p",null,'Inside the glass tube there\'s nothing in particular, though you note that there\'s a grate on the floor. A damp sign next to the tube\'s opening says "Secondarily-Hydrogenated Oxygen Weighted Emulsion Remover". A smaller sign below that reads "For Dirts, Dyes, and Distress!" ',t.createElement("button",{id:"dull-door-button",className:"link-styled-button",onClick:()=>{o.nameColor?re(!0):re(!1),e(Z.ShowModalAction(K.Modal.FeatureDullDoor))}},"Step on the grate"),"."))};function we(){const e=t.useContext(wa),[a,n]=l(!1);o((()=>{(async()=>{n(await async function(){return await M.getItem(ue)||!1}())})()}),[]);return a?t.createElement("div",null,t.createElement("h1",null,"Could be refreshing?"),t.createElement("p",null,"You tentatively press a toe onto the grate. Suddenly the machine gurgles and from openings the top of the tube, warm Secondarily-Hydrogenated Oxygen (miracle of the modern age!) streams down! It certainly seems like any Dirts, Dyes, or Distress you may have accrued will be washed away if you step in fully. It'll probably be refreshing, but it will ",t.createElement("em",null,"definitely")," take the paint from the doctor(?) with it."),t.createElement("p",null,t.createElement("strong",null,"Fully enter the S.H.O.W.E.R.?")),t.createElement("button",{id:"dull-door-agree",onClick:()=>{e(Z.UpdateProfileColorAction(null)),e(Z.HideModalAction())}},"Enter"),t.createElement("button",{id:"dull-door-agree",onClick:()=>{e(Z.HideModalAction())}},"Leave")):t.createElement("div",null,t.createElement("h1",null,"Refreshing!"),t.createElement("p",null,"As you step into the tube, the grating beneath you depresses and clicks. Suddenly the machine gurgles and from openings the top of the tube, warm Secondarily-Hydrogenated Oxygen (miracle of the modern age!) streams down on you and rinses any Dirts, Dyes, or Distress you may have accrued away. It's soothing, in its own odd way, but you aren't sure this so-called S.H.O.W.E.R. will catch on with the masses."))}Z=G("3Wbh2"),K=G("1qZWk");const ke=()=>{const e=t.useContext(wa);return t.createElement("div",{id:"full-room-index-div",className:"feature-room-view"},t.createElement("button",{id:"full-room-index-button",onClick:()=>{e(Z.ShowModalAction(K.Modal.FeatureFullRoomIndex))}},"Read the book"))};function Ie(e){return t.createElement("div",null,t.createElement("h1",null,"Unerring Teleport"),t.createElement("p",null,"Verbal elements - either the True Name of the destination, the two common names of the destination, or the name of the destination from an adjoining location (which can only be known from that destination, and is colored in green for whatever reason). The name must exact, but the volume of the incantation is irrelevant."),t.createElement("p",null,"Somatic elements - /go or /move"),t.createElement("p",null,"Material components - none"),t.createElement("p",null,"This spell will take you to whichever place you wish, hidden or not. The only issue is that the names of the hidden places are obscured by dark magics. I, the Great Wizard Teleportus, have researched long and hard, and at last produced a complete list of all the room in this space. Bow before my awesome intelligence!"),t.createElement("p",null,"Examples:"),t.createElement("ul",null,t.createElement("li",{key:"example-0"},t.createElement("em",null,"/go hiddenPortalRoom")," utilizes the true name to return here"),t.createElement("li",{key:"example-1"},t.createElement("em",null,"/move leap into the shimmering portal")," utilizes the name of the destination ('leap into the shimmering portal') from the adjacent room (here)"),t.createElement("li",{key:"example-2"},t.createElement("em",null,"/move Unconferencing: Sokoban")," utilizes the first common name"),t.createElement("li",{key:"example-3"},t.createElement("em",null,"/go the artists' atelier")," utilizes the second common name")),t.createElement("table",null,t.createElement("tbody",null,t.createElement("tr",null,t.createElement("th",{key:"common-1-header"},"common (first)"),t.createElement("th",{key:"common-2-header"},"common (second)"),t.createElement("th",{key:"true-header"},"true")),e.rooms.map((e=>t.createElement("tr",{key:e.id},t.createElement("td",{key:`common-1-${e.id}`},e.displayName),t.createElement("td",{key:`common-2-${e.id}`},e.shortName),t.createElement("td",{key:`true-${e.id}`},e.id)))))))}J=G("3Loy2");const Ce={generateFood:()=>{J.pickUpRandomItemFromList("vendingMachineFood")},pickUpPuppy:()=>{J.pickUpItem("a tiny puppy")},drinkPolymorph:()=>{J.sendChatMessage(S(),"/get colourful potion")},drinkCancellation:()=>{J.sendChatMessage(S(),"/get clear potion")},getFortune:()=>{J.sendChatMessage(S(),"/get fortune cookie")},readPoster:()=>{J.displayMessageFromList("motivationPosters")},readClosedSign:()=>{J.displayMessageFromList("closedSigns")},getGameRec:()=>{J.displayMessageFromList("gameRecommendations")},pentagramHighTech:()=>{Me("Impactful")},pentagramMinimalist:()=>{Me("Classic")},pentagramComical:()=>{Me("Comic")},pentagramNormal:()=>{Me("")},hearPickupLine:()=>{J.displayMessageFromList("pickupLines")},watchRobot:()=>{J.displayMessageFromList("robots")}},Me=function(e){J.updateFontReward(S(),e),J.sendChatMessage(S(),"/go ASCII"),J.displayMessage("You feel changed by your journey through the pentagram...")},Se=e=>{throw Error("Not Implemented")},Ae=t.createContext({prepareForMediaChat:async()=>console.log("Not implemented"),prepareMediaDevices:async()=>console.log("Not implemented"),publishMedia:()=>console.log("Not implemented"),publishAudio:()=>console.log("Not implemented"),unpublishMedia:()=>console.log("Not implemented"),publishingCamera:!1,publishingMic:!1,cameras:[],mics:[],setCurrentCamera:Se,setCurrentMic:Se,currentMic:void 0,currentCamera:void 0,localStreamView:t.createElement("div"),inCall:!1,joinCallFailed:!1,joinCall:Se,leaveCall:()=>console.log("Not implemented"),callParticipants:void 0,cameraEnabled:!1,micEnabled:!1,setCameraEnabled:e=>console.log("Not implemented"),setMicEnabled:e=>console.log("Not implemented")}),Te=()=>i(Ae);J=G("3Loy2");var Ne=()=>{const{userMap:e,myId:a}=i(ka),n=e[a];return n.item?t.createElement("span",null,"You are holding ",n.item,"."," ",t.createElement("button",{className:"link-styled-button",onClick:()=>{J.dropItem()}},"Drop it"),"."):null};Z=G("3Wbh2"),J=G("3Loy2");function De(e){const a=i(wa),{useSimpleNames:n}=i(Ia),{userMap:o,myId:r}=i(ka),l=o[e.userId],s=l&&l.username,c=l&&l.isMod,d=l&&l.isBanned,m=o[r],u=m&&m.isMod,h=(e,t)=>{a(Z.HideModalAction()),J.fetchProfile(t.id)},p=u?t.createElement(T,{data:{id:e.userId,username:s},onClick:(e,t)=>{confirm(`Are you sure you would like to ${d?"unban":"ban"} the user '${t.username}'?`)&&a(Z.BanToggleAction(t.id))}},d?"Unban":"Ban"):"",g=u?t.createElement(T,{data:{id:e.userId,username:s},onClick:(e,t)=>{confirm(`Are you sure you would like to ${c?"remove":"add"} the user '${t.username}' ${c?"from":"to"} the mod list?`)&&a(Z.ModToggleAction(t.id))}},c?"Remove Mod":"Make Mod"):"";var y="name";!n&&l&&l.nameColor&&(y=y+" "+l.nameColor),!n&&l&&l.fontReward&&(y=y+" font-"+l.fontReward);const E={whiteSpace:e.nowrap?"nowrap":void 0};return t.createElement("span",{className:y,"data-tip":l&&l.pronouns,style:E},t.createElement(N,{id:e.id,renderTag:"span",holdToDisplay:0},t.createElement("strong",{className:c?"mod":""},c?"[Mod] ":"",!n&&l&&l.polymorph||"",s||"unknown")),t.createElement(A,{id:e.id},t.createElement(T,{data:{id:e.userId},onClick:h},"Profile"),t.createElement(T,{data:{id:e.userId},onClick:h},"Whisper"),p,g),t.createElement(D,null))}var xe=e=>{const{userMap:a}=t.useContext(ka);let{users:n,userId:o}=e;const{callParticipants:r}=Te();let l,i;if(r){const e=Array.from(r.values());l=e.filter((e=>e.audioTracks.size>0)).map((e=>e.identity)),i=e.filter((e=>e.videoTracks.size>0)).map((e=>e.identity))}if(n&&o&&(n=n.filter((e=>e!==o))),n){let o;if(0===n.length)return t.createElement("div",{id:"dynamic-room-description"},"You are all alone here. ",t.createElement(Ne,null));if("theater"===e.roomId)return t.createElement("div",{id:"dynamic-room-description"},"There are ",n.length," other people sitting in here.");const r=n.map(((e,n)=>{const o=a[e];if(!o)return t.createElement("span",null);const r=`presence-${n}`;return t.createElement("span",{key:`room-presence-${r}`},t.createElement(De,{userId:e,id:r,key:r}),l&&l.includes(o.id)?t.createElement(E,{className:"has-audio"}):null,i&&i.includes(o.id)?t.createElement(f,{className:"has-video"}):null,o.item?` (holding ${o.item})`:null)}));return o=1===n.length?r[0]:2===n.length?t.createElement("span",null,r[0]," and ",r[1]):t.createElement("span",null,(s=r.slice(0,n.length-1),c=", ",0===s.length?[]:s.slice(1).reduce((function(e,t,a){return e.concat([c,t])}),[s[0]])),", and"," ",r[r.length-1]),t.createElement("div",{id:"dynamic-room-description"},"Also here ",1===n.length?"is":"are"," ",o,". ",t.createElement(Ne,null))}return t.createElement("div",{id:"dynamic-room-description"});var s,c};function Re(e){const t=i(wa),{prepareForMediaChat:n,joinCall:r,unpublishMedia:s}=Te(),{room:c}=e,[d,m]=l(!0);o((()=>{c&&c.mediaChat&&!e.textOnlyMode&&e.hasDismissedAModal&&(e.keepCameraWhenMoving||u(),n(),r(e.room.id,e.keepCameraWhenMoving))}),[e.room.id,e.hasDismissedAModal]);const u=()=>{t(Z.StopVideoChatAction()),s()},h=()=>{t(Z.ShowModalAction(K.Modal.NoteWall))};let p;return c&&c.hasNoteWall&&(p=c.noteWallData?a("div",null,c.noteWallData.roomWallDescription," ",a("button",{onClick:h},c.noteWallData.noteWallButton)):a("div",null,"One of the walls has space for attendees to put up sticky notes."," ",a("button",{onClick:h},"View note wall"))),console.log("ROOM",JSON.stringify(c,null,2)),a("div",{id:"room"},a("h1",{id:"room-name"},c?c.displayName:"Loading...",a("button",{type:"button",id:"room-collapse-button",className:"link-styled-button",onClick:e=>{m(!d)}},d?a("span",null,"Hide Description ",a(y,null)):a("span",null,"Show Description ",a(g,null)))),a("div",{id:"full-room-description",className:d?"":"collapsed"},a("div",{id:"static-room-description",onClick:e=>{const t=e.target&&e.target.getAttribute&&e.target.getAttribute("data-room");if(t)return void J.moveToRoom(t);const a=e.target&&e.target.getAttribute&&e.target.getAttribute("data-item");a&&J.pickUpItem(a);const n=e.target&&e.target.getAttribute&&e.target.getAttribute("data-action");n&&Ce[n]()},dangerouslySetInnerHTML:{__html:c?Oe(c.description,e.roomData):"Loading current room..."}}),c&&"theater"===c.id?a(We,null):null,c&&c.specialFeatures&&c.specialFeatures.includes("RAINBOW_DOOR")?a(fe,null):"",c&&c.specialFeatures&&c.specialFeatures.includes("DULL_DOOR")?a(be,null):"",c&&c.specialFeatures&&c.specialFeatures.includes("FULL_ROOM_INDEX")?a(ke,null):"",c&&c.riddles?a("button",{id:"riddle-button",onClick:()=>{t(Z.ShowModalAction(K.Modal.Riddles))}},c.riddles.length>1?"Examine the Riddles":"Examine the Riddle"):"",p),c?a(xe,{users:c.users,userId:e.userId,roomId:c.id}):"",e.mediaChatView||"")}function Oe(e,t){return e=(e=e.replace(/\[\[([^\]]*?)\-\>([^\]]*?)\]\]/g,((e,a,n)=>{const o=t[n];if("item"===n)return`<a class='room-link' href='#' data-item='${a}'>${a}</a>`;if(o){return`<a class='room-link' href='#' data-room='${n}'>${a}${o&&o.users&&o.users.length>0?` (${o.users.length})`:""}</a>`}if(Ce[n])return`<a class='room-link' href='#' data-action='${n}'>${a}</a>`;console.log(`Dev warning: tried to link to room ${n}, which doesn't exist`)}))).replace(/\[\[(.+?)\]\]/g,((e,a)=>{const n=t[a];n||console.log(`Dev warning: tried to link to room ${a}, which doesn't exist`);return`<a class='room-link' href='#' data-room='${a}'>${a}${n&&n.users&&n.users.length>0?` (${n.users.length})`:""}</a>`}))}function We(){const e=r(null),t=r(null);return a("div",{id:"iframes",style:{margin:"auto"}},a("iframe",{width:"560",title:"stream",ref:e,height:"315",src:"https://www.youtube.com/embed/live_stream?channel=UCKv_QzXft4mD6TXmQBZtzIA",frameBorder:"0",allow:"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}),a("iframe",{id:"captions",title:"captions",ref:t,width:"560",height:"100",src:"https://www.streamtext.net/player/?event=RoguelikeCelebration&chat=false&header=false&footer=false&indicator=false&ff=Consolas&fgc=93a1a1",frameBorder:"0",allow:"autoplay; encrypted-media;",allowFullScreen:!0}))}var Le,Fe;function Pe(e){return[Le.Chat,Le.Emote,Le.Shout,Le.Dance,Le.Caption].includes(e.type)}(Fe=Le||(Le={})).Connected="CONNECTED",Fe.Disconnected="DISCONNECTED",Fe.Entered="ENTERED",Fe.Left="LEFT",Fe.MovedRoom="MOVED",Fe.SameRoom="SAME",Fe.Chat="CHAT",Fe.Whisper="WHISPER",Fe.Shout="SHOUT",Fe.Emote="EMOTE",Fe.Dance="DANCE",Fe.Mod="MOD",Fe.Error="ERROR",Fe.Command="COMMAND",Fe.Caption="CAPTION";const He=(e,t,a)=>({type:Le.Chat,messageId:e,userId:t,message:a,timestamp:new Date}),Ue=(e,t,a)=>({type:Le.Caption,messageId:e,userId:t,message:a,timestamp:new Date}),$e=(e,t,a=!1)=>({type:Le.Whisper,userId:e,message:t,senderIsSelf:a,timestamp:new Date}),Ve=e=>({type:Le.Error,error:e,timestamp:new Date}),Ye=e=>({type:Le.Command,command:e,timestamp:new Date});J=G("3Loy2");const Be=new Intl.DateTimeFormat("en",{hour:"numeric",minute:"numeric"});function ze(e){const{message:a}=e;if(!a)return t.createElement("div",null);const n={[Le.Connected]:Ge,[Le.Disconnected]:Je,[Le.Entered]:Ze,[Le.Left]:Ke,[Le.MovedRoom]:Xe,[Le.SameRoom]:Qe,[Le.Chat]:et,[Le.Whisper]:at,[Le.Shout]:ot,[Le.Emote]:rt,[Le.Dance]:lt,[Le.Caption]:tt,[Le.Error]:it,[Le.Mod]:nt,[Le.Command]:st}[a.type];if(!n)return console.log("Unexpected message type",a.type),t.createElement("div",null);const o="string"==typeof a.timestamp?new Date(a.timestamp):a.timestamp;let r="message-wrapper";return e.msgIndex%2==0&&(r+=" even-message"),t.createElement("div",{className:r},t.createElement("div",{className:`time ${e.hideTimestamp?"show-on-hover":null}`},Be.format(o)),t.createElement(n,{...a,id:e.id}))}const _e=(e,t)=>{confirm(`Are you sure you would like to delete the message '${t.message}'?`)&&J.deleteMessage(t.messageId)},qe=(e,a,n)=>t.createElement("a",{href:e,key:n,target:"_blank",rel:"noopener noreferrer"},a),je=e=>{const{userMap:a,myId:n}=i(ka);return a[n]&&a[n].isMod?t.createElement(x,{componentDecorator:qe},t.createElement("span",{className:"deleteMenu"},t.createElement(N,{id:e.messageId,mouseButton:2,renderTag:"span"},e.children),t.createElement(A,{id:e.messageId},t.createElement(T,{data:{messageId:e.messageId,message:e.children},onClick:_e},"Delete Message?")),t.createElement(D,null))):t.createElement(x,{componentDecorator:qe},e.children)},Ge=e=>t.createElement("div",{className:"message"},t.createElement(De,{userId:e.userId,id:e.id})," has connected."),Je=e=>t.createElement("div",{className:"message"},t.createElement(De,{userId:e.userId,id:e.id})," has disconnected."),Ze=e=>{const a=()=>{J.moveToRoom(e.fromId)},n=i(Ma);if(n[e.fromId]){const o=n[e.fromId].hidden?t.createElement("text",null,"somewhere..."):t.createElement("button",{onClick:a,className:"link-styled-button"},e.fromName,".");return t.createElement("div",{className:"message movement-message"},t.createElement(De,{userId:e.userId,id:e.id})," has entered from"," ",o)}return null},Ke=e=>{const a=()=>{J.moveToRoom(e.toId)},n=i(Ma);if(n[e.toId]){const o=n[e.toId].hidden?t.createElement("text",null,"somewhere..."):t.createElement("button",{onClick:a,className:"link-styled-button"},e.toName,".");return t.createElement("div",{className:"message movement-message"},t.createElement(De,{id:e.id,userId:e.userId})," has wandered off to"," ",o)}return null},Xe=e=>t.createElement("div",{className:"message"},"You have moved to ",e.to,"."),Qe=e=>t.createElement("div",{className:"message"},"You are already in ",e.roomId,"."),et=e=>t.createElement("div",{className:"message"},t.createElement(De,{userId:e.userId,id:e.id}),": ",t.createElement(je,{messageId:e.messageId},e.message)),tt=e=>t.createElement("div",{className:"message"},t.createElement(De,{userId:e.userId,id:e.id})," (spoken): ",t.createElement(je,{messageId:e.messageId},e.message)),at=e=>{i(wa);const a=()=>{J.fetchProfile(e.userId)};return e.senderIsSelf?t.createElement("div",{className:"whisper",onClick:a},"You whisper to ",t.createElement(De,{id:e.id,userId:e.userId}),":"," ",e.message):t.createElement("div",{className:"whisper",onClick:a},t.createElement(De,{userId:e.userId,id:e.id})," whispers:"," ",e.message)},nt=e=>e.senderIsSelf?t.createElement("div",{className:"message"},t.createElement("em",null,t.createElement("strong",null,"You")," said to the ",t.createElement("strong",null,"mod team"),":"," ",e.message,t.createElement("br",null),"Someone from the ",t.createElement("strong",null,"mod team")," will be in touch soon.")):t.createElement("div",{className:"message"},t.createElement("em",null,t.createElement("span",{role:"img","aria-label":"red exclamation point"},"❗"),t.createElement(De,{userId:e.userId,id:e.id})," says to the"," ",t.createElement("strong",null,"mods"),":",e.message,t.createElement("span",{role:"img","aria-label":"red exclamation point"},"❗"))),ot=e=>t.createElement("div",{className:"message"},t.createElement(De,{userId:e.userId,id:e.id})," shouts: ",t.createElement(je,{messageId:e.messageId},e.message)),rt=e=>t.createElement("div",{className:"message"},t.createElement("em",null,t.createElement(De,{userId:e.userId,id:e.id})," ",t.createElement(je,{messageId:e.messageId},e.message))),lt=e=>t.createElement("div",{className:"message"},t.createElement("em",null,t.createElement(De,{userId:e.userId,id:e.id})," ",t.createElement("span",{dangerouslySetInnerHTML:{__html:e.message}}))),it=e=>t.createElement("div",{className:"error"},e.error),st=e=>t.createElement("div",{className:"message"},t.createElement("em",null,t.createElement("span",{dangerouslySetInnerHTML:{__html:e.command}})));Z=G("3Wbh2");function ct(e){const a=i(wa);t.useEffect((()=>{const t=document.querySelector("#messages .message-wrapper:last-of-type");t&&e.autoscrollChat&&(t.parentNode.scrollTop=t.offsetTop-t.parentNode.offsetTop)}));const[n,o]=t.useState(!1);function r(t){return((a=t).type===Le.Connected||a.type===Le.Disconnected||a.type===Le.Entered||a.type===Le.Left)&&(e.serverSettings.movementMessagesHideRoomIds.includes(t.roomId)||t.numUsersInRoom>e.serverSettings.movementMessagesHideThreshold);var a}const l=e.messages.filter((e=>!r(e))).filter((t=>!!e.captionsEnabled||t.type!==Le.Caption)),s=p(l,(e=>e.type===Le.MovedRoom)),c=l.slice(s),d=n?l:c;return t.createElement(t.Fragment,null,t.createElement("button",{className:"link-styled-button",onClick:()=>o(!n)},n?"Hide":"Show"," Older Messages"),t.createElement("div",{id:"messages",onScroll:()=>{const t=document.querySelector("#messages"),n=t.scrollHeight===t.scrollTop+t.clientHeight;n&&!e.autoscrollChat?a(Z.ActivateAutoscrollAction()):!n&&e.autoscrollChat&&a(Z.DeactivateAutoscrollAction())}},d.slice(-150).map(((a,n)=>{let o=!1;const r=e.messages[n-1];if(r&&r.userId&&a.userId&&r.userId===a.userId){new Date(a.timestamp).getTime()-new Date(r.timestamp).getTime()<18e4&&(o=!0)}const l=a.type===Le.MovedRoom,i=`message-${n}`;return t.createElement(t.Fragment,null,l?t.createElement("hr",{key:i+"-interstitial"}):null,t.createElement(ze,{message:a,key:i,id:i,hideTimestamp:o,msgIndex:n}))}))))}function dt(e){i(wa);const[a,n]=l(""),r=()=>{e.sendMessage(a),n("")};return o((()=>{document.getElementById("chat-input").focus(),e.prepopulated&&n(e.prepopulated)}),[e.prepopulated]),t.createElement("div",{id:"input"},t.createElement("input",{type:"text",id:"chat-input",onChange:e=>{const t=R(e.currentTarget.value);n(t)},onKeyPress:e=>{"Enter"===e.key&&r()},value:a,"aria-label":"Chat text input box",autoComplete:"off"}),t.createElement("button",{id:"send",onClick:r},"Send"))}J=G("3Loy2"),Z=G("3Wbh2"),J=G("3Loy2"),K=G("1qZWk");const mt=(e,t,a,n)=>({type:e,description:t,invocations:a,singleParameter:n});var ut,ht;(ht=ut||(ut={})).Help="HELP",ht.Move="MOVE",ht.Whisper="WHISPER",ht.Shout="SHOUT",ht.Emote="EMOTE",ht.Dance="DANCE",ht.Interact="INTERACT",ht.ContactMod="CONTACT_MOD",ht.Look="LOOK";const pt=[mt(ut.Help,"Lists the available commands",["/help"],!0),mt(ut.Move,"Move from one room to another. You can also click on the link in the room description.",["/go","/move"],!1),mt(ut.Whisper,"Whisper another user. You can also click directly on their name and select the whisper option.",["/whisper"],!1),mt(ut.Shout,"Sends a message to everybody at once - has a 5 minute cooldown. Do not abuse this!",["/shout"],!1),mt(ut.Emote,"Like a normal message, but in italics!",["/emote","/me"],!1),mt(ut.Dance,"Bust a move!",["/dance"],!0),mt(ut.ContactMod,"Sends a message to the mod team. We will be in touch shortly afterwards.",["/mod","/mods","/moderator","/moderators"],!1),mt(ut.Look,"View the profile of another user. You can also click on their name and select the Profile option.",["/look"],!1),mt(ut.Interact,"Interact with or get something in a room by referencing the name in the description - experiment as you explore!",["/interact","/get"],!1)];var gt=G("1CoyE"),yt=G("715TH");console.log(yt.default.FIREBASE_CONFIG);const Et={firebaseApp:O.initializeApp(yt.default.FIREBASE_CONFIG),authenticated:!1,checkedAuthentication:!1,hasRegistered:!1,messages:[],whispers:[],visibleSpeakers:[],autoscrollChat:!0,userMap:{},roomData:{},inMediaChat:!1,activeModal:K.Modal.None,activeModalOptions:{},isBanned:!1,serverSettings:{movementMessagesHideThreshold:20,movementMessagesHideRoomIds:["theater"],happeningNowEntries:[],spaceIsClosed:!1},numberOfFaces:5,captionsEnabled:!1,hasDismissedAModal:!1};var ft=(e,t)=>{console.log("In reducer",t);const a=JSON.parse(JSON.stringify(e));if(a.prepopulatedInput=void 0,t.type===Z.ActionType.ReceivedMyProfile&&(a.profileData=t.value),t.type===Z.ActionType.ReceivedServerSettings&&(a.serverSettings=t.value),t.type===Z.ActionType.UpdatedCurrentRoom){const e=a.roomId;if(a.roomId=t.value.roomId,a.roomData={...a.roomData,...t.value.roomData},"entryway"!==a.roomId&&a.hasDismissedAModal||(a.activeModal=K.Modal.Welcome),a.roomData&&a.roomData[t.value.roomId]){const o=a.roomData[t.value.roomId];a.roomId!==e?bt(a,(n=o.shortName,{type:Le.MovedRoom,to:n,timestamp:new Date})):bt(a,(e=>({type:Le.SameRoom,roomId:e,timestamp:new Date}))(o.shortName))}}var n,o,r,l,i;if(t.type===Z.ActionType.UpdatedRoomData&&(a.roomData={...a.roomData,...t.value}),t.type===Z.ActionType.UpdatedPresence&&Object.keys(t.value).forEach((e=>{a.roomData[e]&&(a.roomData[e].users=t.value[e])})),t.type===Z.ActionType.PlayerConnected){const e=t.value,n=a.roomData[a.roomId];n.users.includes(e.id)||(n.users.push(e.id),bt(a,(o=e.id,r=a.roomId,l=n.users.length,{type:Le.Connected,userId:o,roomId:r,numUsersInRoom:l,timestamp:new Date}))),a.userMap[e.id]=e}if(t.type===Z.ActionType.PlayerDisconnected){const e=a.roomData[a.roomId];e.users=e.users.filter((e=>e!==t.value)),bt(a,((e,t,a)=>({type:Le.Disconnected,userId:e,roomId:t,numUsersInRoom:a,timestamp:new Date}))(t.value,a.roomId,e.users.length))}if(t.type===Z.ActionType.PlayerEntered){const e=a.roomData[a.roomId];e.users.includes(t.value.name)||(e.users.push(t.value.name),bt(a,((e,t,a,n,o)=>({type:Le.Entered,userId:e,fromId:t,fromName:a,roomId:n,numUsersInRoom:o,timestamp:new Date}))(t.value.name,t.value.fromId,t.value.fromName,a.roomId,e.users.length)))}if(t.type===Z.ActionType.PlayerLeft){const e=a.roomData[a.roomId];e.users=e.users.filter((e=>e!==t.value.name)),bt(a,((e,t,a,n,o)=>({type:Le.Left,userId:e,toId:t,toName:a,roomId:n,numUsersInRoom:o,timestamp:new Date}))(t.value.name,t.value.toId,t.value.toName,a.roomId,e.users.length))}if(t.type===Z.ActionType.ChatMessage&&bt(a,He(t.value.messageId,t.value.name,t.value.message)),t.type===Z.ActionType.CaptionMessage&&bt(a,Ue(t.value.messageId,t.value.name,t.value.message)),t.type===Z.ActionType.Whisper){const e=$e(t.value.name,t.value.message);bt(a,e),vt(a,e)}if(t.type===Z.ActionType.ModMessage&&bt(a,((e,t,a=!1)=>({type:Le.Mod,userId:e,message:t,senderIsSelf:a,timestamp:new Date}))(t.value.name,t.value.message,t.value.name===a.userId)),t.type===Z.ActionType.DeleteMessage&&function(e,t){const a=e.messages.find((e=>Pe(e)&&e.messageId===t));Pe(a)&&(a.message="message was removed by moderator",ne(e.messages))}(a,t.value.targetMessageId),t.type===Z.ActionType.Shout&&bt(a,((e,t,a)=>({type:Le.Shout,messageId:e,userId:t,message:a,timestamp:new Date}))(t.value.messageId,t.value.name,t.value.message)),t.type===Z.ActionType.Emote&&bt(a,((e,t,a)=>({type:Le.Emote,messageId:e,userId:t,message:a,timestamp:new Date}))(t.value.messageId,t.value.name,t.value.message)),t.type===Z.ActionType.Dance&&bt(a,((e,t,a)=>({type:Le.Dance,messageId:e,userId:t,message:a,timestamp:new Date}))(t.value.messageId,t.value.name,t.value.message)),t.type===Z.ActionType.UserMap&&(a.userMap={...a.userMap,...t.value},a.visibleProfile&&a.userMap[a.visibleProfile.id]&&J.fetchProfile(a.visibleProfile.id)),t.type===Z.ActionType.PlayerBanned&&(t.value.id===a.userId?a.isBanned=!0:(a.userMap[t.value.id].isBanned=!0,bt(a,Ve("User "+t.value.username+" was banned!")))),t.type===Z.ActionType.PlayerUnbanned&&(a.userMap[t.value.id]&&(a.userMap[t.value.id].isBanned=!1),bt(a,Ve("User "+t.value.username+" was unbanned!"))),t.type===Z.ActionType.UpdateProfileColor&&(a.userMap[a.userId].nameColor=t.color,t.color?bt(a,Ve("Your name color was changed to "+t.color)):bt(a,Ve("Your name color has changed back to its original state.")),J.updateProfileColor(a.userId,t.color)),t.type===Z.ActionType.UpdateFontReward&&(a.userMap[a.userId].fontReward=t.font,t.font?bt(a,Ve("You feel invigorated, and like you've become more... "+t.font)):bt(a,Ve("You feel yourself return to your normal state, like you never went riddling to begin with.")),J.updateFontReward(a.userId,t.font)),t.type===Z.ActionType.Error&&bt(a,Ve(t.value)),t.type===Z.ActionType.MediaReceivedSpeakingData&&(a.currentSpeaker=t.value,null!==t.value&&t.value!==a.userId&&!a.visibleSpeakers.find((([e,a])=>e===t.value))))if(a.visibleSpeakers.length<a.numberOfFaces)a.visibleSpeakers.push([t.value,new Date]);else{let e=-1,n=new Date;for(let t=0;t<a.visibleSpeakers.length;t++)a.visibleSpeakers[t][1]<n&&(n=a.visibleSpeakers[t][1],e=t);a.visibleSpeakers[e]=[t.value,new Date]}if(t.type===Z.ActionType.SetNumberOfFaces&&(a.numberOfFaces=t.value),t.type===Z.ActionType.StartVideoChat&&(a.inMediaChat=!0),t.type===Z.ActionType.StopVideoChat&&(a.inMediaChat=!1),t.type===Z.ActionType.SendMessage){const e=S(),n=t.value.trim(),o=/^\/.+?/.exec(n),r=o?(i=n,pt.find((e=>e.invocations.find((t=>e.singleParameter?i.startsWith(t):i.startsWith(t+" ")))))):void 0;if(n.length>gt.MESSAGE_MAX_LENGTH)bt(a,Ve("Your message is too long! Please try to keep it under ~600 characters!"));else if(n.split(" ").find((e=>e.length>gt.MESSAGE_MAX_WORD_LENGTH)))bt(a,Ve("Your message has a word that is too long! Please keep it under 60 characters!"));else if(o&&void 0===r){const e=/^(\/.+?) (.+)/.exec(n);bt(a,Ve(`Your command ${e?e[1]:t.value} is not a registered slash command!`))}else if(o&&r.type===ut.Whisper){const t=/^(\/.+?) (.+)/.exec(n),o=/^(.+?) (.+)/.exec(t[2]);if(o){J.sendChatMessage(e,n);const[t,r,l]=o,i=Object.values(a.userMap).find((e=>e.username===r)),s=i&&i.id;if(s){const e=$e(s,l,!0);bt(a,e),vt(a,e)}}else bt(a,Ve(`Your whisper to ${t[2]} had no message!`))}else if(o&&r.type===ut.Help)a.activeModal=K.Modal.Help,bt(a,Ye("You consult the help docs. (You can also find them in sidebar!)"));else if(o&&r.type===ut.Look){const t=/^(\/.+?) (.+)/.exec(n);bt(a,Ye(`You attempt to examine ${t[2]}. (You can also click on their username and select Profile!)`)),J.sendChatMessage(e,n)}else o?J.sendChatMessage(e,n):(J.sendChatMessage(e,t.value),bt(a,He(e,a.userId,t.value)))}if(t.type===Z.ActionType.SendCaption){const e=S();J.sendCaption(e,t.value),bt(a,Ue(e,a.userId,t.value))}if(t.type===Z.ActionType.StartWhisper&&(a.prepopulatedInput=`/whisper ${t.value} `),t.type===Z.ActionType.HideModalAction&&(a.activeModal=K.Modal.None,a.hasDismissedAModal=!0),t.type===Z.ActionType.ShowProfile&&(a.visibleProfile=t.value),t.type===Z.ActionType.HideProfile&&(a.visibleProfile=null),t.type===Z.ActionType.ShowModal&&(a.activeModal=t.value,a.activeModalOptions={}),t.type===Z.ActionType.ShowModalWithOptions&&(console.log("Showing",t),a.activeModal=t.value.modal,a.activeModalOptions=t.value.options),t.type===Z.ActionType.ShowSideMenu&&(a.mobileSideMenuIsVisible=!0),t.type===Z.ActionType.HideSideMenu&&(a.mobileSideMenuIsVisible=!1),t.type===Z.ActionType.DeactivateAutoscroll&&(a.autoscrollChat=!1),t.type===Z.ActionType.ActivateAutoscroll&&(a.autoscrollChat=!0),t.type===Z.ActionType.SetUseSimpleNames&&(a.useSimpleNames=t.value,async function(e){await M.setItem(pe,e)}(t.value)),t.type===Z.ActionType.SetKeepCameraWhenMoving&&(a.keepCameraWhenMoving=t.value,async function(e){await M.setItem(ge,e)}(t.value)),t.type===Z.ActionType.SetCaptionsEnabled&&(a.captionsEnabled=t.value,async function(e){await M.setItem(Ee,e)}(t.value)),t.type===Z.ActionType.SetTextOnlyMode&&(a.textOnlyMode=t.textOnlyMode,t.refresh?ie(t.textOnlyMode).then((()=>window.location.reload())):ie(t.textOnlyMode)),t.type===Z.ActionType.SetAudioOnlyMode&&(a.audioOnlyMode=t.value),t.type===Z.ActionType.Authenticate&&(a.checkedAuthentication=!0,a.authenticationProvider=t.value.provider,a.mustVerifyEmail=t.value.mustVerifyEmail,t.value.userId&&t.value.name?(a.authenticated=!0,a.userId=t.value.userId,a.userMap[t.value.userId]={id:t.value.userId,username:t.value.name}):(a.authenticated=void 0,a.userId=void 0)),t.type===Z.ActionType.IsRegistered&&(a.hasRegistered=!0),t.type===Z.ActionType.BanToggle&&J.toggleUserBan(t.value),t.type===Z.ActionType.ModToggle&&J.toggleUserMod(t.value),t.type===Z.ActionType.LoadMessageArchive&&(a.messages=t.messages,a.whispers=t.whispers||[]),t.type===Z.ActionType.NoteAdd){const e=a.roomData&&a.roomData[t.value.roomId];e.hasNoteWall&&(e.notes||(e.notes=[]),e.notes.push(t.value.note))}if(t.type===Z.ActionType.NoteRemove){const e=a.roomData&&a.roomData[t.value.roomId];e.hasNoteWall&&(e.notes||(e.notes=[]),e.notes=e.notes.filter((e=>e.id!==t.value.noteId)))}if(t.type===Z.ActionType.NoteUpdateLikes){const e=a.roomData&&a.roomData[t.value.roomId];if(e.hasNoteWall){e.notes||(e.notes=[]);const a=e.notes.find((e=>e.id===t.value.noteId));a&&(a.likes=t.value.likes)}}if(t.type===Z.ActionType.NoteUpdateRoom){const e=a.roomData&&a.roomData[t.value.roomId];e.hasNoteWall&&(e.notes=t.value.notes)}if(t.type===Z.ActionType.SpaceIsClosed&&(a.isClosed=!0),t.type===Z.ActionType.SpaceOpenedOrClosed&&(a.userMap[a.userId].isMod?(a.isClosed=t.value,bt(a,Ye("The space is now "+(t.value?"closed":"open")))):window.location.reload()),t.type===Z.ActionType.CommandMessage){const e=Ye(t.value);bt(a,e)}return a};async function vt(e,t){e.whispers.push(t),async function(e){await M.setItem(de,e)}(e.whispers)}async function bt(e,t){e.messages.push(t),e.messages=e.messages.slice(-500),ne(e.messages)}Z=G("3Wbh2"),Z=G("3Wbh2");const wt=e=>{const{otherUser:a}=e;return e.senderIsSelf?t.createElement("div",{className:"whisper-message"},t.createElement("em",null,"You:"," ",e.message)):t.createElement("div",{className:"whisper-message"},t.createElement("em",null,t.createElement("span",{"data-tip":a&&a.pronouns},a.username),":"," ",e.message,t.createElement(D,null)))};function kt(e){const{user:a,whispers:n}=e,o=i(wa);t.useEffect((()=>{const e=document.querySelector("#chat .whisper-message:last-of-type");e&&(e.parentNode.scrollTop=e.offsetTop-e.parentNode.offsetTop)}));const r=(n||[]).filter(((e,t)=>e.userId===a.id)),l=a.realName?t.createElement("div",{id:"profile-realName"},a.realName):null,s=a.twitterHandle?t.createElement("div",{id:"profile-twitter"},t.createElement("strong",null,"Twitter"),":"," ",t.createElement("a",{href:`https://twitter.com/${a.twitterHandle}`,target:"_blank",rel:"noreferrer"},"@",a.twitterHandle)):null,c=a.url?t.createElement("div",{id:"profile-url"},t.createElement("strong",null,"Web Site"),":"," ",a.url):null,d=a.description?t.createElement("div",{id:"profile-description"},a.description):null,m=a.askMeAbout?t.createElement("div",{id:"profile-askme"},t.createElement("strong",null,"Ask me about:")," ",a.askMeAbout):null;return t.createElement(x,{componentDecorator:(e,a,n)=>t.createElement("a",{href:e,key:n,target:"_blank",rel:"noopener noreferrer"},a)},t.createElement("div",{id:"profile"},t.createElement("div",{className:"fixed"},t.createElement("div",{id:"header"},t.createElement("h2",{className:a.isMod?"mod":""},t.createElement(De,{userId:a.id,id:`profile-nameview-${a.id}`})),t.createElement("button",{className:"close-profile",onClick:()=>o(Z.HideProfileAction())},"X")),t.createElement("p",null,l,t.createElement("div",{id:"profile-pronouns"},a.pronouns),d),a.item?t.createElement("p",null,a.username," is currently holding ",a.item):null,t.createElement("p",null,s,c,m),t.createElement("div",{id:"chat-container"},t.createElement("div",{id:"chat-header"},"Whisper Chat"),t.createElement("div",{id:"chat"},r.length>0?r.map(((e,n)=>{const o=`whisper-message-${n}`;return t.createElement(wt,{...e,key:o,id:o,otherUser:a})})):t.createElement("em",null,`This is the beginning of your whisper chat with ${a.username}`)),t.createElement(dt,{sendMessage:e=>o(Z.SendMessageAction(`/whisper ${a.username} ${e}`))})))))}var It=G("7zAPm");Z=G("3Wbh2"),K=G("1qZWk");function Ct(e){const a=i(wa),{localStreamView:n,setMicEnabled:o,setCameraEnabled:r,cameraEnabled:l,micEnabled:s}=Te();return n?t.createElement("div",{className:"my-video"},"You",l?n:t.createElement(b,{size:90,style:{textAlign:"center"},className:"placeholder-avatar"}),e.hideUI?"":t.createElement("div",null,t.createElement("button",{id:"send-video",onClick:e=>{r(!l)},className:"link-styled-button video-button "+(l?"enabled":"disabled"),"aria-label":"Toggle Video"},l?t.createElement(f,null):t.createElement(w,null)),t.createElement("button",{id:"send-audio",onClick:e=>{o(!s)},className:"link-styled-button video-button "+(s?"enabled":"disabled"),"aria-label":"Toggle Audio"},s?t.createElement(E,null):t.createElement(v,null)),t.createElement("button",{id:"show-media-selector",onClick:()=>{a(Z.ShowModalAction(K.Modal.MediaSelector))},className:"link-styled-button video-button","aria-label":"Show Media Selector"},t.createElement(k,null)))):null}function Mt({track:e}){const t=r();return o((()=>(t.current=e.attach(),t.current.setAttribute("data-cy-audio-track-name",e.name),document.body.appendChild(t.current),()=>e.detach().forEach((e=>e.remove())))),[e]),null}function St({track:e,isLocal:a,priority:n}){const i=r(null),s=function(e){const[t,a]=l(null==e?void 0:e.mediaStreamTrack);return o((()=>{if(a(null==e?void 0:e.mediaStreamTrack),e){const t=()=>{console.log("Set media stream track!"),a(e.mediaStreamTrack)};return e.on("started",t),()=>{e.off("started",t)}}}),[e]),t}(e),c=function(e){const[t,a]=l(null==e?void 0:e.dimensions);return o((()=>{if(a(null==e?void 0:e.dimensions),e){const t=e=>a({width:e.dimensions.width,height:e.dimensions.height});return e.on("dimensionsChanged",t),()=>{e.off("dimensionsChanged",t)}}}),[e]),t}(e),d=((null==c?void 0:c.height)??0)>((null==c?void 0:c.width)??0);console.log("Rendering videotrack",e),o((()=>{const t=i.current;return t.muted=!0,e.setPriority&&n&&e.setPriority(n),e.attach(t),()=>{e.detach(t),e.setPriority&&n&&e.setPriority(null)}}),[e,n,s]);const m="environment"!==(null==s?void 0:s.getSettings().facingMode),u={transform:a&&m?"rotateY(180deg)":"",objectFit:d||e.name.includes("screen")?"contain":"cover"};return t.createElement("video",{ref:i,style:u})}function At({publication:e,isLocalParticipant:a,videoOnly:n,videoPriority:r}){const i=function(e){const[t,a]=l(e&&e.track);return o((()=>{if(a(e&&e.track),e){const t=()=>a(null);return e.on("subscribed",a),e.on("unsubscribed",t),()=>{e.off("subscribed",a),e.off("unsubscribed",t)}}}),[e]),t}(e);if(!i)return null;switch(i.kind){case"video":return t.createElement(St,{track:i,priority:r,isLocal:i.name.includes("camera")&&a});case"audio":return n?null:t.createElement(Mt,{track:i});default:return null}}function Tt({participant:e,displayVideo:a,displayAudio:n,videoOnly:r,videoPriority:i,isLocalParticipant:s}){const c=function(e){const[t,a]=l([]);return o((()=>{a(Array.from(e.tracks.values()));const t=e=>a((t=>[...t,e])),n=e=>a((t=>t.filter((t=>t!==e))));return e.on("trackPublished",t),e.on("trackUnpublished",n),()=>{e.off("trackPublished",t),e.off("trackUnpublished",n)}}),[e]),t}(e),d=c.filter((e=>"video"===e.kind)),m=c.filter((e=>"audio"===e.kind));let u=[];return a&&d.length>0&&u.push(d[0]),n&&(u=u.concat(m)),t.createElement(t.Fragment,null,u.map((e=>t.createElement(At,{key:e.kind,publication:e,isLocalParticipant:s,videoOnly:r,videoPriority:i}))))}function Nt(e){const[a,n]=t.useState(e.renderAsFace),[o,r]=t.useState(!0),l={border:e.isDominant?"solid":void 0};if(!e.renderAsFace)return t.createElement(Tt,{participant:e.participant,displayVideo:!1,displayAudio:o});const i=e.participant.videoTracks.size>0;if(!(e.participant.audioTracks.size+e.participant.videoTracks.size>0))return t.createElement("div",{key:`stream-wrapper-${e.participant.identity}`});let s;return a&&i||(s=t.createElement(b,{size:90,style:{textAlign:"center"},className:"placeholder-avatar"})),t.createElement("div",{key:`stream-wrapper-${e.participant.identity}`,className:"participant-track-square other-participant",style:l},t.createElement(De,{userId:e.participant.identity,id:`stream-nameview-${e.participant.identity}`,nowrap:!0}),t.createElement(Tt,{participant:e.participant,displayVideo:a,displayAudio:o}),i?t.createElement("button",{id:"play-video",onClick:e=>{n(!a)},className:"link-styled-button video-button "+(a?"enabled":"disabled"),"aria-label":`Toggle Video ${e.participant.identity}`},a?t.createElement(f,null):t.createElement(w,null)):null,s,t.createElement("button",{id:"play-audio",onClick:e=>{r(!o)},className:"link-styled-button video-button "+(o?"enabled":"disabled"),"aria-label":`Toggle Audio ${e.participant.identity}`},o?t.createElement(E,null):t.createElement(v,null)))}Z=G("3Wbh2"),K=G("1qZWk");var Dt=e=>{const{currentMic:a,currentCamera:n,publishingCamera:o,publishingMic:r,inCall:l,publishMedia:i,publishAudio:s,unpublishMedia:c}=Te(),d=t.useContext(wa),m=()=>{d(Z.StopVideoChatAction()),c()},u=()=>{d(Z.ShowModalAction(K.Modal.MediaSelector))};let h;if(e.inMediaChat){let e="";o&&r?e="Turn off Webcam and Mic":o?e="Turn off Webcam":r&&(e="Turn off Mic"),h=t.createElement(t.Fragment,null,t.createElement("button",{onClick:m,id:"join-video-chat"},e),t.createElement("button",{key:"show-media-selector",id:"big-reconfigure-media-selector",onClick:u,className:"link-styled-button video-button","aria-label":"Show Media Selector"},t.createElement(k,null)))}else e.textOnlyMode?h=[t.createElement("button",{key:"text-only-mode",onClick:()=>{confirm("Re-enabling video and audio mode means that you will be able to see and hear video and audio from other participants. Your camera and microphone will default to off when you switch modes.\b\n\nSwitching modes will refresh your page - please be patient while it reloads.")&&d(Z.SetTextOnlyModeAction(!1,!0))},id:"toggle-text-only-mode"},"Re-Enable Audio/Video")]:e.canJoinVideoChat&&(h=[t.createElement("button",{key:"join-video",onClick:async()=>{e.canJoinVideoChat&&(a||n?i():d(Z.ShowModalAction(K.Modal.MediaSelector)))},id:"join-video-chat"},l?"Turn on Webcam + Mic":t.createElement("s",null,"Turn on Webcam + Mic")),t.createElement("button",{key:"join-audio",onClick:async()=>{e.canJoinVideoChat&&(a?s():d(Z.ShowModalWithOptionsAction(K.Modal.MediaSelector,{hideVideo:!0})))},id:"join-audio-chat"},l?"Turn on Mic":t.createElement("s",null,"Turn on Mic")),t.createElement("button",{key:"show-media-selector",id:"big-reconfigure-media-selector",onClick:u,className:"link-styled-button video-button","aria-label":"Show Media Selector"},t.createElement(k,null))]);var p;return e.totalCount>0&&(p=t.createElement("div",{className:"offscreen-count"},e.totalCount," ",1===e.totalCount?"person is":"people are"," in the call",o||r?", not including you":"",".")),t.createElement("div",{id:"media-chat-buttons"},p,h,t.createElement("div",null,t.createElement("button",{key:"audio-only-mode",onClick:()=>{let t;t=e.audioOnlyMode?"This will show you others&apos; webcam feeds. This will not affect whether or not you are sending your own webcam feed to others.":"This will hide all video feeds from other attendees. You will still be able to hear them, but you won't see them. This may improve performance if things are slow.\n\nNote that you will still broadcast your webcam feed to others if you enable it, and you will still be able to see the talks broadcast in the Theater.";confirm(t)&&d(Z.SetAudioOnlyModeAction(!e.audioOnlyMode))},id:"toggle-audio-only-mode",className:"link-styled-button"},e.audioOnlyMode?"Show":"Hide"," all video feeds"),t.createElement("button",{key:"text-only-mode",onClick:()=>{confirm("This will disable all audio/video aspects of this space other than the stream in the theater. You will no longer be able to see or hear other participants, but you can still interact via text chat.\n\nSwitching modes will refresh your page - please be patient while it reloads.")&&d(Z.SetTextOnlyModeAction(!0,!0))},id:"toggle-text-only-mode",className:"link-styled-button"},"Mute all audio and video")))};Z=G("3Wbh2");function xt(e){const{publishingCamera:a,callParticipants:n,inCall:o,joinCallFailed:r}=Te(),l=t.useContext(wa),i=(e.visibleSpeakers||[]).map((e=>e[0]));if(console.log("Re-rendering media chat view?"),!o){if(r)return t.createElement("div",{id:"media-wrapper"},t.createElement("strong",null,"Could not connect to audio/video! Rooms are max 50 chatters - if you want to use audio/video, try moving to another room. Otherwise, it may be a network issue."));if(e.textOnlyMode){const e=()=>{confirm("Entering video/audio mode means that you will be able to see and hear video and audio from other participants. Your camera and microphone will default to off when you switch modes. Switching modes will refresh your page - please be patient while it reloads.")&&l(Z.SetTextOnlyModeAction(!1,!0))};return t.createElement("div",{id:"media-wrapper"},"There may be a voice/video call happening here that you can't see.",t.createElement("button",{className:"link-styled-button",onClick:e,style:{marginLeft:"1em"}},"Disable Text-Only Mode"),".")}return t.createElement("div",{id:"media-wrapper"},t.createElement("strong",null,"Attempting to connect to room."))}if(!n)return t.createElement("div",{id:"media-view"});let s;a&&(s=t.createElement(Ct,{speaking:!1}));const c=Array.from(n.values()).filter((e=>e.audioTracks.size+e.videoTracks.size>0)),d=c.filter((e=>i.includes(e.identity))),m=c.filter((e=>!i.includes(e.identity)));for(console.log("[NUM_FACES]: ",e.numberOfFaces);d.length<e.numberOfFaces&&m.length>0;)d.push(m.shift());const u=d.map((a=>t.createElement(Nt,{key:`participant-chat-view-${a.identity}`,participant:a,isDominant:e.currentSpeaker===a.identity,renderAsFace:!e.audioOnlyMode}))),h=m.map((t=>{e.currentSpeaker,t.identity})),p=e.currentUser.isMod,g={height:s||!e.audioOnlyMode&&u.length>0?void 0:"0px"};return t.createElement("div",{id:"media-wrapper"},t.createElement("div",{id:"media-view",style:g},s," ",u," ",h),t.createElement(Dt,{textOnlyMode:e.textOnlyMode,inMediaChat:e.inMediaChat,totalCount:u.length+h.length,canJoinVideoChat:p,offscreenCount:e.audioOnlyMode?u.length+h.length:h.length,audioOnlyMode:e.audioOnlyMode}))}J=G("3Loy2"),Z=G("3Wbh2"),yt=G("715TH");function Rt(e){if(e.includes(" ")){for(console.log("spaces detected "+e);e.includes(" ");)e=e.replace(" ","-");console.log("spaces crushed: "+e)}return e}function Ot(e){i(wa);const{defaultHandle:a,user:n,prepopulateTwitterWithDefaultHandle:o}=e,[r,s]=l(n&&n.username||a||""),[c,d]=l(n&&n.realName||""),[m,u]=l(n&&n.pronouns||""),[h,p]=l(n&&n.description||""),[g,y]=l(n&&n.askMeAbout||""),[E,f]=l(n&&n.url||""),[v,b]=l(n&&n.twitterHandle||o&&a||"");return t.createElement("div",{id:"profile-edit",className:"container "+(e.isFTUE?"ftue":"")},t.createElement("div",{className:"form"},t.createElement("h1",null,(e.isFTUE?"Create":"Edit")+" Name Badge"),t.createElement("div",{style:{marginTop:"2em",marginBottom:"2em"}},"This is your virtual conference badge!",t.createElement("br",null),"Whatever you enter will be visible to other attendees.",t.createElement("br",null),"You can come back and change this at any time."),t.createElement("div",{className:"grid"},t.createElement("div",{className:"field"},t.createElement("label",{htmlFor:"username"},"Chat Handle"),t.createElement("em",null,"What shows up when you send messages"),t.createElement("input",{type:"text",id:"username",value:r,onChange:e=>{const t=Rt(e.currentTarget.value);0!==t.localeCompare(e.currentTarget.value)&&(e.currentTarget.value=t),s(e.currentTarget.value)}})),t.createElement("div",{className:"field"},t.createElement("label",{htmlFor:"realname"},"Name"),t.createElement("em",null,'Optional: Your "IRL" name.'),t.createElement("input",{type:"text",id:"real-name",value:c,onChange:e=>d(e.currentTarget.value)})),t.createElement("div",{className:"field"},t.createElement("label",{htmlFor:"description"},"Character Description"),t.createElement("em",null,"Optional: Describe your avatar!"),t.createElement("input",{type:"text",id:"description",value:h,onChange:e=>p(e.currentTarget.value)})),t.createElement("div",{className:"field"},t.createElement("label",{htmlFor:"pronouns"},"Pronouns"),t.createElement("em",null,'e.g. "she/her" or "he/they"'),t.createElement("input",{type:"text",id:"pronouns",value:m,onChange:e=>u(e.currentTarget.value)})),t.createElement("div",{className:"field"},t.createElement("label",{htmlFor:"website"},"Website"),t.createElement("em",null,"Optional: Your personal site!"),t.createElement("input",{type:"text",id:"website",value:E,onChange:e=>f(e.currentTarget.value)})),t.createElement("div",{className:"field"},t.createElement("label",{htmlFor:"twitter"},"Twitter Handle"),t.createElement("em",null,"Optional: Don't include the @"),t.createElement("input",{type:"text",id:"twitter",value:v,onChange:e=>b(e.currentTarget.value)})),t.createElement("div",{className:"field"},t.createElement("label",{htmlFor:"ask-me-about"},"Ask Me About"),t.createElement("em",null,"Optional: What are you excited to talk about?"),t.createElement("input",{type:"text",id:"ask-me-about",value:g,onChange:e=>y(e.currentTarget.value)}))),t.createElement("button",{onClick:t=>{s(Rt(r)),J.updateProfile({username:r,realName:c,pronouns:m,description:h,askMeAbout:g,twitterHandle:v,url:E,hostname:yt.default.SERVER_HOSTNAME},e.isFTUE)},className:"submit"},"Save Changes")))}Z=G("3Wbh2"),K=G("1qZWk"),J=G("3Loy2");var Wt=G("1REsD");function Lt(e){const a=i(wa),{userMap:n,myId:o}=i(ka),r=n[o],l=r&&r.isMod,s=t.createElement(T,{onClick:()=>{confirm(`Are you sure you would like to ${e.spaceIsClosed?"open":"close"} the space for all non-mod users?`)&&J.openOrCloseSpace(!e.spaceIsClosed)}},e.spaceIsClosed?"Open":"Close"," the Space");return t.createElement("div",{id:"menu-button"},t.createElement(N,{id:"topMenu",holdToDisplay:0},t.createElement("strong",null,e.username)," ",t.createElement(k,null)),t.createElement(A,{id:"topMenu"},t.createElement(T,{onClick:()=>{J.fetchProfile(o)}},"View Profile"),t.createElement(T,{onClick:()=>{a(Z.ShowModalAction(K.Modal.ProfileEdit))}},"Edit Profile"),t.createElement(T,{onClick:()=>{a(Z.ShowModalAction(K.Modal.Settings))}},"Settings & Theme"),l?s:null,l?t.createElement(T,{onClick:()=>{a(Z.ShowModalAction(K.Modal.ServerSettings))}},"Server Settings"):null,t.createElement(T,{onClick:()=>{confirm("Are you sure you want to log out?")&&J.disconnect(o).then((()=>{Wt.signOut().then((()=>{window.location.reload()}))})).catch((e=>{console.log("error signing out",e),window.location.reload()}))}},"Log Out")))}Z=G("3Wbh2"),K=G("1qZWk"),Z=G("3Wbh2"),K=G("1qZWk"),J=G("3Loy2"),Z=G("3Wbh2");function Ft(e){const a=i(wa),{roomData:n,currentRoomId:o}=e;let r,l;if(e.isMiniMap?(r=8,l=13):(r=10,l=21),t.useEffect((()=>{const t=document.getElementById(`${e.isMiniMap?"minimap-":""}clickable-room-${o}`);t&&t.scrollIntoView({block:"center",inline:"center"})}),e.isMiniMap?null:[]),!n)return t.createElement("div",null);let s=Pt;Ht.forEach(((e,t)=>{let a="[0]";n[e]&&n[e].users&&n[e].users.length>0&&(a=`[${n[e].users.length}]`),a=a.padEnd(4,"."),s=s.replace(`(${t.toString().padStart(2,"0")})`,a)})),s=s.replace(/\[([0-9]*)\]/g,"($1)");const c=e=>{const t=e.target&&e.target.getAttribute&&e.target.getAttribute("data-room");t&&(J.moveToRoom(t),a(Z.HideModalAction()))},d=Ut.map((a=>t.createElement("div",{style:{position:"absolute",left:a.x*r+"px",top:a.y*l+"px",width:a.width*r+"px",height:a.height*l+"px",cursor:"pointer"},key:a.roomId,onClick:c,"data-room":a.roomId,id:`${e.isMiniMap?"minimap-":""}clickable-room-${a.roomId}`})));return t.createElement("div",{className:"map",style:{position:"relative",margin:"15px"}},d,t.createElement("pre",{style:{letterSpacing:"2px",fontFamily:"IBM Plex Mono"}},t.createElement("code",null,s)))}const Pt="                        ┌────────────────────────────────────────────┐                                        \n┌────────────────┐      │............................................│   ┌──────────┐     ┌──────────┐        \n│................│      │.................Theater....................│   │.Warrior..│     │.. Mage...│        \n│.Robot Labs.....│      │...................(05).....................│   │...(12)...│     │...(13)...│        \n│...(00).........│      │............................................│   └─────#────┘     └─────#────┘        \n│................│      │............................................│         #                #             \n│................│      │............................................############################             \n└──────────#─────┘      │............................................│         #                #             \n┌──────────#─────┐      │............................................│   ┌─────#────┐     ┌─────#────┐        \n│............... │      │............................................│   │..Rogue...│     │.Tourist..│        \n│.Space.Hangar...│      │............................................│   │...(14)...│     │...(15)...│        \n│.Lounge.........│      │............................................│   └──────────┘     └──────────┘        \n│...(01).........│      │............................................│                                        \n│................│      │............................................│                                        \n│┌────────────┐..│      │............................................│                                        \n││.Vending....│..###    │............................................│                                        \n││.Machine....│..│ ##   └────────────────────#───────────────────────┘                                        \n││...(02).....│..│  ###                      #           ┌──────────────────────────────────────────────────┐ \n│└────────────┘..│     ###        ┌──────────#────────┐  │..................Unconferencing..................│ \n└────────────────┘       ###      │...................####..................Lobby ..(16)....................│ \n┌────────────┐         ┌────────────┐.................│  └──────────────#───────────────────#───────────────┘ \n│.Office Of..│         │Destinations│..Central Hall...│  ┌──────────┐   #    ┌──────────┐   #   ┌──────────┐  \n│.Steam......│         │..(06)......│.....(10)........│  │Cockatrice│   #    │...Naga...│   #   │..Tengu...│  \n│...(27).....│         └────────────┘.................│  │...(17)...##########...(18)...│########...(19)...│  \n└───────#────┘         ###        │...................│  └──────────┘   #    └──────────┘   #   └──────────┘  \n┌───────#────────┐   ###          │...................│  ┌──────────┐   #    ┌──────────┐   #   ┌──────────┐  \n│................│ ###            │...................│  │..Dragon..│   #    │.Skeleton.│   #   │...Yak....│  \n│.Adventurers....│##              │..┌────────────┐...│  │...(20)...##########...(21)...#########...(22)...│  \n│.Guild..........##               │..│.Swag Table.│...│  └──────────┘        └──────────┘       └──────────┘  \n│...(03).........│   ┌──────────┐ │..│...(11).....│...│ ┌──────────────────────────────────────────────┐      \n│................│   │...Paint..│ │..└────────────┘...│ │....................................┌───────┐.│      \n│................│   │...(07)...│ │...................###.................Bar ..(23).........│Railing│.│      \n│................│   └────#─────┘ │...................│ │....................................│..(25).│.│      \n└───────#────────┘   ┌────#─────┐ └──────────#────────┘ │..┌───────┐.....┌────────────┐......└───────┘.│      \n┌───────#────────┐   │...Dyes...│            #          │..│Stools │.....│....Stage...│................│      \n│................│  ##...(08)...│            #          │..│..(24).│.....│....(29)....│................│      \n│.Office of......│###└────#─────┘ ┌──────────#────────┐ │..└───────┘.....└────────────┘................│      \n│.Transmutation..##  ┌────#─────┐ │.....Library.......│ │.....................┌────────────┐...........│      \n│...(04).........│   │..SHOWER..│ │.......(28)........│ │.....................│Back...(26).│...........│      \n│................│   │...(09)...│ │...................│ │.....................└────────────┘...........│      \n└────────────────┘   └──────────┘ └───────────────────┘ └──────────────────────────────────────────────┘      \n",Ht=["robots","sfHub","vendingMachine","exploreHub","transmute","theater","destinations","doctorPaint","dyes","shower","hall","swag","warrior","mage","rogue","tourist","unconference","cockatrice","naga","tengu","dragon","skeleton","yak","bar","stools","railing","back","steam","library","barStage"],Ut=[{roomId:"robots",x:0,y:1,width:18,height:7},{roomId:"sfHub",x:0,y:8,width:18,height:12},{roomId:"vendingMachine",x:1,y:14,width:14,height:5},{roomId:"exploreHub",x:0,y:25,width:18,height:9},{roomId:"transmute",x:0,y:34,width:18,height:7},{roomId:"theater",x:24,y:0,width:46,height:17},{roomId:"destinations",x:23,y:20,width:14,height:4},{roomId:"doctorPaint",x:21,y:29,width:12,height:4},{roomId:"dyes",x:21,y:33,width:12,height:4},{roomId:"shower",x:21,y:37,width:12,height:4},{roomId:"hall",x:34,y:18,width:21,height:16},{roomId:"swag",x:37,y:27,width:14,height:4},{roomId:"warrior",x:73,y:1,width:12,height:4},{roomId:"mage",x:90,y:1,width:12,height:4},{roomId:"rogue",x:73,y:8,width:12,height:4},{roomId:"tourist",x:90,y:8,width:12,height:4},{roomId:"unconference",x:57,y:17,width:52,height:4},{roomId:"cockatrice",x:57,y:21,width:12,height:4},{roomId:"naga",x:77,y:21,width:12,height:4},{roomId:"tengu",x:96,y:21,width:12,height:4},{roomId:"dragon",x:57,y:25,width:12,height:4},{roomId:"skeleton",x:77,y:25,width:12,height:4},{roomId:"yak",x:96,y:25,width:12,height:4},{roomId:"bar",x:56,y:29,width:48,height:12},{roomId:"stools",x:59,y:33,width:9,height:4},{roomId:"railing",x:93,y:30,width:9,height:4},{roomId:"back",x:78,y:37,width:14,height:3},{roomId:"steam",x:0,y:20,width:14,height:5},{roomId:"library",x:34,y:36,width:21,height:5},{roomId:"barStage",x:73,y:33,width:14,height:4}];function $t(e){const a=i(wa);return t.createElement("div",{id:"mini-map",onClickCapture:e=>{a(Z.ShowModalAction(K.Modal.Map)),e.stopPropagation()},style:{cursor:"pointer"}},t.createElement(Ft,{roomData:e.roomData,currentRoomId:e.currentRoomId,isMiniMap:!0}))}function Vt(e){const a=i(Ca),n=i(wa);return t.createElement("nav",{id:"side-menu",role:"navigation","aria-label":"List of rooms you can navigate to"},a?t.createElement("button",{onClick:()=>{n(Z.HideSideMenuAction())},id:"close-button",className:"close"},"x"):"",t.createElement(Lt,{username:e.username,spaceIsClosed:e.spaceIsClosed}),t.createElement("button",{id:"happening-now-button",onClick:()=>{n(Z.ShowModalAction(K.Modal.HappeningNow))}},"Happening Now"),t.createElement("button",{id:"nav-map-button",onClick:()=>{n(Z.ShowModalAction(K.Modal.Map))}},"Map"),t.createElement("ul",null,t.createElement(Yt,{title:"Schedule",modal:K.Modal.Schedule}),t.createElement(Yt,{title:"Room List",modal:K.Modal.RoomList}),t.createElement(Yt,{title:"Code of Conduct",modal:K.Modal.CodeOfConduct}),t.createElement(Yt,{title:"Help",modal:K.Modal.Help})),e.roomData&&e.currentRoomId?t.createElement($t,{roomData:e.roomData,currentRoomId:e.currentRoomId}):null)}const Yt=e=>{const a=i(wa);return t.createElement("li",null,t.createElement("button",{className:"nav-item",onClick:()=>{a(Z.ShowModalAction(e.modal))}},t.createElement("strong",null,e.title)))};K=G("1qZWk"),J=G("3Loy2"),J=G("3Loy2");function Bt(e){const{userMap:a,myId:n}=i(ka),o=e.note,r=a[n].isMod||o.authorId===n,l=o.authorId!==n,s=o.likes&&o.likes.includes(n),c=o.likes?o.likes.length:0;let d;s&&(d=o.likes.map((e=>a[e].username)).join(", "));return t.createElement(x,{componentDecorator:(e,a,n)=>t.createElement("a",{href:e,key:n,target:"_blank",rel:"noopener noreferrer"},a)},t.createElement("div",{className:"note"},r?t.createElement("button",{onClick:()=>{confirm("Are you sure you would like to delete this?")&&J.deleteRoomNote(o.id)},className:"link-styled-button note-delete"},"X"):"",o.message," ",t.createElement("br",null),t.createElement("button",{className:"link-styled-button like-button "+(s||!l?"liked":"unliked"),onClick:()=>{l&&(s?J.unlikeRoomNote(o.id):J.likeRoomNote(o.id))},"data-tip":d},c,s?t.createElement(I,null):t.createElement(C,null),t.createElement(D,null)),"-",t.createElement(De,{userId:o.authorId,id:`noteAuthor-${o.id}`})," ",t.createElement("br",null)))}const zt=["cockatrice","dragon","naga","skeleton","tengu","yak"];function _t(e){return e.likes?e.likes.length:0}function qt(e){const a=(e.notes||[]).sort(((e,t)=>{const a=e.likes?e.likes.length:0;return(t.likes?t.likes.length:0)-a})).map((e=>t.createElement(Bt,{key:e.id,note:e}))),n=e.noteWallData?e.noteWallData.noteWallDescription:"You are looking at a wall with space for people to place sticky notes.",o=e.noteWallData?e.noteWallData.addNoteLinkText:"add a note",r=e.user&&e.user.isMod?t.createElement("button",{onClick:()=>{confirm("Are you sure you want to delete all notes?")&&e.notes.map((e=>J.deleteRoomNote(e.id)))}},"Mod: Delete all notes"):"",l=e.user&&e.user.isMod?t.createElement("button",{onClick:()=>{if(confirm("This will assign the top 6 rooms to the unconferencing rooms, are you sure?")&&e.notes.length>0){const a=JSON.parse(JSON.stringify(e.serverSettings)),n=e.notes.sort(((e,t)=>_t(e)<_t(t)?1:-1)),o=[];for(var t=0;t<Math.min(n.length,zt.length);t++)o.push({text:`Unconference: ${n[t].message} in the ${zt[t]} room.`,roomId:zt[t]});a.happeningNowEntries=o.concat(a.happeningNowEntries),J.updateServerSettings(a)}}},"Mod: Set as unconferencing topics"):"";return t.createElement("div",null,r,l,t.createElement("div",{className:"note-wall-description"},n,t.createElement("br",null),t.createElement("br",null),"If you'd like, you can ",t.createElement("button",{onClick:()=>{const t=e.noteWallData?e.noteWallData.addNotePrompt:"What do you type on the note wall?",a=prompt(t);J.addNoteToWall(a)},id:"addNote",className:"link-styled-button"},o),"."),a)}Z=G("3Wbh2");const jt=e=>{const a=i(wa);o((()=>{function e(e){27===e.keyCode&&a(Z.HideModalAction())}return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}));const n=e=>{"modal-wrapper"!==e.target.id&&"close-button"!==e.target.id||a(Z.HideModalAction())};return c.createPortal(t.createElement("div",{id:"modal-wrapper",onClick:n,role:"dialog","aria-modal":!0},t.createElement("div",{id:"modal",className:e.fullScreen?"full-screen":null},t.createElement("button",{onClick:n,id:"close-button",className:"close"},"x"),e.children)),document.body)};Z=G("3Wbh2"),Z=G("3Wbh2");function Gt(e){const a=i(wa),n=e=>{const t="true"===e.target.value;a(Z.SetKeepCameraWhenMovingAction(t))};return t.createElement("div",{className:"videoAudioSettingsContainer"},t.createElement("form",{className:"form",id:"video-audio-selection-form"},t.createElement("label",{htmlFor:"video-audio-selection-form",className:"form-header"},"Video/Audio Options:"),t.createElement("div",{className:"radio"},t.createElement("input",{type:"radio",id:"keep-camera-when-moving",value:"true",checked:!0===e.keepCameraWhenMoving,onChange:n}),"Keep video/audio status when moving rooms"),t.createElement("div",{className:"radio"},t.createElement("input",{type:"radio",id:"keep-camera-when-moving",value:"false",checked:!1===e.keepCameraWhenMoving,onChange:n}),"Always leave video/audio when moving rooms")))}function Jt(e){const a=i(wa),{useSimpleNames:n}=i(Ia),[r,l]=t.useState("default");o((()=>{(async()=>{l(await le())})()}));const s=e=>{console.log(r,e.target.value),document.body.classList.replace(r,e.target.value),l(e.target.value),async function(e){await M.setItem(he,e)}(e.target.value)},c=e=>{a(Z.SetUseSimpleNamesAction(e))},d=e=>{"captions-enabled"===e.target.value?a(Z.SetCaptionsEnabledAction(!0)):"captions-disabled"===e.target.value&&a(Z.SetCaptionsEnabledAction(!1))};return t.createElement("div",{className:"settingsContainer"},t.createElement("div",{className:"form",id:"themeSelectionForm"},t.createElement("label",{htmlFor:"themeSelectionForm",className:"form-header"},"Select Theme:"),t.createElement("div",{className:"radio"},t.createElement("input",{type:"radio",id:"default-theme",value:"default",checked:"default"===r,onChange:s}),t.createElement("label",{htmlFor:"default-theme"},"Default (Dark)")),t.createElement("div",{className:"radio"},t.createElement("input",{type:"radio",id:"solarized-dark",value:"solarized-dark",checked:"solarized-dark"===r,onChange:s}),t.createElement("label",{htmlFor:"solarized-dark"},"Solarized Dark")),t.createElement("div",{className:"radio"},t.createElement("input",{type:"radio",id:"solarized-light",value:"solarized-light",checked:"solarized-light"===r,onChange:s}),t.createElement("label",{htmlFor:"solarized-light"},"Solarized Light"))),t.createElement("div",{className:"form",id:"simpleNamesSelectionForm"},t.createElement("label",{htmlFor:"simpleNamesSelectionForm",className:"form-header"},"Username Display Mode:"),t.createElement("div",{className:"radio"},t.createElement("label",null,t.createElement("input",{type:"radio",name:"simpleNameSelection",id:"useDefaultName",checked:!n,onChange:()=>c(!1)}),"Use Default Names (shows colors, fonts, and polymorph potion emojis)")),t.createElement("div",{className:"radio"},t.createElement("label",null,t.createElement("input",{type:"radio",name:"simpleNameSelection",id:"useSimpleName",checked:n,onChange:()=>c(!0)}),"Use Simple Names (text only)"))),t.createElement("div",{className:"form",id:"captionsEnabled"},t.createElement("label",{htmlFor:"captionsEnabled",className:"form-header",style:{marginBottom:0}},"Enable Captions (Experimental):"),t.createElement("span",{style:{marginBottom:"1em"}},"This will automatically transcribe spoken audio as messages in the text chat."),t.createElement("div",{className:"radio"},t.createElement("input",{type:"radio",id:"captions-enabled",value:"captions-enabled",checked:e.captionsEnabled,onChange:d}),t.createElement("label",{htmlFor:"captions-enabled"},"Enabled")),t.createElement("div",{className:"radio"},t.createElement("input",{type:"radio",id:"captions-disabled",value:"captions-disabled",checked:!e.captionsEnabled,onChange:d}),t.createElement("label",{htmlFor:"captions-disabled"},"Disabled"))),t.createElement(Gt,{keepCameraWhenMoving:e.keepCameraWhenMoving}))}Z=G("3Wbh2");function Zt(e){const a=i(wa),{prepareMediaDevices:n,cameras:r,mics:l,currentMic:s,setCurrentMic:c,currentCamera:d,setCurrentCamera:m,publishMedia:u,publishAudio:h,publishingCamera:p,publishingMic:g,unpublishMedia:y}=Te();o((()=>((async()=>{s||(await n(),console.log("Prepared for media chat"))})(),()=>{p&&g||y()})),[]);const E=e=>t.createElement("option",{value:e.id,key:e.id},e.name);let f;e.hideVideo||(f=t.createElement(t.Fragment,null,t.createElement("label",{htmlFor:"#video-select"},"Webcam"),t.createElement("select",{name:"Video",id:"video-select",onChange:e=>{m(e.target.value)},defaultValue:d&&d.id},(r||[]).map(E)),t.createElement("br",null)));return t.createElement("div",{id:"media-selector",style:{display:"flex","flex-direction":"column"}},t.createElement("div",null,e.hideVideo?"":t.createElement(Ct,{speaking:e.userIsSpeaking,hideUI:!0}),t.createElement("div",{className:"selects"},f,t.createElement("label",{htmlFor:"#audio-select"},"Audio"),t.createElement("select",{name:"Audio",id:"audio-select",onChange:e=>{c(e.target.value)},defaultValue:s&&s.id},(l||[]).map(E)))),t.createElement("div",null,t.createElement(Gt,{keepCameraWhenMoving:e.keepCameraWhenMoving})),t.createElement("button",{id:"join",onClick:()=>{a(Z.HideModalAction())}},"Use These Devices"))}function Kt(){return t.createElement("div",{id:"code-of-conduct"},t.createElement("p",null,"Our goal is to have a fun and welcoming celebration of roguelike games, so we have a formalized code of conduct that sets these expectations."),t.createElement("p",null,t.createElement("a",{href:"https://roguelike.club/code.html",target:"_blank",rel:"noreferrer"},"Read our Code of Conduct.")),t.createElement("p",null,"If you're being harassed, notice someone being harassed, or have any other concerns related to the code of conduct, you have a few options:"),t.createElement("ul",null,t.createElement("li",null,"Type ",t.createElement("code",null,"/mod")," into the chat box, followed by a message, to contact all moderators."),t.createElement("li",null,"Email ",t.createElement("a",{href:"mailto:contact@roguelike.club"},"contact@roguelike.club"),"."),t.createElement("li",null,"If you have a report or concern related to an organizer, please contact a different member of the ",t.createElement("a",{href:"https://roguelike.club/who.html",target:"_blank",rel:"noreferrer"},"organizing team")," outside of this tool (via email, Twitter DM, Discord, or some other service).")))}function Xt(e,t,a,n,o){return 1===t?{time:(r=e,new Date(`2021-10-16T${r}:00.000-07:00`)),text:a,roomIds:n,breakoutRoomId:o}:2===t?{time:(e=>new Date(`2021-10-17T${e}:00.000-07:00`))(e),text:a,roomIds:n,breakoutRoomId:o}:void console.error("Your static data is messed up, somehow.");var r}const Qt=[Xt("09:00",2,"Doors Open"),Xt("09:15",2,"Kickoff",["theater"]),Xt("09:30",2,"Michael Langford: For the Squishies ⚡ Making Roguelikes Accessible to (Younger) Children and their Parents",["theater"],"warrior"),Xt("09:45",2,"Younès Rabii: Pokemon Glitch - Story of A Roguelike With No Author",["theater"],"tourist"),Xt("10:00",2,"Sraëka-Lillian: Procedural Phonology: Generating Name Generators",["theater"],"rogue"),Xt("10:15",1,"Social Time"),Xt("10:30",2,"Unconferencing",["unconference"]),Xt("11:30",2,"Alice Lai: All Together Now: Creating Multiplicative Power in Hades",["theater"],"warrior"),Xt("12:00",2,"Brian Cronin: Off The Rails - Lessons Learned from Monster Train Development",["theater"],"rogue"),Xt("12:30",2,"Social Time"),Xt("13:30",2,"Chris McCormick: Building Juicy Minimal Roguelikes in the Browser",["theater"],"mage"),Xt("14:00",2,"Rich Wilson: Roguelikes, Immersive Sims, and the Church of the Simulation",["theater"],"rogue"),Xt("14:30",2,"Xalavier Nelson Jr.: Building an Economic Flesh Simulation Will Make You Disassociate from Reality",["theater"],"tourist"),Xt("15:00",2,"Social Time"),Xt("15:30",2,"Kristen Yu: Video Game Quest Theory for Improved Procedural Content Generation",["theater"],"mage"),Xt("16:00",2,"Ally Brinken & Michelle Webb, En Rogue: Who’s the Boss (And How and Why)?",["theater"],"warrior"),Xt("16:30",2,"John Harris: The Lost Roguelikes",["theater"],"rogue"),Xt("17:00",2,"Social Time"),Xt("17:30",2,"Nick McConnell: Things I've Learnt from Maintaining Angband",["theater"],"rogue"),Xt("17:45",2,"Nathan Savant: One Quest To Rule Them All: Quest Design in Non-Games Media",["theater"],"warrior"),Xt("18:00",2,"Noah Swartz: The Tombs of Atuan: The Original Roguelike?",["theater"],"mage"),Xt("18:15",2,"Social Time"),Xt("19:00",2,"Doors Close")];function ea(){const e=new Intl.DateTimeFormat("en",{hour:"numeric",minute:"numeric"}),a=e.resolvedOptions().timeZone,n=Qt.flatMap((a=>"Social Time"===a.text?[t.createElement("tr",{key:e.format(a.time)+"hr1"},t.createElement("th",{className:"break",colSpan:2},t.createElement("hr",null))),t.createElement("tr",{key:e.format(a.time)+"text"},t.createElement("td",{className:"time"},e.format(a.time)),t.createElement("td",{className:"segment"},"Social Time")),t.createElement("tr",{key:e.format(a.time)+"hr2"},t.createElement("th",{className:"break",colSpan:2},t.createElement("hr",null)))]:[t.createElement("tr",{key:e.format(a.time)},t.createElement("td",{className:"time"},e.format(a.time)),t.createElement("td",{className:"segment"},a.text))]));return t.createElement("div",{id:"Schedule"},t.createElement("h1",null,"Schedule"),t.createElement("p",null,"Times below should be in your local time zone. We believe your time zone is ",a,"."),t.createElement("table",null,t.createElement("tbody",null,n)))}function ta(){const e=pt.map((e=>t.createElement("tr",{key:e.type},t.createElement("td",null,e.invocations.join(", ")),t.createElement("td",null,e.description))));return t.createElement("div",null,t.createElement("h1",null,"Welcome!"),t.createElement("p",null,"Welcome to the Roguelike Celebration social space! This is an open-source chat app / virtual world built specifically for Roguelike Celebration."),t.createElement("p",null,"You can access this reference at any time by clicking the ",t.createElement("strong",null,"Help")," button in the left sidebar or by typing ",t.createElement("strong",null,"/help")," into the chat box."),t.createElement("p",null,"If you have questions, feedback, or need to report a code of conduct violation, you can contact us via the ",t.createElement("strong",null,"/mod")," command."),t.createElement("h2",null,"Command Reference"),t.createElement("p",null,"You can enter any of these commands by typing directly into the chat box."),t.createElement("table",null,e))}Z=G("3Wbh2"),K=G("1qZWk");function aa(e){const a=i(wa);return t.createElement("div",null,t.createElement("h1",null,"Map"),t.createElement("p",null,"Click on a room to move there!"),t.createElement("p",null,"If you find the map difficult to use, you can also view a ",t.createElement("button",{className:"link-styled-button",onClick:()=>{a(Z.ShowModalAction(K.Modal.RoomList))}},"list of all rooms"),"."),t.createElement(Ft,{roomData:e.roomData,currentRoomId:e.currentRoomId}))}Wt=G("1REsD");const na={callbacks:{signInSuccessWithAuthResult:function(e,t){const a=Wt.currentUser();return a.shouldVerifyEmail&&Wt.sendSignInLinkToEmail(a.email),!0}},signInOptions:[O.auth.EmailAuthProvider.PROVIDER_ID,O.auth.GoogleAuthProvider.PROVIDER_ID,O.auth.TwitterAuthProvider.PROVIDER_ID]};function oa(){return t.createElement("div",null,t.createElement("header",{role:"banner"},t.createElement("h1",null,"Welcome to Roguelike Celebration 2021!")),t.createElement("main",{role:"main"},t.createElement("p",null,"This is a social space for attendees of"," ",t.createElement("a",{href:"https://roguelike.club"},"Roguelike Celebration"),", a community-generated weekend of talks, games, and conversations about roguelikes and related topics, including procedural generation and game design. It's for fans, players, developers, scholars, and everyone else!"),t.createElement(W,{uiConfig:na,firebaseAuth:O.auth()}),t.createElement("p",null,"If you log in via email, we will require you to verify that email address."),t.createElement("p",null,"No matter which service you log in with, we do not access any data other than what is needed to authenticate you. If it would make you more comfortable, feel free to sign up for and use a throwaway account on one of these services."),t.createElement("p",null,"After logging in, you will have the opportunity to pick whatever chat handle you would like before entering the space."),t.createElement("p",null,"By entering the space, you agree to our"," ",t.createElement("a",{href:"https://roguelike.club/code.html"},"Code of Conduct"),".")))}function ra(e){return t.createElement("div",null,t.createElement("h1",null,"This isn't a normal chat app!"),t.createElement("p",null,"In the Roguelike Celebration conference space, you can only send/receive messages ",t.createElement("strong",null,"in the chat room you are currently in"),"."),t.createElement("p",null,"You can move from virtual room to virtual room to talk to different people."),t.createElement("p",null,"You may see or hear others on videochat, but they can't see or hear you unless you explicitly turn on your audio or video."),t.createElement("p",null,"Our hope is to facilitate smaller group conversations, to capture the feel of an in-person conference, and to give you a fun and playful space to explore with your fellow attendees."),t.createElement("p",null,"Happy wandering, and be wary of reading scrolls without identifying them first ;)"),t.createElement("p",null,"-The Roguelike Celebration team"))}function la(){return t.createElement("div",{id:"go-home"},t.createElement("h1",null,"A magical force repels you from the entrance"),t.createElement("p",null,"Roguelike Celebration is currently closed! Check the ",t.createElement("a",{href:"https://roguelike.club/event2021.html",target:"_blank",rel:"noreferrer"},"schedule")," to see when our doors will be open again."),t.createElement("p",null,"We look forward to celebrating again with you soon :)"))}function ia(){return t.createElement("div",{id:"you-are-banned"},t.createElement("h1",null,"You are banned"),t.createElement("p",null,"You have been banned from the social space. If you believe you have been banned in error, please email ",t.createElement("b",null,"contact at roguelike.club"),"."))}J=G("3Loy2");function sa(e){const a=e.rooms.map((e=>e.hidden?"":t.createElement(ca,{room:e,key:`room-sidebar-${e.id}`})));return t.createElement("div",null,t.createElement("h1",null,"List of Rooms"),t.createElement("ul",null,a))}const ca=e=>{const{room:a}=e,n=a.users?`(${a.users.length})`:"",o=a.videoUsers&&a.videoUsers.length>0?t.createElement(f,null):"";return t.createElement("li",{style:{listStyle:"none"}},t.createElement("button",{onClick:()=>{J.moveToRoom(a.id)},className:"link-styled-button"},t.createElement("strong",null,a.displayName)," ",n," ",o))};J=G("3Loy2");function da(e){const[a,n]=l(JSON.stringify(e.serverSettings,null,2)),[o,r]=l(""),[i,s]=l(""),[c,d]=l(""),m=()=>{let e;try{e=function(e){try{return void 0===e.movementMessagesHideThreshold||void 0===e.movementMessagesHideRoomIds||e.happeningNowEntries&&!e.happeningNowEntries.every(X)?(console.log("Returning null in toServerSettings"),null):{movementMessagesHideThreshold:e.movementMessagesHideThreshold,movementMessagesHideRoomIds:e.movementMessagesHideRoomIds,happeningNowEntries:e.happeningNowEntries||[],spaceIsClosed:!!e.spaceIsClosed}}catch(e){return console.log("Error in toServerSettings",e),null}}(JSON.parse(a))}catch(e){return void alert("JSON parse error: "+e.toString())}e?J.updateServerSettings(e):alert("New settings were valid json but had invalid properties, please check for typos!")};return t.createElement("div",{className:"serverSettingsContainer"},t.createElement("button",{onClick:async()=>{confirm("Are you sure you'd like to reset room data?")&&await J.resetRoomData()}},"Reset Room Data"),t.createElement("h1",null,"Happening Now Controls"),t.createElement("h2",null,"Current Entries"),e.serverSettings.happeningNowEntries.map((a=>t.createElement("li",{key:a.text},JSON.stringify(a),t.createElement("button",{id:"delete-"+a.text,onClick:()=>(t=>{if(confirm("Are you sure you want to delete the happening now note?")){const a=JSON.parse(JSON.stringify(e.serverSettings));a.happeningNowEntries=e.serverSettings.happeningNowEntries.filter((e=>e.text!==t.text)),J.updateServerSettings(a)}})(a)},"Delete")))),t.createElement("div",{className:"form",id:"addHappeningNowForm"},t.createElement("div",{className:"field"},t.createElement("label",{htmlFor:"add-happening-now-text"},"Text"),t.createElement("input",{type:"text",id:"add-happening-now-text",value:o,onChange:e=>r(e.currentTarget.value)})),t.createElement("div",{className:"field"},t.createElement("label",{htmlFor:"add-happening-now-room-id"},"Room ID (blank if you want to link to an external site)"),t.createElement("input",{type:"text",id:"add-happening-now-room-id",value:i,onChange:e=>s(e.currentTarget.value)})),t.createElement("div",{className:"field"},t.createElement("label",{htmlFor:"add-happening-now-external-link"},"External Link (blank if you want to link to a room)"),t.createElement("input",{type:"text",id:"add-happening-now-external-link",value:c,onChange:e=>d(e.currentTarget.value)})),t.createElement("button",{id:"add-entry",onClick:()=>{if(0===o.length)return void alert("You need to have text!");if(i.length>0&&c.length>0)return void alert("You cannot have roomId and external link");if(i.length>0&&!e.roomData[i])return void alert("No such room as "+i);const t=JSON.parse(JSON.stringify(e.serverSettings));t.happeningNowEntries.push({text:o,roomId:i.length>0?i:void 0,externalLink:c.length>0?c:void 0}),J.updateServerSettings(t)},className:"submit"},"Add Entry")),t.createElement("h1",null,"Manual Controls (Finnicky)"),t.createElement("h3",{id:"old-settings-header"},"Old settings:"),t.createElement("pre",{id:"old-settings-pretty"},JSON.stringify(e.serverSettings,null,2)),t.createElement("h3",{id:"new-settings-header"},"New settings:"),t.createElement("div",{className:"form",id:"serverSettingsForm"},t.createElement("textarea",{id:"new-settings-textarea",defaultValue:a,cols:50,rows:30,onChange:e=>n(e.currentTarget.value)}),t.createElement("button",{onClick:e=>{m()},className:"submit"},"Save Changes")))}function ma(){return t.createElement("div",{id:"client-deployed"},t.createElement("h1",null,"New Version Available!"),t.createElement("p",null,"We just updated the social space with new features and bugfixes!"),t.createElement("p",null,"Please reload this page whenever is convenient so you can be running the latest code."),t.createElement("button",{onClick:()=>window.location.reload()},"Reload"))}Z=G("3Wbh2"),J=G("3Loy2");const ua=[...Qt].reverse();function ha(e){const a=i(wa),n=new Date,o=ua.findIndex((e=>e.time<n)),r=ua[o],l=t=>{e.roomData[t]?(J.moveToRoom(t),a(Z.HideModalAction())):console.error("Can't go to room "+t+" from link in happening now view, no such room!")};let s;if(r)if("Social Time"===r.text){var c=o+1;const a=[];for(;ua[c]&&ua[c].breakoutRoomId;){const n=ua[c],o=n.breakoutRoomId,r=`Discuss ${n.text} in `;a.push(t.createElement("li",{key:o},r,t.createElement("button",{id:`button-happening-now${o}`,onClick:()=>l(o),className:"link-styled-button"},e.roomData[o]?e.roomData[o].displayName:"unknown room"))),c++}a.push(t.createElement("li",{key:"option-chat"},"Chat!")),a.push(t.createElement("li",{key:"option-explore"},"Explore the space!")),a.push(t.createElement("li",{key:"option-hunt"},"Hunt for secrets!")),a.push(t.createElement("li",{key:"option-free"},"Just remember to beware the grues.")),s=t.createElement("div",{id:"currently-scheduled-div"},t.createElement("strong",null,"Social Time"),t.createElement("ul",null,a))}else s=t.createElement("div",{id:"currently-scheduled-div"},r.text,r.roomIds?(d=r.roomIds,t.createElement("ul",null,d.map((a=>t.createElement("li",{key:a},t.createElement("button",{id:`button-happening-now${a}`,onClick:()=>l(a),className:"link-styled-button"},e.roomData[a]?e.roomData[a].displayName:"unknown room")))))):"");else s=t.createElement("strong",null,"You're in early! Check the schedule for when the doors officially open.");var d;return t.createElement("div",{id:"happening-now"},t.createElement("h1",null,"Happening Now"),t.createElement("h2",null,"From The Schedule"),s,t.createElement("h2",null,"Other Live Activities"),t.createElement("ul",null,e.entries.map((e=>e.roomId?t.createElement("li",{key:e.text},t.createElement("button",{id:`button-${e.text}`,onClick:()=>l(e.roomId),className:"link-styled-button"},e.text)):e.externalLink?t.createElement("li",{key:e.text},t.createElement("a",{className:"nav-item",href:e.externalLink,target:"_blank",rel:"nofollow noopener noreferrer"},e.text)):t.createElement("li",{key:e.text},e.text)))))}Z=G("3Wbh2"),Wt=G("1REsD");function pa(e){const a=e.dispatch;return t.createElement(L,{onChange:e=>{const t=Wt.currentUser();e&&t&&!t.shouldVerifyEmail&&a(Z.AuthenticateAction(t.id,t.id,t.providerId,!1))}},t.createElement("div",null,t.createElement("header",{role:"banner"},t.createElement("h1",null,"Please verify your email!")),t.createElement("main",{role:"main"},t.createElement("p",null,"You're currently attempting to log in as ",t.createElement("strong",null,e.userEmail),", but your email is not yet verified. Please follow the link in your email to complete the registration process."),t.createElement("p",null,t.createElement("strong",null,"If you have verified your email and this page has not automatically logged you in, please refresh the page manually.")),t.createElement("button",{onClick:t=>{Wt.sendSignInLinkToEmail(e.userEmail)}},"Resend Verification Email"),t.createElement("br",null),t.createElement("button",{onClick:()=>{Wt.signOut().then((()=>{a(Z.AuthenticateAction(void 0,void 0,void 0,void 0))}))}},"Use a Different Provider or Email"))))}function ga(){const e=O.auth().currentUser;return e.emailVerified||O.auth().signInWithEmailLink(e.email,window.location.href).then((()=>{window.location.reload()})),e.emailVerified?t.createElement("div",null,t.createElement("header",{role:"banner"},t.createElement("h1",null,"Your email has been successfully verified!")),t.createElement("main",{role:"main"},t.createElement("p",null,"You may now close this window and go back to the main app."))):t.createElement("div",null,t.createElement("header",{role:"banner"},t.createElement("h1",null,"Attempting to verify email.")),t.createElement("main",{role:"main"},t.createElement("p",null,"Please wait while your email is verified.")))}function ya(e){const a=e.riddles.map((function(e,a){return t.createElement("p",{className:"riddle",key:"riddle-"+a},e)})),n=e.riddles.length>1?"The engraved riddles read...":"The engraved riddle reads...";return t.createElement("div",{id:"riddle-modal",className:"riddle-div"},t.createElement("h1",null,n),a)}Z=G("3Wbh2"),J=G("3Loy2"),Z=G("3Wbh2"),J=G("3Loy2");let Ea,fa;async function va(){await Ea.stopContinuousRecognitionAsync()}const ba=e=>{const t=i(wa),[n,r]=l(),[s,c]=l(),[d,m]=l(),[u,h]=l(!1),[p,g]=l(!0),[y,E]=l(!0),[f,v]=l([]),[b,w]=l([]),[k,I]=l(),[C,M]=l(),[S,A]=l(),[T,N]=l(),[D,x]=l(),[R,O]=l(),[W,L]=l(),[z,_]=l(),q=()=>{k&&async function(e,t){if(console.log("Starting recognition"),Ea&&await Ea.stopContinuousRecognitionAsync(),!fa){const{cognitiveServicesKey:e,cognitiveServicesRegion:t}=await J.fetchCognitiveServicesKey();fa=U.fromSubscription(e,t)}const a=Y.fromMicrophoneInput(e);Ea=new V(fa,a),Ea.recognizing=(e,t)=>{console.log("RECOGNIZING: ",t.result.text)},Ea.recognized=(e,a)=>{a.result.reason===$.RecognizedSpeech?(console.log(`RECOGNIZED: Text=${a.result.text}`),""!==a.result.text&&t(Z.SendCaptionAction(a.result.text))):a.result.reason===$.NoMatch&&console.log("NOMATCH: Speech could not be recognized.")},Ea.canceled=(e,t)=>{console.log(`CANCELED: Reason=${t.reason}`),t.reason===B.Error&&(console.log(`"CANCELED: ErrorCode=${t.errorCode}`),console.log(`"CANCELED: ErrorDetails=${t.errorDetails}`),console.log("CANCELED: Did you update the subscription info?")),Ea.stopContinuousRecognitionAsync()},Ea.sessionStopped=(e,t)=>{console.log("\n    Session stopped event."),Ea.stopContinuousRecognitionAsync()},Ea.startContinuousRecognitionAsync()}(k.id,t)},j=()=>{va()},G=async()=>{d&&(t(Z.StartVideoChatAction()),N(!0),W&&(d.localParticipant.publishTrack(W),await W.restart(),q()))},K=()=>{d&&(A(!0),R&&(R.restart(),R.enable(!0),d.localParticipant.publishTrack(R),z||_(a(St,{track:R}))))},X=()=>{console.log("In unpublish",R),t(Z.StopVideoChatAction()),A(!1),N(!1),W&&(W.stop(),va(),d&&d.localParticipant.unpublishTrack(W)),R&&(R.stop(),R.detach(),R.disable(),R.mediaStreamTrack.stop(),d&&d.localParticipant.unpublishTrack(R))};async function Q(o,r){if(e.active)if(n){if(!d||d.name!==o){d&&d.name!==o&&d.disconnect();try{const e={name:o,tracks:[],maxAudioBitrate:16e3,bandwidthProfile:{video:{mode:"grid",maxTracks:10,renderDimensions:{high:{height:1080,width:1920},standard:{height:720,width:1280},low:{height:176,width:144}}}},preferredVideoCodecs:[{codec:"VP8",simulcast:!0}],dominantSpeaker:!0};r&&R&&e.tracks.push(R),r&&W&&e.tracks.push(W),m(void 0);const l=await F(n,e);h(!1),l.on("dominantSpeakerChanged",(e=>{t(e?Z.MediaReceivedSpeakingDataAction(e.identity):Z.MediaReceivedSpeakingDataAction(null))})),l.localParticipant.videoTracks.forEach((e=>{y?e.track.enable():e.track.disable()})),l.localParticipant.audioTracks.forEach((e=>{p?e.track.enable():e.track.disable()})),console.log("[TWILIO] In room?",l),console.log("[TWILIO] Attached participant count:",l.participants.size),_(a(Tt,{participant:l.localParticipant,displayVideo:y,displayAudio:p})),x(l.participants),l.on("trackPublished",((e,a)=>{t(Z.RefreshReactAction())})),l.on("trackUnpublished",((e,a)=>{t(Z.RefreshReactAction())})),l.on("participantConnected",(()=>{x(l.participants),t(Z.RefreshReactAction())})),l.on("participantDisconnected",(()=>{x(l.participants),t(Z.RefreshReactAction())})),window.addEventListener("beforeunload",(e=>{l.disconnect()})),m(l)}catch(e){console.log("[TWILIO] Could not connect to room",e),_(null),h(!0)}}}else c(o);else console.warn("joinCall was called while text-only mode was on")}return o((()=>{e.active&&(console.log("[TWILIO] In useeffect for camera"),C&&(console.log("[TWILIO] Has camera"),(async()=>{console.log("[TWILIO] Fetching local video track");const e={height:720,frameRate:24,width:1280};C&&(e.deviceId={exact:C.id});const t=await P(e);O(t),_(a(St,{track:t})),S&&K()})()))}),[C]),o((()=>{e.active&&k&&(async()=>{if(W)return W;const e={};k&&(e.audio={deviceId:k.id});const t=await H(e);L(t)})()}),[k]),o((()=>{e.active&&(p?q():j())}),[p]),o((()=>{e.active&&(console.log("[TWILIO] In token roomId useEffect"),n&&s&&!d&&(console.log("[TWILIO] Joining room"),Q(s,!0)))}),[n,s]),a(Ae.Provider,{value:{prepareForMediaChat:async function(){if(!n)return J.fetchTwilioToken().then((e=>{r(e)}))},prepareMediaDevices:async function(){const e=e=>(console.log(e),{id:e.deviceId,name:e.label});try{(await navigator.mediaDevices.getUserMedia({video:!0,audio:!0})).getTracks().forEach((e=>e.stop())),await navigator.mediaDevices.enumerateDevices().then((t=>{console.log("[TWILIO] Fetched devices");const a=t.filter((e=>"videoinput"===e.kind)).map(e),n=t.filter((e=>"audioinput"===e.kind)).map(e);v(a),w(n),console.log("[TWILIO] Setting current camera",a[0]),M(a[0]),I(n[0])}))}catch(e){console.log("[TWILIO] Error fetching media devices",e),alert("We couldn't fetch your audio and video devices. This usually means another application is using your primary webcam or mic. Close anything that might be accessing them and try again. If that fails, confirm you haven't denied webcam/mic permission to this website in your browser."),t(Z.HideModalAction())}},cameras:f,mics:b,currentMic:k,currentCamera:C,publishingCamera:S,publishingMic:T,setCurrentCamera:async e=>(console.log(`[TWILIO] Setting current camera from ${C.id} (${C.name}) to ${e}`),C&&C.id!==e&&(console.log("[TWILIO] Removing old camera",d),R.stop(),d&&(t(Z.StopVideoChatAction()),X())),M(f.find((t=>t.id===e))),R.restart(),null),setCurrentMic:e=>(k&&k.id!==e&&(W.stop(),d&&(t(Z.StopVideoChatAction()),X())),I(b.find((t=>t.id===e))),W.restart(),null),localStreamView:z,publishMedia:()=>{d&&(G(),K())},unpublishMedia:X,publishAudio:G,inCall:!!d,joinCallFailed:u,joinCall:Q,leaveCall:function(){console.log("[TWILIO] In leave call",R),d&&d.disconnect(),R&&R.stop(),W&&W.stop(),j()},callParticipants:D,micEnabled:p,setMicEnabled:e=>{g(e),d&&d.localParticipant.audioTracks.forEach((t=>{e?t.track.enable():t.track.disable()}))},cameraEnabled:y,setCameraEnabled:e=>{E(e),d&&d.localParticipant.videoTracks.forEach((t=>{e?t.track.enable():t.track.disable()}))}}},e.children)};Wt=G("1REsD");const wa=n(null),ka=n(null),Ia=n(null),Ca=n(null),Ma=n(null);var Sa=()=>{const[e,a]=It.useReducerWithThunk(ft,Et);o((()=>{Wt.onAuthenticationStateChange((async e=>{if(e)if(e.shouldVerifyEmail){const t=e.id,n=e.providerId;a(Z.AuthenticateAction(t,t,n,!0))}else{const e=Wt.currentUser(),t=e.id,n=e.providerId,{registeredUsername:o,spaceIsClosed:r,isMod:l,isBanned:i}=await J.checkIsRegistered();if(!o){const o=e.email?t:e.displayName;return void a(Z.AuthenticateAction(t,o,n,!1))}if(a(Z.AuthenticateAction(t,o,n,!1)),i)return a(Z.PlayerBannedAction({id:t,username:o,isBanned:i})),void a(Z.IsRegisteredAction());if(r&&(a(Z.SpaceIsClosedAction()),!l))return void a(Z.IsRegisteredAction());const s=await async function(){try{const e=await M.getItem(ce),t=await M.getItem(se),a=await M.getItem(de);if(e&&(new Date).getTime()-e.getTime()<36e5)return console.log(t,a),{messages:t,whispers:a}}catch(e){console.log("Storage error",e)}}();s&&a(Z.LoadMessageArchiveAction(s.messages,s.whispers));const c=await async function(){return await M.getItem(pe)||!1}();a(Z.SetUseSimpleNamesAction(c));const d=await async function(){const e=await M.getItem(ge);return null!==e&&e}();a(Z.SetKeepCameraWhenMovingAction(d));const m=await async function(){const e=await M.getItem(ye);return null!=e&&e}();a(Z.SetTextOnlyModeAction(m,!1));const u=await async function(){const e=await M.getItem(Ee);return null!=e&&e}();a(Z.SetCaptionsEnabledAction(u)),a(Z.IsRegisteredAction()),J.connect(t,a),J.getServerSettings(a),window.addEventListener("resize",(()=>{}));const p=()=>{const e=document.getElementById("main");if(e){const t=Math.floor(e.clientWidth/180)-1;a(Z.SetNumberOfFacesAction(t))}else console.warn("Attempted to call onResize when 'main' element was null; will default to show no faces")};setTimeout(p,2e3),window.addEventListener("resize",h.throttle(p,100,{trailing:!0}))}else a(Z.AuthenticateAction(void 0,void 0,void 0,void 0))}))}),[]);const n=window.outerWidth<500,r=e.visibleProfile?t.createElement(kt,{user:e.visibleProfile,whispers:e.whispers}):"";if(Wt.currentUser()&&Wt.currentUser().isSignInWithEmailLink(window.location.href))return t.createElement(ga,null);if(!e.checkedAuthentication)return t.createElement("div",null);if(e.checkedAuthentication&&e.mustVerifyEmail)return t.createElement(pa,{userEmail:Wt.currentUser().email,dispatch:a});if(e.checkedAuthentication&&!e.authenticated)return t.createElement(oa,null);if(!e.hasRegistered)return t.createElement(Ot,{isFTUE:!0,defaultHandle:e.userMap[e.userId].username,user:e.profileData,prepopulateTwitterWithDefaultHandle:"twitter"===e.authenticationProvider});if(e.isClosed&&!e.userMap[e.userId].isMod)return t.createElement(la,null);if(e.isBanned)return t.createElement(ia,null);let l,i,s;e.roomData&&e.roomId&&e.roomData[e.roomId]&&e.roomData[e.roomId].mediaChat&&(l=t.createElement(xt,{visibleSpeakers:e.visibleSpeakers,currentSpeaker:e.currentSpeaker,numberOfFaces:e.numberOfFaces,inMediaChat:e.inMediaChat,textOnlyMode:e.textOnlyMode,audioOnlyMode:e.audioOnlyMode,currentUser:e.userMap[e.userId]}));let c=!1;switch(e.activeModal){case K.Modal.ProfileEdit:i=t.createElement(Ot,{isFTUE:!1,defaultHandle:e.userMap[e.userId].username,user:e.profileData});break;case K.Modal.NoteWall:{const a=e.roomData[e.roomId];i=t.createElement(qt,{notes:a.notes,noteWallData:a.noteWallData,user:e.profileData,serverSettings:e.serverSettings});break}case K.Modal.Settings:i=t.createElement(Jt,{keepCameraWhenMoving:e.keepCameraWhenMoving,captionsEnabled:e.captionsEnabled});break;case K.Modal.MediaSelector:console.log("Opening media selector"),i=t.createElement(Zt,{showJoinButton:!e.inMediaChat||e.activeModalOptions.showJoinButton,hideVideo:e.activeModalOptions.hideVideo,userIsSpeaking:!1,roomId:e.roomId,keepCameraWhenMoving:e.keepCameraWhenMoving});break;case K.Modal.CodeOfConduct:i=t.createElement(Kt,null);break;case K.Modal.Schedule:i=t.createElement(ea,null);break;case K.Modal.Map:c=!0,i=t.createElement(aa,{roomData:e.roomData,currentRoomId:e.roomId});break;case K.Modal.RoomList:i=t.createElement(sa,{rooms:Object.values(e.roomData)});break;case K.Modal.Help:i=t.createElement(ta,null);break;case K.Modal.Welcome:i=t.createElement(ra,null);break;case K.Modal.ServerSettings:i=t.createElement(da,{serverSettings:e.serverSettings,roomData:e.roomData});break;case K.Modal.ClientDeployed:i=t.createElement(ma,null);break;case K.Modal.HappeningNow:i=t.createElement(ha,{roomData:e.roomData,entries:e.serverSettings.happeningNowEntries});break;case K.Modal.FeatureRainbowGate:i=t.createElement(ve,null);break;case K.Modal.FeatureDullDoor:i=t.createElement(we,null);break;case K.Modal.FeatureFullRoomIndex:i=t.createElement(Ie,{rooms:Object.values(e.roomData)});break;case K.Modal.Riddles:{const a=e.roomData[e.roomId];i=t.createElement(ya,{riddles:a.riddles});break}}i&&(s=t.createElement(jt,{fullScreen:c},i));const d=!n||e.mobileSideMenuIsVisible;return t.createElement(m.Provider,{value:{style:{verticalAlign:"middle"}}},t.createElement(wa.Provider,{value:a},t.createElement(ba,{active:!e.textOnlyMode},t.createElement(Ca.Provider,{value:n},t.createElement(Ia.Provider,{value:{useSimpleNames:e.useSimpleNames}},t.createElement(ka.Provider,{value:{userMap:e.userMap,myId:e.userId}},t.createElement(Ma.Provider,{value:e.roomData},t.createElement("div",{id:e.visibleProfile&&!n?"app-profile-open":"app"},d?t.createElement("span",null,t.createElement(Vt,{roomData:e.roomData,currentRoomId:e.roomId,username:e.userMap[e.userId].username,spaceIsClosed:e.isClosed}),t.createElement("div",{id:"side-nav-placeholder"})):t.createElement("button",{id:"show-menu",onClick:()=>{a(Z.ShowSideMenuAction())}},t.createElement("span",{role:"img","aria-label":"menu"},"🍔")),s,t.createElement("div",{id:"main",role:"main"},e.roomData[e.roomId]?t.createElement(Re,{room:e.roomData[e.roomId],userId:e.userId,roomData:e.roomData,inMediaChat:e.inMediaChat,keepCameraWhenMoving:e.keepCameraWhenMoving,textOnlyMode:e.textOnlyMode,mediaChatView:l,hasDismissedAModal:e.hasDismissedAModal}):null,t.createElement(ct,{messages:e.messages,autoscrollChat:e.autoscrollChat,serverSettings:e.serverSettings,captionsEnabled:e.captionsEnabled}),t.createElement(dt,{prepopulated:e.prepopulatedInput,sendMessage:e=>a(Z.SendMessageAction(e))})),r))))))))};window.addEventListener("DOMContentLoaded",(async()=>{d(a(Sa,null),document.getElementById("root")),document.body.classList.add(await le())}));
//# sourceMappingURL=index.4dfe685f.js.map

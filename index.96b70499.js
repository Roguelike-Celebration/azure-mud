require("./admin.b076059f.js"),require("./admin.5e70d957.css"),require("./stream.02c296a4.css");var e=require("react"),t=j(e),{createElement:n,createContext:a,useEffect:o,useRef:r,useState:l,useContext:i}=e,s=require("react-dom"),c=j(s),{render:d}=s,{IconContext:m}=require("react-icons/lib"),u=j(require("lodash")),{FaChevronDown:p,FaChevronUp:h,FaVolumeUp:g,FaVideo:y,FaVolumeMute:E,FaUser:f,FaVideoSlash:v,FaCog:b,FaThumbsUp:w,FaRegThumbsUp:k}=require("react-icons/fa"),I=j(require("localforage")),{v4:C}=require("uuid"),{ContextMenuTrigger:M,MenuItem:S,ContextMenu:N}=require("react-contextmenu"),A=j(require("react-tooltip")),{RainwayChannelMode:T,RainwayPeerState:D,RainwayRuntime:x,InputLevel:R}=require("@rainway/web"),{Rainway:O}=require("@rainway/react"),W=j(require("react-linkify")),{emojify:L}=require("node-emoji"),P=j(require("firebase/app")),F=j(require("react-firebaseui/StyledFirebaseAuth"));require("firebase/auth");var H=j(require("react-page-visibility")),{createLocalAudioTrack:U,createLocalVideoTrack:$,connect:V}=require("twilio-video"),{CancellationReason:Y,SpeechConfig:B,AudioConfig:q,ResultReason:z,SpeechRecognizer:_}=require("microsoft-cognitiveservices-speech-sdk");function j(e){return e&&e.__esModule?e.default:e}var G="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},J={},K={},Z=G.parcelRequire4f3a;null==Z&&((Z=function(e){if(e in J)return J[e].exports;if(e in K){let t=K[e];delete K[e];let n={id:e,exports:{}};return J[e]=n,t.call(n.exports,n,n.exports),n.exports}var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}).register=function(e,t){K[e]=t},G.parcelRequire4f3a=Z);var X=Z("3Loy2"),Q=Z("3Wbh2"),ee=Z("1qZWk");function te(e){return e.text&&("string"==typeof e.text||e.text instanceof String)&&e.roomId?"string"==typeof e.roomId||e.roomId instanceof String:!e.externalLink||("string"==typeof e.externalLink||e.externalLink instanceof String)}var ne,ae,oe,re;(ae=ne||(ne={})).Blue="Blue",ae.Cyan="Cyan",ae.Green="Green",ae.Magenta="Magenta",ae.Orange="Orange",ae.Red="Red",ae.Violet="Violet",ae.Yellow="Yellow",(re=oe||(oe={})).Comic="Comic",re.Classic="Classic",re.Impactful="Impactful";Q=Z("3Wbh2"),ee=Z("1qZWk");async function le(e,t){await I.setItem(me,e),await I.setItem(ue,t||new Date)}async function ie(){return await I.getItem(he)||0}async function se(e){await I.setItem(ge,e)}async function ce(){return await I.getItem(ye)||"default"}async function de(e){await I.setItem(ve,e)}const me="messages",ue="messageTimeStamp",pe="whispers",he="FeatureRainbowGateVisited",ge="WasColoredEntering",ye="UserSelectedTheme",Ee="UseSimpleNames",fe="KeepCameraWhenMoving",ve="TextOnlyMode",be="CaptionsEnabled",we=()=>{const e=t.useContext(An);return t.createElement("div",{id:"rainbow-gate-div",className:"feature-room-view"},t.createElement("p",null,"Do you, in fact, approach the chair? ",t.createElement("button",{id:"rainbow-gate-button",className:"link-styled-button",onClick:async()=>{await async function(){const e=await ie()+1;return await I.setItem(he,e),e}();e(Q.UpdateProfileColorAction(function(e){const t=Object.values(e);return t[Math.floor(Math.random()*t.length)]}(ne))),e(Q.ShowModalAction(ee.Modal.FeatureRainbowGate))}},"Approach the chair.")))};function ke(){const{userMap:e,myId:n}=i(Tn),[a,r]=l(0);return o((()=>{(async()=>{r(await ie())})()}),[]),1===a?t.createElement("div",null,t.createElement("h1",null,"It's a miracle of modern science!"),t.createElement("p",null,"\"Oho! Why, you've arrived just in time for the most amazing experience you'll ever... experience! Just sit in this chair, pull that lever, and you'll in for a truly eye-opening journey. Why, it's a miracle of modern science!\""),t.createElement("p",null,"You sit in the chair (it's not especially comfortable and it's... slightly wet?) and pull the lever. There's a shudder as the machine rumbles to life and things start happening. Gears spin, lightning arcs up two metal trusses you hadn't noticed. Your hair begins to stand on end. The doctor (you didn't see any diplomas, so who's to say?) starts to cackle wildly, yelling, \"It works! It WORKS!\" to no one in particular. The machine's hum hits a crescendo when suddenly everything comes to a stop. All is silence. You wait for a moment when you hear a buzz above you."),t.createElement("p",null,'Looking up, you see a mechanical arm holding a bucket extend out and rotate, spilling a bucket of paint all over you. "Yes!" yells the doctor (?) "They said it couldn\'t be done! Now... if you\'ll excuse me, I need to clean the paint off the chair." They hold up a sponge and bucket of water and gesture at you to make yourself scarce.'),t.createElement("p",null,t.createElement("em",null,"Your chat name color is now ",t.createElement("span",{className:`name ${e[n].nameColor}`},e[n].nameColor)),".")):t.createElement("div",null,t.createElement("h1",null,"Back for more?"),t.createElement("p",null,'The ambiguously credentialed operator gives you a nod. "Back for more, huh? Er, wait, no. I mean... *ahem* So! You\'ve returned for another glimpse at the uncanny realities beyond human perception! Well sit right down and pull yon lever, my friend." They floridly gesture to the chair at the center of the paint-dumping apparatus.'),t.createElement("p",null,'You pull the lever and nothing appears to happen. Then the machine operator runs up with a bucket of paint and spills it all over you. "So sorry, we only have the aetheric budget to do the big show once per person. Grant writing, am I right?" They look you over. "You know, you don\'t look that different to me, but what do I know?" They tap the multi-lensed googles obscuring most of their face. "With these things on it\'s a wonder I can see at all. Everything is coming through like an original Game Boy screen."'),t.createElement("p",null,t.createElement("em",null,"Your chat name color is now ",t.createElement("span",{className:`name ${e[n].nameColor}`},e[n].nameColor)),"."))}Q=Z("3Wbh2"),ee=Z("1qZWk");const Ie=()=>{const e=t.useContext(An),{userMap:n,myId:a}=i(Tn),o=n[a];return t.createElement("div",{id:"dull-door-div",className:"feature-room-view"},t.createElement("p",null,'Inside the glass tube there\'s nothing in particular, though you note that there\'s a grate on the floor. A damp sign next to the tube\'s opening says "Secondarily-Hydrogenated Oxygen Weighted Emulsion Remover". A smaller sign below that reads "For Dirts, Dyes, and Distress!" ',t.createElement("button",{id:"dull-door-button",className:"link-styled-button",onClick:()=>{o.nameColor?se(!0):se(!1),e(Q.ShowModalAction(ee.Modal.FeatureDullDoor))}},"Step on the grate"),"."))};function Ce(){const e=t.useContext(An),[n,a]=l(!1);o((()=>{(async()=>{a(await async function(){return await I.getItem(ge)||!1}())})()}),[]);return n?t.createElement("div",null,t.createElement("h1",null,"Could be refreshing?"),t.createElement("p",null,"You tentatively press a toe onto the grate. Suddenly the machine gurgles and from openings the top of the tube, warm Secondarily-Hydrogenated Oxygen (miracle of the modern age!) streams down! It certainly seems like any Dirts, Dyes, or Distress you may have accrued will be washed away if you step in fully. It'll probably be refreshing, but it will ",t.createElement("em",null,"definitely")," take the paint from the doctor(?) with it."),t.createElement("p",null,t.createElement("strong",null,"Fully enter the S.H.O.W.E.R.?")),t.createElement("button",{id:"dull-door-agree",onClick:()=>{e(Q.UpdateProfileColorAction(null)),e(Q.HideModalAction())}},"Enter"),t.createElement("button",{id:"dull-door-agree",onClick:()=>{e(Q.HideModalAction())}},"Leave")):t.createElement("div",null,t.createElement("h1",null,"Refreshing!"),t.createElement("p",null,"As you step into the tube, the grating beneath you depresses and clicks. Suddenly the machine gurgles and from openings the top of the tube, warm Secondarily-Hydrogenated Oxygen (miracle of the modern age!) streams down on you and rinses any Dirts, Dyes, or Distress you may have accrued away. It's soothing, in its own odd way, but you aren't sure this so-called S.H.O.W.E.R. will catch on with the masses."))}Q=Z("3Wbh2"),ee=Z("1qZWk");const Me=()=>{const e=t.useContext(An);return t.createElement("div",{id:"full-room-index-div",className:"feature-room-view"},t.createElement("button",{id:"full-room-index-button",onClick:()=>{e(Q.ShowModalAction(ee.Modal.FeatureFullRoomIndex))}},"Read the book"))};function Se(e){return t.createElement("div",null,t.createElement("h1",null,"Unerring Teleport"),t.createElement("p",null,"Verbal elements - either the True Name of the destination, the two common names of the destination, or the name of the destination from an adjoining location (which can only be known from that destination, and is colored in green for whatever reason). The name must exact, but the volume of the incantation is irrelevant."),t.createElement("p",null,"Somatic elements - /go or /move"),t.createElement("p",null,"Material components - none"),t.createElement("p",null,"This spell will take you to whichever place you wish, hidden or not. The only issue is that the names of the hidden places are obscured by dark magics. I, the Great Wizard Teleportus, have researched long and hard, and at last produced a complete list of all the room in this space. Bow before my awesome intelligence!"),t.createElement("p",null,"Examples:"),t.createElement("ul",null,t.createElement("li",{key:"example-0"},t.createElement("em",null,"/go hiddenPortalRoom")," utilizes the true name to return here"),t.createElement("li",{key:"example-1"},t.createElement("em",null,"/move leap into the shimmering portal")," utilizes the name of the destination ('leap into the shimmering portal') from the adjacent room (here)"),t.createElement("li",{key:"example-2"},t.createElement("em",null,"/move Unconferencing: Sokoban")," utilizes the first common name"),t.createElement("li",{key:"example-3"},t.createElement("em",null,"/go the artists' atelier")," utilizes the second common name")),t.createElement("table",null,t.createElement("tbody",null,t.createElement("tr",null,t.createElement("th",{key:"common-1-header"},"common (first)"),t.createElement("th",{key:"common-2-header"},"common (second)"),t.createElement("th",{key:"true-header"},"true")),e.rooms.map((e=>t.createElement("tr",{key:e.id},t.createElement("td",{key:`common-1-${e.id}`},e.displayName),t.createElement("td",{key:`common-2-${e.id}`},e.shortName),t.createElement("td",{key:`true-${e.id}`},e.id)))))))}X=Z("3Loy2");const Ne={generateFood:()=>{X.pickUpRandomItemFromList("vendingMachineFood")},pickUpPuppy:()=>{X.pickUpItem("a tiny puppy")},drinkPolymorph:()=>{X.sendChatMessage(C(),"/get colourful potion")},drinkCancellation:()=>{X.sendChatMessage(C(),"/get clear potion")},getFortune:()=>{X.sendChatMessage(C(),"/get fortune cookie")},readPoster:()=>{X.displayMessageFromList("motivationPosters")},readClosedSign:()=>{X.displayMessageFromList("closedSigns")},getGameRec:()=>{X.displayMessageFromList("gameRecommendations")},pentagramHighTech:()=>{Ae("Impactful")},pentagramMinimalist:()=>{Ae("Classic")},pentagramComical:()=>{Ae("Comic")},pentagramNormal:()=>{Ae("")},hearPickupLine:()=>{X.displayMessageFromList("pickupLines")},watchRobot:()=>{X.displayMessageFromList("robots")}},Ae=function(e){X.updateFontReward(C(),e),X.sendChatMessage(C(),"/go ASCII"),X.displayMessage("You feel changed by your journey through the pentagram...")},Te=e=>{throw Error("Not Implemented")},De=t.createContext({prepareForMediaChat:async()=>console.log("Not implemented"),prepareMediaDevices:async()=>console.log("Not implemented"),publishMedia:()=>console.log("Not implemented"),publishAudio:()=>console.log("Not implemented"),unpublishMedia:()=>console.log("Not implemented"),publishingCamera:!1,publishingMic:!1,cameras:[],mics:[],setCurrentCamera:Te,setCurrentMic:Te,currentMic:void 0,currentCamera:void 0,localStreamView:t.createElement("div"),inCall:!1,joinCallFailed:!1,joinCall:Te,leaveCall:()=>console.log("Not implemented"),callParticipants:void 0,cameraEnabled:!1,micEnabled:!1,setCameraEnabled:e=>console.log("Not implemented"),setMicEnabled:e=>console.log("Not implemented")}),xe=()=>i(De);X=Z("3Loy2");var Re=()=>{const{userMap:e,myId:n}=i(Tn),a=e[n];return a.item?t.createElement("span",null,"You are holding ",a.item,"."," ",t.createElement("button",{className:"link-styled-button",onClick:()=>{X.dropItem()}},"Drop it"),"."):null};Q=Z("3Wbh2"),X=Z("3Loy2");function Oe(e){const n=i(An),{useSimpleNames:a}=i(Dn),{userMap:o,myId:r}=i(Tn),l=o[e.userId],s=l&&l.username,c=l&&l.isMod,d=l&&l.isBanned,m=o[r],u=m&&m.isMod,p=(e,t)=>{n(Q.HideModalAction()),X.fetchProfile(t.id)},h=u?t.createElement(S,{data:{id:e.userId,username:s},onClick:(e,t)=>{confirm(`Are you sure you would like to ${d?"unban":"ban"} the user '${t.username}'?`)&&n(Q.BanToggleAction(t.id))}},d?"Unban":"Ban"):"",g=u?t.createElement(S,{data:{id:e.userId,username:s},onClick:(e,t)=>{confirm(`Are you sure you would like to ${c?"remove":"add"} the user '${t.username}' ${c?"from":"to"} the mod list?`)&&n(Q.ModToggleAction(t.id))}},c?"Remove Mod":"Make Mod"):"";var y="name";!a&&l&&l.nameColor&&(y=y+" "+l.nameColor),!a&&l&&l.fontReward&&(y=y+" font-"+l.fontReward);const E={whiteSpace:e.nowrap?"nowrap":void 0};return t.createElement("span",{className:y,"data-tip":l&&l.pronouns,style:E},t.createElement(M,{id:e.id,renderTag:"span",holdToDisplay:0},t.createElement("strong",{className:c?"mod":""},c?"[Mod] ":"",!a&&l&&l.polymorph||"",s||"unknown")),t.createElement(N,{id:e.id},t.createElement(S,{data:{id:e.userId},onClick:p},"Profile"),t.createElement(S,{data:{id:e.userId},onClick:p},"Whisper"),h,g),t.createElement(A,null))}var We=e=>{const{userMap:n}=t.useContext(Tn);let{users:a,userId:o}=e;const{callParticipants:r}=xe();let l,i;if(r){const e=Array.from(r.values());l=e.filter((e=>e.audioTracks.size>0)).map((e=>e.identity)),i=e.filter((e=>e.videoTracks.size>0)).map((e=>e.identity))}if(a&&o&&(a=a.filter((e=>e!==o))),a){let o;if(0===a.length)return t.createElement("div",{id:"dynamic-room-description"},"You are all alone here. ",t.createElement(Re,null));if("theater"===e.roomId)return t.createElement("div",{id:"dynamic-room-description"},"There are ",a.length," other people sitting in here.");const r=a.map(((e,a)=>{const o=n[e];if(!o)return t.createElement("span",null);const r=`presence-${a}`;return t.createElement("span",{key:`room-presence-${r}`},t.createElement(Oe,{userId:e,id:r,key:r}),l&&l.includes(o.id)?t.createElement(g,{className:"has-audio"}):null,i&&i.includes(o.id)?t.createElement(y,{className:"has-video"}):null,o.item?` (holding ${o.item})`:null)}));return o=1===a.length?r[0]:2===a.length?t.createElement("span",null,r[0]," and ",r[1]):t.createElement("span",null,(s=r.slice(0,a.length-1),c=", ",0===s.length?[]:s.slice(1).reduce((function(e,t,n){return e.concat([c,t])}),[s[0]])),", and"," ",r[r.length-1]),t.createElement("div",{id:"dynamic-room-description"},"Also here ",1===a.length?"is":"are"," ",o,". ",t.createElement(Re,null))}return t.createElement("div",{id:"dynamic-room-description"});var s,c};const Le=e=>{const{announcements:n,onChosen:a}=e,[r,i]=l();if(o((()=>{i(n[0])}),[n]),0===n.length)return t.createElement(t.Fragment,null);{const e=e=>{const t=Number(e).valueOf(),a=n.find((e=>e.info.streamId===t));a&&i(a)};return t.createElement("div",{className:"stream-selector"},t.createElement("select",{onBlur:t=>e(t.target.value)},n.map((e=>t.createElement("option",{key:e.info.streamId.toString(),value:e.info.streamId.toString()},"Stream ",e.info.streamId.toString())))),t.createElement("button",{onClick:()=>{r&&a(r)}},"Join Stream"))}},Pe=e=>{const n=void 0===e.peer,[a,r]=l(""),[i,s]=l(!1),[c,d]=l();return o((()=>{null==c||c.leave(),d(void 0)}),[e.streamStopCount]),t.createElement("div",{className:"card widget"},t.createElement("div",{style:{width:110,marginBottom:"8px"}},n?t.createElement("div",{className:"badge"},"Disconnected"):t.createElement("div",{className:"badge ok"},"Connected")),t.createElement("div",{className:"card-top"},t.createElement("h2",null,t.createElement("label",{htmlFor:"peerId"},"Peer ID")),t.createElement("input",{id:"peerId",type:"text",spellCheck:!1,value:e.peerId.toString(),disabled:!0}),t.createElement("button",{onClick:()=>e.disconnect()},n?"Close":"Disconnect"),t.createElement("button",{disabled:!e.peer||!c,onClick:()=>null==c?void 0:c.requestFullscreen()},"Fullscreen"),t.createElement("button",{disabled:!e.peer||i,onClick:()=>(async()=>{if(c)return c.leave(),void d(void 0);try{var t;s(!0);const n=await(null===(t=e.peer)||void 0===t?void 0:t.requestStream(R.Gamepad|R.Mouse|R.Keyboard));d(n)}catch(e){console.log(e)}finally{s(!1)}})()},c?"Leave Stream":"Request New Stream"),t.createElement(Le,{announcements:e.announcements,onChosen:async e=>{const t=await e.join();d(t)}})),t.createElement("div",{className:"widget-body"},t.createElement("div",{className:"stream-column m-r-16"},t.createElement("div",{className:"stream-wrapper"},t.createElement(O,{stream:c},"No stream.")))))};var Fe=Z("715TH");function He(e){const[n,a]=l(!1),[o,r]=l(),[i,s]=l([]),[c,d]=l("peerId-widget1"),[m,u]=l(!1),[p,h]=l("");function g(e){return{peer:e,peerId:e.peerId,streamStopCount:0,announcements:[]}}return t.createElement("div",null,t.createElement("div",{className:"m-b-8 flex"},t.createElement("br",null),o?t.createElement("div",{className:"m-l-8 badge ok"},"Connected to Rainway"):n?t.createElement("div",{className:"m-l-8 badge"},"Connecting…"):t.createElement("div",null,t.createElement("button",{className:"m-l-16",disabled:void 0!==o||n,onClick:async()=>{let e;if(o)e=o;else{a(!0);try{e=await x.initialize({apiKey:Fe.default.RAINWAY_API_KEY,externalId:"web-demo-react",onRuntimeConnectionLost:(e,t)=>{console.log("Connection lost:",t),r(void 0),s([])},onConnectionRequest:(e,t)=>{t.accept()},onPeerMessage:(e,t,n,a)=>{},onPeerDataChannel:()=>{},onPeerError:(e,t,n)=>{console.warn("onPeerError",t,n)},onPeerStateChange:(e,t,n)=>{if(n===D.New){i.find((e=>e.peerId===t.peerId))||s((e=>[...e,g(t)]))}else n===D.Failed&&(console.warn("onPeerDisconnect",t),s((e=>e.map((e=>e.peerId===t.peerId?{...e,peer:void 0}:e)))))},onStreamAnnouncement:(e,t,n)=>{!function(e,t){s((n=>n.map((n=>n.peerId===e.peerId?{...n,announcements:[...n.announcements,t]}:n))))}(t,n)},onStreamStop:(e,t)=>{var n;s((e=>e.map((e=>[...(null===(n=e.peer)||void 0===n?void 0:n.streams.values())??[]].some((e=>e===t))?{...e,streamStopCount:e.streamStopCount+1}:e))))},logSink:(e,t)=>{console.log(e,t)}}),r(e)}finally{a(!1)}}}},"Connect to Rainway"))),i.map((e=>t.createElement(Pe,{key:e.peerId.toString(),peer:e.peer,peerId:e.peerId,announcements:e.announcements,disconnect:()=>{var t;null===(t=e.peer)||void 0===t||t.disconnect(),s((t=>t.filter((t=>t.peerId!==e.peerId))))},streamStopCount:e.streamStopCount}))),t.createElement("div",{className:"card flex"},t.createElement("h2",null,t.createElement("label",{htmlFor:"peerId"},"Peer ID")),t.createElement("input",{className:"m-l-8",id:"peerId",type:"text",spellCheck:!1,value:c,placeholder:"511111111111111111",disabled:!o||m,onChange:e=>d(e.target.value)}),t.createElement("button",{className:"m-l-8 m-r-16",disabled:!o||m,onClick:async()=>{console.log(c);try{u(!0);const e=await(null==o?void 0:o.connect(BigInt(c)));e&&(await e.createDataChannel("Message",T.Reliable),await e.listStreams(),h(""))}catch(e){h(e.toString().replace(/.*Rainway SDK Error: /,""))}finally{u(!1)}}},m?"Connecting…":"Connect to peer"),p))}function Ue(e){const t=i(An),{prepareForMediaChat:a,joinCall:r,unpublishMedia:s}=xe(),{room:c}=e,[d,m]=l(!0);o((()=>{c&&c.mediaChat&&!e.textOnlyMode&&e.hasDismissedAModal&&(e.keepCameraWhenMoving||u(),a(),r(e.room.id,e.keepCameraWhenMoving))}),[e.room.id,e.hasDismissedAModal]);const u=()=>{t(Q.StopVideoChatAction()),s()},g=()=>{t(Q.ShowModalAction(ee.Modal.NoteWall))};let y;return c&&c.hasNoteWall&&(y=c.noteWallData?n("div",null,c.noteWallData.roomWallDescription," ",n("button",{onClick:g},c.noteWallData.noteWallButton)):n("div",null,"One of the walls has space for attendees to put up sticky notes."," ",n("button",{onClick:g},"View note wall"))),console.log("ROOM",JSON.stringify(c,null,2)),n("div",{id:"room"},n("h1",{id:"room-name"},c?c.displayName:"Loading...",n("button",{type:"button",id:"room-collapse-button",className:"link-styled-button",onClick:e=>{m(!d)}},d?n("span",null,"Hide Description ",n(h,null)):n("span",null,"Show Description ",n(p,null)))),n("div",{id:"full-room-description",className:d?"":"collapsed"},n("div",{id:"static-room-description",onClick:e=>{const t=e.target&&e.target.getAttribute&&e.target.getAttribute("data-room");if(t)return void X.moveToRoom(t);const n=e.target&&e.target.getAttribute&&e.target.getAttribute("data-item");n&&X.pickUpItem(n);const a=e.target&&e.target.getAttribute&&e.target.getAttribute("data-action");a&&Ne[a]()},dangerouslySetInnerHTML:{__html:c?$e(c.description,e.roomData):"Loading current room..."}}),c&&"theater"===c.id?n(Ve,null):null,c&&"gamerCave"===c.id?n(He,null):null,c&&c.specialFeatures&&c.specialFeatures.includes("RAINBOW_DOOR")?n(we,null):"",c&&c.specialFeatures&&c.specialFeatures.includes("DULL_DOOR")?n(Ie,null):"",c&&c.specialFeatures&&c.specialFeatures.includes("FULL_ROOM_INDEX")?n(Me,null):"",c&&c.riddles?n("button",{id:"riddle-button",onClick:()=>{t(Q.ShowModalAction(ee.Modal.Riddles))}},c.riddles.length>1?"Examine the Riddles":"Examine the Riddle"):"",y),c?n(We,{users:c.users,userId:e.userId,roomId:c.id}):"",e.mediaChatView||"")}function $e(e,t){return e=(e=e.replace(/\[\[([^\]]*?)\-\>([^\]]*?)\]\]/g,((e,n,a)=>{const o=t[a];if("item"===a)return`<a class='room-link' href='#' data-item='${n}'>${n}</a>`;if(o){return`<a class='room-link' href='#' data-room='${a}'>${n}${o&&o.users&&o.users.length>0?` (${o.users.length})`:""}</a>`}if(Ne[a])return`<a class='room-link' href='#' data-action='${a}'>${n}</a>`;console.log(`Dev warning: tried to link to room ${a}, which doesn't exist`)}))).replace(/\[\[(.+?)\]\]/g,((e,n)=>{const a=t[n];a||console.log(`Dev warning: tried to link to room ${n}, which doesn't exist`);return`<a class='room-link' href='#' data-room='${n}'>${n}${a&&a.users&&a.users.length>0?` (${a.users.length})`:""}</a>`}))}function Ve(){const e=r(null),t=r(null);return n("div",{id:"iframes",style:{margin:"auto"}},n("iframe",{width:"560",title:"stream",ref:e,height:"315",src:"https://www.youtube.com/embed/live_stream?channel=UCKv_QzXft4mD6TXmQBZtzIA",frameBorder:"0",allow:"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}),n("iframe",{id:"captions",title:"captions",ref:t,width:"560",height:"100",src:"https://www.streamtext.net/player/?event=RoguelikeCelebration&chat=false&header=false&footer=false&indicator=false&ff=Consolas&fgc=93a1a1",frameBorder:"0",allow:"autoplay; encrypted-media;",allowFullScreen:!0}))}var Ye,Be;function qe(e){return[Ye.Chat,Ye.Emote,Ye.Shout,Ye.Dance,Ye.Caption].includes(e.type)}(Be=Ye||(Ye={})).Connected="CONNECTED",Be.Disconnected="DISCONNECTED",Be.Entered="ENTERED",Be.Left="LEFT",Be.MovedRoom="MOVED",Be.SameRoom="SAME",Be.Chat="CHAT",Be.Whisper="WHISPER",Be.Shout="SHOUT",Be.Emote="EMOTE",Be.Dance="DANCE",Be.Mod="MOD",Be.Error="ERROR",Be.Command="COMMAND",Be.Caption="CAPTION";const ze=(e,t,n)=>({type:Ye.Chat,messageId:e,userId:t,message:n,timestamp:new Date}),_e=(e,t,n)=>({type:Ye.Caption,messageId:e,userId:t,message:n,timestamp:new Date}),je=(e,t,n=!1)=>({type:Ye.Whisper,userId:e,message:t,senderIsSelf:n,timestamp:new Date}),Ge=e=>({type:Ye.Error,error:e,timestamp:new Date}),Je=e=>({type:Ye.Command,command:e,timestamp:new Date});X=Z("3Loy2");const Ke=new Intl.DateTimeFormat("en",{hour:"numeric",minute:"numeric"});function Ze(e){const{message:n}=e;if(!n)return t.createElement("div",null);const a={[Ye.Connected]:tt,[Ye.Disconnected]:nt,[Ye.Entered]:at,[Ye.Left]:ot,[Ye.MovedRoom]:rt,[Ye.SameRoom]:lt,[Ye.Chat]:it,[Ye.Whisper]:ct,[Ye.Shout]:mt,[Ye.Emote]:ut,[Ye.Dance]:pt,[Ye.Caption]:st,[Ye.Error]:ht,[Ye.Mod]:dt,[Ye.Command]:gt}[n.type];if(!a)return console.log("Unexpected message type",n.type),t.createElement("div",null);const o="string"==typeof n.timestamp?new Date(n.timestamp):n.timestamp;let r="message-wrapper";return e.msgIndex%2==0&&(r+=" even-message"),t.createElement("div",{className:r},t.createElement("div",{className:`time ${e.hideTimestamp?"show-on-hover":null}`},Ke.format(o)),t.createElement(a,{...n,id:e.id}))}const Xe=(e,t)=>{confirm(`Are you sure you would like to delete the message '${t.message}'?`)&&X.deleteMessage(t.messageId)},Qe=(e,n,a)=>t.createElement("a",{href:e,key:a,target:"_blank",rel:"noopener noreferrer"},n),et=e=>{const{userMap:n,myId:a}=i(Tn);return n[a]&&n[a].isMod?t.createElement(W,{componentDecorator:Qe},t.createElement("span",{className:"deleteMenu"},t.createElement(M,{id:e.messageId,mouseButton:2,renderTag:"span"},e.children),t.createElement(N,{id:e.messageId},t.createElement(S,{data:{messageId:e.messageId,message:e.children},onClick:Xe},"Delete Message?")),t.createElement(A,null))):t.createElement(W,{componentDecorator:Qe},e.children)},tt=e=>t.createElement("div",{className:"message"},t.createElement(Oe,{userId:e.userId,id:e.id})," has connected."),nt=e=>t.createElement("div",{className:"message"},t.createElement(Oe,{userId:e.userId,id:e.id})," has disconnected."),at=e=>{const n=()=>{X.moveToRoom(e.fromId)},a=i(Rn);if(a[e.fromId]){const o=a[e.fromId].hidden?t.createElement("text",null,"somewhere..."):t.createElement("button",{onClick:n,className:"link-styled-button"},e.fromName,".");return t.createElement("div",{className:"message movement-message"},t.createElement(Oe,{userId:e.userId,id:e.id})," has entered from"," ",o)}return null},ot=e=>{const n=()=>{X.moveToRoom(e.toId)},a=i(Rn);if(a[e.toId]){const o=a[e.toId].hidden?t.createElement("text",null,"somewhere..."):t.createElement("button",{onClick:n,className:"link-styled-button"},e.toName,".");return t.createElement("div",{className:"message movement-message"},t.createElement(Oe,{id:e.id,userId:e.userId})," has wandered off to"," ",o)}return null},rt=e=>t.createElement("div",{className:"message"},"You have moved to ",e.to,"."),lt=e=>t.createElement("div",{className:"message"},"You are already in ",e.roomId,"."),it=e=>t.createElement("div",{className:"message"},t.createElement(Oe,{userId:e.userId,id:e.id}),": ",t.createElement(et,{messageId:e.messageId},e.message)),st=e=>t.createElement("div",{className:"message"},t.createElement(Oe,{userId:e.userId,id:e.id})," (spoken): ",t.createElement(et,{messageId:e.messageId},e.message)),ct=e=>{i(An);const n=()=>{X.fetchProfile(e.userId)};return e.senderIsSelf?t.createElement("div",{className:"whisper",onClick:n},"You whisper to ",t.createElement(Oe,{id:e.id,userId:e.userId}),":"," ",e.message):t.createElement("div",{className:"whisper",onClick:n},t.createElement(Oe,{userId:e.userId,id:e.id})," whispers:"," ",e.message)},dt=e=>e.senderIsSelf?t.createElement("div",{className:"message"},t.createElement("em",null,t.createElement("strong",null,"You")," said to the ",t.createElement("strong",null,"mod team"),":"," ",e.message,t.createElement("br",null),"Someone from the ",t.createElement("strong",null,"mod team")," will be in touch soon.")):t.createElement("div",{className:"message"},t.createElement("em",null,t.createElement("span",{role:"img","aria-label":"red exclamation point"},"❗"),t.createElement(Oe,{userId:e.userId,id:e.id})," says to the"," ",t.createElement("strong",null,"mods"),":",e.message,t.createElement("span",{role:"img","aria-label":"red exclamation point"},"❗"))),mt=e=>t.createElement("div",{className:"message"},t.createElement(Oe,{userId:e.userId,id:e.id})," shouts: ",t.createElement(et,{messageId:e.messageId},e.message)),ut=e=>t.createElement("div",{className:"message"},t.createElement("em",null,t.createElement(Oe,{userId:e.userId,id:e.id})," ",t.createElement(et,{messageId:e.messageId},e.message))),pt=e=>t.createElement("div",{className:"message"},t.createElement("em",null,t.createElement(Oe,{userId:e.userId,id:e.id})," ",t.createElement("span",{dangerouslySetInnerHTML:{__html:e.message}}))),ht=e=>t.createElement("div",{className:"error"},e.error),gt=e=>t.createElement("div",{className:"message"},t.createElement("em",null,t.createElement("span",{dangerouslySetInnerHTML:{__html:e.command}})));Q=Z("3Wbh2");function yt(e){const n=i(An);function a(t){return((n=t).type===Ye.Connected||n.type===Ye.Disconnected||n.type===Ye.Entered||n.type===Ye.Left)&&(e.serverSettings.movementMessagesHideRoomIds.includes(t.roomId)||t.numUsersInRoom>e.serverSettings.movementMessagesHideThreshold);var n}t.useEffect((()=>{const t=document.querySelector("#messages .message-wrapper:last-of-type");t&&e.autoscrollChat&&(t.parentNode.scrollTop=t.offsetTop-t.parentNode.offsetTop)}));const o=e.messages.filter((e=>!a(e))).filter((t=>!!e.captionsEnabled||t.type!==Ye.Caption));return t.createElement("div",{id:"messages",onScroll:()=>{const t=document.querySelector("#messages"),a=t.scrollHeight===t.scrollTop+t.clientHeight;a&&!e.autoscrollChat?n(Q.ActivateAutoscrollAction()):!a&&e.autoscrollChat&&n(Q.DeactivateAutoscrollAction())}},o.slice(-150).map(((n,a)=>{let o=!1;const r=e.messages[a-1];if(r&&r.userId&&n.userId&&r.userId===n.userId){new Date(n.timestamp).getTime()-new Date(r.timestamp).getTime()<18e4&&(o=!0)}const l=`message-${a}`;return t.createElement(Ze,{message:n,key:l,id:l,hideTimestamp:o,msgIndex:a})})))}function Et(e){i(An);const[n,a]=l(""),r=()=>{e.sendMessage(n),a("")};return o((()=>{document.getElementById("chat-input").focus(),e.prepopulated&&a(e.prepopulated)}),[e.prepopulated]),t.createElement("div",{id:"input"},t.createElement("input",{type:"text",id:"chat-input",onChange:e=>{const t=L(e.currentTarget.value);a(t)},onKeyPress:e=>{"Enter"===e.key&&r()},value:n,"aria-label":"Chat text input box",autoComplete:"off"}),t.createElement("button",{id:"send",onClick:r},"Send"))}X=Z("3Loy2"),Q=Z("3Wbh2"),X=Z("3Loy2"),ee=Z("1qZWk");const ft=(e,t,n,a)=>({type:e,description:t,invocations:n,singleParameter:a});var vt,bt;(bt=vt||(vt={})).Help="HELP",bt.Move="MOVE",bt.Whisper="WHISPER",bt.Shout="SHOUT",bt.Emote="EMOTE",bt.Dance="DANCE",bt.Interact="INTERACT",bt.ContactMod="CONTACT_MOD",bt.Look="LOOK";const wt=[ft(vt.Help,"Lists the available commands",["/help"],!0),ft(vt.Move,"Move from one room to another. You can also click on the link in the room description.",["/go","/move"],!1),ft(vt.Whisper,"Whisper another user. You can also click directly on their name and select the whisper option.",["/whisper"],!1),ft(vt.Shout,"Sends a message to everybody at once - has a 5 minute cooldown. Do not abuse this!",["/shout"],!1),ft(vt.Emote,"Like a normal message, but in italics!",["/emote","/me"],!1),ft(vt.Dance,"Bust a move!",["/dance"],!0),ft(vt.ContactMod,"Sends a message to the mod team. We will be in touch shortly afterwards.",["/mod","/mods","/moderator","/moderators"],!1),ft(vt.Look,"View the profile of another user. You can also click on their name and select the Profile option.",["/look"],!1),ft(vt.Interact,"Interact with or get something in a room by referencing the name in the description - experiment as you explore!",["/interact","/get"],!1)];var kt=Z("1CoyE");Fe=Z("715TH");console.log(Fe.default.FIREBASE_CONFIG);const It={firebaseApp:P.initializeApp(Fe.default.FIREBASE_CONFIG),authenticated:!1,checkedAuthentication:!1,hasRegistered:!1,messages:[],whispers:[],visibleSpeakers:[],autoscrollChat:!0,userMap:{},roomData:{},inMediaChat:!1,activeModal:ee.Modal.None,activeModalOptions:{},isBanned:!1,serverSettings:{movementMessagesHideThreshold:20,movementMessagesHideRoomIds:["theater"],happeningNowEntries:[],spaceIsClosed:!1},numberOfFaces:5,captionsEnabled:!1,hasDismissedAModal:!1};var Ct=(e,t)=>{console.log("In reducer",t);const n=JSON.parse(JSON.stringify(e));if(n.prepopulatedInput=void 0,t.type===Q.ActionType.ReceivedMyProfile&&(n.profileData=t.value),t.type===Q.ActionType.ReceivedServerSettings&&(n.serverSettings=t.value),t.type===Q.ActionType.UpdatedCurrentRoom){const e=n.roomId;if(n.roomId=t.value.roomId,n.roomData={...n.roomData,...t.value.roomData},"entryway"!==n.roomId&&n.hasDismissedAModal||(n.activeModal=ee.Modal.Welcome),n.roomData&&n.roomData[t.value.roomId]){const o=n.roomData[t.value.roomId];n.roomId!==e?St(n,(a=o.shortName,{type:Ye.MovedRoom,to:a,timestamp:new Date})):St(n,(e=>({type:Ye.SameRoom,roomId:e,timestamp:new Date}))(o.shortName))}}var a,o,r,l,i;if(t.type===Q.ActionType.UpdatedRoomData&&(n.roomData={...n.roomData,...t.value}),t.type===Q.ActionType.UpdatedPresence&&Object.keys(t.value).forEach((e=>{n.roomData[e]&&(n.roomData[e].users=t.value[e])})),t.type===Q.ActionType.PlayerConnected){const e=t.value,a=n.roomData[n.roomId];a.users.includes(e.id)||(a.users.push(e.id),St(n,(o=e.id,r=n.roomId,l=a.users.length,{type:Ye.Connected,userId:o,roomId:r,numUsersInRoom:l,timestamp:new Date}))),n.userMap[e.id]=e}if(t.type===Q.ActionType.PlayerDisconnected){const e=n.roomData[n.roomId];e.users=e.users.filter((e=>e!==t.value)),St(n,((e,t,n)=>({type:Ye.Disconnected,userId:e,roomId:t,numUsersInRoom:n,timestamp:new Date}))(t.value,n.roomId,e.users.length))}if(t.type===Q.ActionType.PlayerEntered){const e=n.roomData[n.roomId];e.users.includes(t.value.name)||(e.users.push(t.value.name),St(n,((e,t,n,a,o)=>({type:Ye.Entered,userId:e,fromId:t,fromName:n,roomId:a,numUsersInRoom:o,timestamp:new Date}))(t.value.name,t.value.fromId,t.value.fromName,n.roomId,e.users.length)))}if(t.type===Q.ActionType.PlayerLeft){const e=n.roomData[n.roomId];e.users=e.users.filter((e=>e!==t.value.name)),St(n,((e,t,n,a,o)=>({type:Ye.Left,userId:e,toId:t,toName:n,roomId:a,numUsersInRoom:o,timestamp:new Date}))(t.value.name,t.value.toId,t.value.toName,n.roomId,e.users.length))}if(t.type===Q.ActionType.ChatMessage&&St(n,ze(t.value.messageId,t.value.name,t.value.message)),t.type===Q.ActionType.CaptionMessage&&St(n,_e(t.value.messageId,t.value.name,t.value.message)),t.type===Q.ActionType.Whisper){const e=je(t.value.name,t.value.message);St(n,e),Mt(n,e)}if(t.type===Q.ActionType.ModMessage&&St(n,((e,t,n=!1)=>({type:Ye.Mod,userId:e,message:t,senderIsSelf:n,timestamp:new Date}))(t.value.name,t.value.message,t.value.name===n.userId)),t.type===Q.ActionType.DeleteMessage&&function(e,t){const n=e.messages.find((e=>qe(e)&&e.messageId===t));qe(n)&&(n.message="message was removed by moderator",le(e.messages))}(n,t.value.targetMessageId),t.type===Q.ActionType.Shout&&St(n,((e,t,n)=>({type:Ye.Shout,messageId:e,userId:t,message:n,timestamp:new Date}))(t.value.messageId,t.value.name,t.value.message)),t.type===Q.ActionType.Emote&&St(n,((e,t,n)=>({type:Ye.Emote,messageId:e,userId:t,message:n,timestamp:new Date}))(t.value.messageId,t.value.name,t.value.message)),t.type===Q.ActionType.Dance&&St(n,((e,t,n)=>({type:Ye.Dance,messageId:e,userId:t,message:n,timestamp:new Date}))(t.value.messageId,t.value.name,t.value.message)),t.type===Q.ActionType.UserMap&&(n.userMap={...n.userMap,...t.value},n.visibleProfile&&n.userMap[n.visibleProfile.id]&&X.fetchProfile(n.visibleProfile.id)),t.type===Q.ActionType.PlayerBanned&&(t.value.id===n.userId?n.isBanned=!0:(n.userMap[t.value.id].isBanned=!0,St(n,Ge("User "+t.value.username+" was banned!")))),t.type===Q.ActionType.PlayerUnbanned&&(n.userMap[t.value.id]&&(n.userMap[t.value.id].isBanned=!1),St(n,Ge("User "+t.value.username+" was unbanned!"))),t.type===Q.ActionType.UpdateProfileColor&&(n.userMap[n.userId].nameColor=t.color,t.color?St(n,Ge("Your name color was changed to "+t.color)):St(n,Ge("Your name color has changed back to its original state.")),X.updateProfileColor(n.userId,t.color)),t.type===Q.ActionType.UpdateFontReward&&(n.userMap[n.userId].fontReward=t.font,t.font?St(n,Ge("You feel invigorated, and like you've become more... "+t.font)):St(n,Ge("You feel yourself return to your normal state, like you never went riddling to begin with.")),X.updateFontReward(n.userId,t.font)),t.type===Q.ActionType.Error&&St(n,Ge(t.value)),t.type===Q.ActionType.MediaReceivedSpeakingData&&(n.currentSpeaker=t.value,null!==t.value&&t.value!==n.userId&&!n.visibleSpeakers.find((([e,n])=>e===t.value))))if(n.visibleSpeakers.length<n.numberOfFaces)n.visibleSpeakers.push([t.value,new Date]);else{let e=-1,a=new Date;for(let t=0;t<n.visibleSpeakers.length;t++)n.visibleSpeakers[t][1]<a&&(a=n.visibleSpeakers[t][1],e=t);n.visibleSpeakers[e]=[t.value,new Date]}if(t.type===Q.ActionType.SetNumberOfFaces&&(n.numberOfFaces=t.value),t.type===Q.ActionType.StartVideoChat&&(n.inMediaChat=!0),t.type===Q.ActionType.StopVideoChat&&(n.inMediaChat=!1),t.type===Q.ActionType.SendMessage){const e=C(),a=t.value.trim(),o=/^\/.+?/.exec(a),r=o?(i=a,wt.find((e=>e.invocations.find((t=>e.singleParameter?i.startsWith(t):i.startsWith(t+" ")))))):void 0;if(a.length>kt.MESSAGE_MAX_LENGTH)St(n,Ge("Your message is too long! Please try to keep it under ~600 characters!"));else if(a.split(" ").find((e=>e.length>kt.MESSAGE_MAX_WORD_LENGTH)))St(n,Ge("Your message has a word that is too long! Please keep it under 60 characters!"));else if(o&&void 0===r){const e=/^(\/.+?) (.+)/.exec(a);St(n,Ge(`Your command ${e?e[1]:t.value} is not a registered slash command!`))}else if(o&&r.type===vt.Whisper){const t=/^(\/.+?) (.+)/.exec(a),o=/^(.+?) (.+)/.exec(t[2]);if(o){X.sendChatMessage(e,a);const[t,r,l]=o,i=Object.values(n.userMap).find((e=>e.username===r)),s=i&&i.id;if(s){const e=je(s,l,!0);St(n,e),Mt(n,e)}}else St(n,Ge(`Your whisper to ${t[2]} had no message!`))}else if(o&&r.type===vt.Help)n.activeModal=ee.Modal.Help,St(n,Je("You consult the help docs. (You can also find them in sidebar!)"));else if(o&&r.type===vt.Look){const t=/^(\/.+?) (.+)/.exec(a);St(n,Je(`You attempt to examine ${t[2]}. (You can also click on their username and select Profile!)`)),X.sendChatMessage(e,a)}else o?X.sendChatMessage(e,a):(X.sendChatMessage(e,t.value),St(n,ze(e,n.userId,t.value)))}if(t.type===Q.ActionType.SendCaption){const e=C();X.sendCaption(e,t.value),St(n,_e(e,n.userId,t.value))}if(t.type===Q.ActionType.StartWhisper&&(n.prepopulatedInput=`/whisper ${t.value} `),t.type===Q.ActionType.HideModalAction&&(n.activeModal=ee.Modal.None,n.hasDismissedAModal=!0),t.type===Q.ActionType.ShowProfile&&(n.visibleProfile=t.value),t.type===Q.ActionType.HideProfile&&(n.visibleProfile=null),t.type===Q.ActionType.ShowModal&&(n.activeModal=t.value,n.activeModalOptions={}),t.type===Q.ActionType.ShowModalWithOptions&&(console.log("Showing",t),n.activeModal=t.value.modal,n.activeModalOptions=t.value.options),t.type===Q.ActionType.ShowSideMenu&&(n.mobileSideMenuIsVisible=!0),t.type===Q.ActionType.HideSideMenu&&(n.mobileSideMenuIsVisible=!1),t.type===Q.ActionType.DeactivateAutoscroll&&(n.autoscrollChat=!1),t.type===Q.ActionType.ActivateAutoscroll&&(n.autoscrollChat=!0),t.type===Q.ActionType.SetUseSimpleNames&&(n.useSimpleNames=t.value,async function(e){await I.setItem(Ee,e)}(t.value)),t.type===Q.ActionType.SetKeepCameraWhenMoving&&(n.keepCameraWhenMoving=t.value,async function(e){await I.setItem(fe,e)}(t.value)),t.type===Q.ActionType.SetCaptionsEnabled&&(n.captionsEnabled=t.value,async function(e){await I.setItem(be,e)}(t.value)),t.type===Q.ActionType.SetTextOnlyMode&&(n.textOnlyMode=t.textOnlyMode,t.refresh?de(t.textOnlyMode).then((()=>window.location.reload())):de(t.textOnlyMode)),t.type===Q.ActionType.SetAudioOnlyMode&&(n.audioOnlyMode=t.value),t.type===Q.ActionType.Authenticate&&(n.checkedAuthentication=!0,n.authenticationProvider=t.value.provider,n.mustVerifyEmail=t.value.mustVerifyEmail,t.value.userId&&t.value.name?(n.authenticated=!0,n.userId=t.value.userId,n.userMap[t.value.userId]={id:t.value.userId,username:t.value.name}):(n.authenticated=void 0,n.userId=void 0)),t.type===Q.ActionType.IsRegistered&&(n.hasRegistered=!0),t.type===Q.ActionType.BanToggle&&X.toggleUserBan(t.value),t.type===Q.ActionType.ModToggle&&X.toggleUserMod(t.value),t.type===Q.ActionType.LoadMessageArchive&&(n.messages=t.messages,n.whispers=t.whispers||[]),t.type===Q.ActionType.NoteAdd){const e=n.roomData&&n.roomData[t.value.roomId];e.hasNoteWall&&(e.notes||(e.notes=[]),e.notes.push(t.value.note))}if(t.type===Q.ActionType.NoteRemove){const e=n.roomData&&n.roomData[t.value.roomId];e.hasNoteWall&&(e.notes||(e.notes=[]),e.notes=e.notes.filter((e=>e.id!==t.value.noteId)))}if(t.type===Q.ActionType.NoteUpdateLikes){const e=n.roomData&&n.roomData[t.value.roomId];if(e.hasNoteWall){e.notes||(e.notes=[]);const n=e.notes.find((e=>e.id===t.value.noteId));n&&(n.likes=t.value.likes)}}if(t.type===Q.ActionType.NoteUpdateRoom){const e=n.roomData&&n.roomData[t.value.roomId];e.hasNoteWall&&(e.notes=t.value.notes)}if(t.type===Q.ActionType.SpaceIsClosed&&(n.isClosed=!0),t.type===Q.ActionType.SpaceOpenedOrClosed&&(n.userMap[n.userId].isMod?(n.isClosed=t.value,St(n,Je("The space is now "+(t.value?"closed":"open")))):window.location.reload()),t.type===Q.ActionType.CommandMessage){const e=Je(t.value);St(n,e)}return n};async function Mt(e,t){e.whispers.push(t),async function(e){await I.setItem(pe,e)}(e.whispers)}async function St(e,t){e.messages.push(t),e.messages=e.messages.slice(-500),le(e.messages)}Q=Z("3Wbh2"),Q=Z("3Wbh2");const Nt=e=>{const{otherUser:n}=e;return e.senderIsSelf?t.createElement("div",{className:"whisper-message"},t.createElement("em",null,"You:"," ",e.message)):t.createElement("div",{className:"whisper-message"},t.createElement("em",null,t.createElement("span",{"data-tip":n&&n.pronouns},n.username),":"," ",e.message,t.createElement(A,null)))};function At(e){const{user:n,whispers:a}=e,o=i(An);t.useEffect((()=>{const e=document.querySelector("#chat .whisper-message:last-of-type");e&&(e.parentNode.scrollTop=e.offsetTop-e.parentNode.offsetTop)}));const r=(a||[]).filter(((e,t)=>e.userId===n.id)),l=n.realName?t.createElement("div",{id:"profile-realName"},n.realName):null,s=n.twitterHandle?t.createElement("div",{id:"profile-twitter"},t.createElement("strong",null,"Twitter"),":"," ",t.createElement("a",{href:`https://twitter.com/${n.twitterHandle}`,target:"_blank",rel:"noreferrer"},"@",n.twitterHandle)):null,c=n.url?t.createElement("div",{id:"profile-url"},t.createElement("strong",null,"Web Site"),":"," ",n.url):null,d=n.description?t.createElement("div",{id:"profile-description"},n.description):null,m=n.askMeAbout?t.createElement("div",{id:"profile-askme"},t.createElement("strong",null,"Ask me about:")," ",n.askMeAbout):null;return t.createElement(W,{componentDecorator:(e,n,a)=>t.createElement("a",{href:e,key:a,target:"_blank",rel:"noopener noreferrer"},n)},t.createElement("div",{id:"profile"},t.createElement("div",{className:"fixed"},t.createElement("div",{id:"header"},t.createElement("h2",{className:n.isMod?"mod":""},t.createElement(Oe,{userId:n.id,id:`profile-nameview-${n.id}`})),t.createElement("button",{className:"close-profile",onClick:()=>o(Q.HideProfileAction())},"X")),t.createElement("p",null,l,t.createElement("div",{id:"profile-pronouns"},n.pronouns),d),n.item?t.createElement("p",null,n.username," is currently holding ",n.item):null,t.createElement("p",null,s,c,m),t.createElement("div",{id:"chat-container"},t.createElement("div",{id:"chat-header"},"Whisper Chat"),t.createElement("div",{id:"chat"},r.length>0?r.map(((e,a)=>{const o=`whisper-message-${a}`;return t.createElement(Nt,{...e,key:o,id:o,otherUser:n})})):t.createElement("em",null,`This is the beginning of your whisper chat with ${n.username}`)),t.createElement(Et,{sendMessage:e=>o(Q.SendMessageAction(`/whisper ${n.username} ${e}`))})))))}var Tt=Z("7zAPm");Q=Z("3Wbh2"),ee=Z("1qZWk");function Dt(e){const n=i(An),{localStreamView:a,setMicEnabled:o,setCameraEnabled:r,cameraEnabled:l,micEnabled:s}=xe();return a?t.createElement("div",{className:"my-video"},"You",l?a:t.createElement(f,{size:90,style:{textAlign:"center"},className:"placeholder-avatar"}),e.hideUI?"":t.createElement("div",null,t.createElement("button",{id:"send-video",onClick:e=>{r(!l)},className:"link-styled-button video-button "+(l?"enabled":"disabled"),"aria-label":"Toggle Video"},l?t.createElement(y,null):t.createElement(v,null)),t.createElement("button",{id:"send-audio",onClick:e=>{o(!s)},className:"link-styled-button video-button "+(s?"enabled":"disabled"),"aria-label":"Toggle Audio"},s?t.createElement(g,null):t.createElement(E,null)),t.createElement("button",{id:"show-media-selector",onClick:()=>{n(Q.ShowModalAction(ee.Modal.MediaSelector))},className:"link-styled-button video-button","aria-label":"Show Media Selector"},t.createElement(b,null)))):null}function xt({track:e}){const t=r();return o((()=>(t.current=e.attach(),t.current.setAttribute("data-cy-audio-track-name",e.name),document.body.appendChild(t.current),()=>e.detach().forEach((e=>e.remove())))),[e]),null}function Rt({track:e,isLocal:n,priority:a}){const i=r(null),s=function(e){const[t,n]=l(null==e?void 0:e.mediaStreamTrack);return o((()=>{if(n(null==e?void 0:e.mediaStreamTrack),e){const t=()=>{console.log("Set media stream track!"),n(e.mediaStreamTrack)};return e.on("started",t),()=>{e.off("started",t)}}}),[e]),t}(e),c=function(e){const[t,n]=l(null==e?void 0:e.dimensions);return o((()=>{if(n(null==e?void 0:e.dimensions),e){const t=e=>n({width:e.dimensions.width,height:e.dimensions.height});return e.on("dimensionsChanged",t),()=>{e.off("dimensionsChanged",t)}}}),[e]),t}(e),d=((null==c?void 0:c.height)??0)>((null==c?void 0:c.width)??0);console.log("Rendering videotrack",e),o((()=>{const t=i.current;return t.muted=!0,e.setPriority&&a&&e.setPriority(a),e.attach(t),()=>{e.detach(t),e.setPriority&&a&&e.setPriority(null)}}),[e,a,s]);const m="environment"!==(null==s?void 0:s.getSettings().facingMode),u={transform:n&&m?"rotateY(180deg)":"",objectFit:d||e.name.includes("screen")?"contain":"cover"};return t.createElement("video",{ref:i,style:u})}function Ot({publication:e,isLocalParticipant:n,videoOnly:a,videoPriority:r}){const i=function(e){const[t,n]=l(e&&e.track);return o((()=>{if(n(e&&e.track),e){const t=()=>n(null);return e.on("subscribed",n),e.on("unsubscribed",t),()=>{e.off("subscribed",n),e.off("unsubscribed",t)}}}),[e]),t}(e);if(!i)return null;switch(i.kind){case"video":return t.createElement(Rt,{track:i,priority:r,isLocal:i.name.includes("camera")&&n});case"audio":return a?null:t.createElement(xt,{track:i});default:return null}}function Wt({participant:e,displayVideo:n,displayAudio:a,videoOnly:r,videoPriority:i,isLocalParticipant:s}){const c=function(e){const[t,n]=l([]);return o((()=>{n(Array.from(e.tracks.values()));const t=e=>n((t=>[...t,e])),a=e=>n((t=>t.filter((t=>t!==e))));return e.on("trackPublished",t),e.on("trackUnpublished",a),()=>{e.off("trackPublished",t),e.off("trackUnpublished",a)}}),[e]),t}(e),d=c.filter((e=>"video"===e.kind)),m=c.filter((e=>"audio"===e.kind));let u=[];return n&&d.length>0&&u.push(d[0]),a&&(u=u.concat(m)),t.createElement(t.Fragment,null,u.map((e=>t.createElement(Ot,{key:e.kind,publication:e,isLocalParticipant:s,videoOnly:r,videoPriority:i}))))}function Lt(e){const[n,a]=t.useState(e.renderAsFace),[o,r]=t.useState(!0),l={border:e.isDominant?"solid":void 0};if(!e.renderAsFace)return t.createElement(Wt,{participant:e.participant,displayVideo:!1,displayAudio:o});const i=e.participant.videoTracks.size>0;if(!(e.participant.audioTracks.size+e.participant.videoTracks.size>0))return t.createElement("div",{key:`stream-wrapper-${e.participant.identity}`});let s;return n&&i||(s=t.createElement(f,{size:90,style:{textAlign:"center"},className:"placeholder-avatar"})),t.createElement("div",{key:`stream-wrapper-${e.participant.identity}`,className:"participant-track-square other-participant",style:l},t.createElement(Oe,{userId:e.participant.identity,id:`stream-nameview-${e.participant.identity}`,nowrap:!0}),t.createElement(Wt,{participant:e.participant,displayVideo:n,displayAudio:o}),i?t.createElement("button",{id:"play-video",onClick:e=>{a(!n)},className:"link-styled-button video-button "+(n?"enabled":"disabled"),"aria-label":`Toggle Video ${e.participant.identity}`},n?t.createElement(y,null):t.createElement(v,null)):null,s,t.createElement("button",{id:"play-audio",onClick:e=>{r(!o)},className:"link-styled-button video-button "+(o?"enabled":"disabled"),"aria-label":`Toggle Audio ${e.participant.identity}`},o?t.createElement(g,null):t.createElement(E,null)))}Q=Z("3Wbh2"),ee=Z("1qZWk");var Pt=e=>{const{currentMic:n,currentCamera:a,publishingCamera:o,publishingMic:r,inCall:l,publishMedia:i,publishAudio:s,unpublishMedia:c}=xe(),d=t.useContext(An),m=()=>{d(Q.StopVideoChatAction()),c()},u=()=>{d(Q.ShowModalAction(ee.Modal.MediaSelector))};let p;if(e.inMediaChat){let e="";o&&r?e="Turn off Webcam and Mic":o?e="Turn off Webcam":r&&(e="Turn off Mic"),p=t.createElement(t.Fragment,null,t.createElement("button",{onClick:m,id:"join-video-chat"},e),t.createElement("button",{key:"show-media-selector",id:"big-reconfigure-media-selector",onClick:u,className:"link-styled-button video-button","aria-label":"Show Media Selector"},t.createElement(b,null)))}else e.textOnlyMode?p=[t.createElement("button",{key:"text-only-mode",onClick:()=>{confirm("Re-enabling video and audio mode means that you will be able to see and hear video and audio from other participants. Your camera and microphone will default to off when you switch modes.\b\n\nSwitching modes will refresh your page - please be patient while it reloads.")&&d(Q.SetTextOnlyModeAction(!1,!0))},id:"toggle-text-only-mode"},"Re-Enable Audio/Video")]:e.canJoinVideoChat&&(p=[t.createElement("button",{key:"join-video",onClick:async()=>{e.canJoinVideoChat&&(n||a?i():d(Q.ShowModalAction(ee.Modal.MediaSelector)))},id:"join-video-chat"},l?"Turn on Webcam + Mic":t.createElement("s",null,"Turn on Webcam + Mic")),t.createElement("button",{key:"join-audio",onClick:async()=>{e.canJoinVideoChat&&(n?s():d(Q.ShowModalWithOptionsAction(ee.Modal.MediaSelector,{hideVideo:!0})))},id:"join-audio-chat"},l?"Turn on Mic":t.createElement("s",null,"Turn on Mic")),t.createElement("button",{key:"show-media-selector",id:"big-reconfigure-media-selector",onClick:u,className:"link-styled-button video-button","aria-label":"Show Media Selector"},t.createElement(b,null))]);var h;return e.totalCount>0&&(h=t.createElement("div",{className:"offscreen-count"},e.totalCount," ",1===e.totalCount?"person is":"people are"," in the call",o||r?", not including you":"",".")),t.createElement("div",{id:"media-chat-buttons"},h,p,t.createElement("div",null,t.createElement("button",{key:"audio-only-mode",onClick:()=>{let t;t=e.audioOnlyMode?"This will show you others&apos; webcam feeds. This will not affect whether or not you are sending your own webcam feed to others.":"This will hide all video feeds from other attendees. You will still be able to hear them, but you won't see them. This may improve performance if things are slow.\n\nNote that you will still broadcast your webcam feed to others if you enable it, and you will still be able to see the talks broadcast in the Theater.";confirm(t)&&d(Q.SetAudioOnlyModeAction(!e.audioOnlyMode))},id:"toggle-audio-only-mode",className:"link-styled-button"},e.audioOnlyMode?"Show":"Hide"," all video feeds"),t.createElement("button",{key:"text-only-mode",onClick:()=>{confirm("This will disable all audio/video aspects of this space other than the stream in the theater. You will no longer be able to see or hear other participants, but you can still interact via text chat.\n\nSwitching modes will refresh your page - please be patient while it reloads.")&&d(Q.SetTextOnlyModeAction(!0,!0))},id:"toggle-text-only-mode",className:"link-styled-button"},"Mute all audio and video")))};Q=Z("3Wbh2");function Ft(e){const{publishingCamera:n,callParticipants:a,inCall:o,joinCallFailed:r}=xe(),l=t.useContext(An),i=(e.visibleSpeakers||[]).map((e=>e[0]));if(console.log("Re-rendering media chat view?"),!o){if(r)return t.createElement("div",{id:"media-wrapper"},t.createElement("strong",null,"Could not connect to audio/video! Rooms are max 50 chatters - if you want to use audio/video, try moving to another room. Otherwise, it may be a network issue."));if(e.textOnlyMode){const e=()=>{confirm("Entering video/audio mode means that you will be able to see and hear video and audio from other participants. Your camera and microphone will default to off when you switch modes. Switching modes will refresh your page - please be patient while it reloads.")&&l(Q.SetTextOnlyModeAction(!1,!0))};return t.createElement("div",{id:"media-wrapper"},"There may be a voice/video call happening here that you can't see.",t.createElement("button",{className:"link-styled-button",onClick:e,style:{marginLeft:"1em"}},"Disable Text-Only Mode"),".")}return t.createElement("div",{id:"media-wrapper"},t.createElement("strong",null,"Attempting to connect to room."))}if(!a)return t.createElement("div",{id:"media-view"});let s;n&&(s=t.createElement(Dt,{speaking:!1}));const c=Array.from(a.values()).filter((e=>e.audioTracks.size+e.videoTracks.size>0)),d=c.filter((e=>i.includes(e.identity))),m=c.filter((e=>!i.includes(e.identity)));for(console.log("[NUM_FACES]: ",e.numberOfFaces);d.length<e.numberOfFaces&&m.length>0;)d.push(m.shift());const u=d.map((n=>t.createElement(Lt,{key:`participant-chat-view-${n.identity}`,participant:n,isDominant:e.currentSpeaker===n.identity,renderAsFace:!e.audioOnlyMode}))),p=m.map((t=>{e.currentSpeaker,t.identity})),h=e.currentUser.isMod,g={height:s||!e.audioOnlyMode&&u.length>0?void 0:"0px"};return t.createElement("div",{id:"media-wrapper"},t.createElement("div",{id:"media-view",style:g},s," ",u," ",p),t.createElement(Pt,{textOnlyMode:e.textOnlyMode,inMediaChat:e.inMediaChat,totalCount:u.length+p.length,canJoinVideoChat:h,offscreenCount:e.audioOnlyMode?u.length+p.length:p.length,audioOnlyMode:e.audioOnlyMode}))}X=Z("3Loy2"),Q=Z("3Wbh2"),Fe=Z("715TH");function Ht(e){if(e.includes(" ")){for(console.log("spaces detected "+e);e.includes(" ");)e=e.replace(" ","-");console.log("spaces crushed: "+e)}return e}function Ut(e){i(An);const{defaultHandle:n,user:a,prepopulateTwitterWithDefaultHandle:o}=e,[r,s]=l(a&&a.username||n||""),[c,d]=l(a&&a.realName||""),[m,u]=l(a&&a.pronouns||""),[p,h]=l(a&&a.description||""),[g,y]=l(a&&a.askMeAbout||""),[E,f]=l(a&&a.url||""),[v,b]=l(a&&a.twitterHandle||o&&n||"");return t.createElement("div",{id:"profile-edit",className:"container "+(e.isFTUE?"ftue":"")},t.createElement("div",{className:"form"},t.createElement("h1",null,(e.isFTUE?"Create":"Edit")+" Name Badge"),t.createElement("div",{style:{marginTop:"2em",marginBottom:"2em"}},"This is your virtual conference badge!",t.createElement("br",null),"Whatever you enter will be visible to other attendees.",t.createElement("br",null),"You can come back and change this at any time."),t.createElement("div",{className:"grid"},t.createElement("div",{className:"field"},t.createElement("label",{htmlFor:"username"},"Chat Handle"),t.createElement("em",null,"What shows up when you send messages"),t.createElement("input",{type:"text",id:"username",value:r,onChange:e=>{const t=Ht(e.currentTarget.value);0!==t.localeCompare(e.currentTarget.value)&&(e.currentTarget.value=t),s(e.currentTarget.value)}})),t.createElement("div",{className:"field"},t.createElement("label",{htmlFor:"realname"},"Name"),t.createElement("em",null,'Optional: Your "IRL" name.'),t.createElement("input",{type:"text",id:"real-name",value:c,onChange:e=>d(e.currentTarget.value)})),t.createElement("div",{className:"field"},t.createElement("label",{htmlFor:"description"},"Character Description"),t.createElement("em",null,"Optional: Describe your avatar!"),t.createElement("input",{type:"text",id:"description",value:p,onChange:e=>h(e.currentTarget.value)})),t.createElement("div",{className:"field"},t.createElement("label",{htmlFor:"pronouns"},"Pronouns"),t.createElement("em",null,'e.g. "she/her" or "he/they"'),t.createElement("input",{type:"text",id:"pronouns",value:m,onChange:e=>u(e.currentTarget.value)})),t.createElement("div",{className:"field"},t.createElement("label",{htmlFor:"website"},"Website"),t.createElement("em",null,"Optional: Your personal site!"),t.createElement("input",{type:"text",id:"website",value:E,onChange:e=>f(e.currentTarget.value)})),t.createElement("div",{className:"field"},t.createElement("label",{htmlFor:"twitter"},"Twitter Handle"),t.createElement("em",null,"Optional: Don't include the @"),t.createElement("input",{type:"text",id:"twitter",value:v,onChange:e=>b(e.currentTarget.value)})),t.createElement("div",{className:"field"},t.createElement("label",{htmlFor:"ask-me-about"},"Ask Me About"),t.createElement("em",null,"Optional: What are you excited to talk about?"),t.createElement("input",{type:"text",id:"ask-me-about",value:g,onChange:e=>y(e.currentTarget.value)}))),t.createElement("button",{onClick:t=>{s(Ht(r)),X.updateProfile({username:r,realName:c,pronouns:m,description:p,askMeAbout:g,twitterHandle:v,url:E,hostname:Fe.default.SERVER_HOSTNAME},e.isFTUE)},className:"submit"},"Save Changes")))}Q=Z("3Wbh2"),ee=Z("1qZWk"),X=Z("3Loy2");var $t=Z("1REsD");function Vt(e){const n=i(An),{userMap:a,myId:o}=i(Tn),r=a[o],l=r&&r.isMod,s=t.createElement(S,{onClick:()=>{confirm(`Are you sure you would like to ${e.spaceIsClosed?"open":"close"} the space for all non-mod users?`)&&X.openOrCloseSpace(!e.spaceIsClosed)}},e.spaceIsClosed?"Open":"Close"," the Space");return t.createElement("div",{id:"menu-button"},t.createElement(M,{id:"topMenu",holdToDisplay:0},t.createElement("strong",null,e.username)," ",t.createElement(b,null)),t.createElement(N,{id:"topMenu"},t.createElement(S,{onClick:()=>{X.fetchProfile(o)}},"View Profile"),t.createElement(S,{onClick:()=>{n(Q.ShowModalAction(ee.Modal.ProfileEdit))}},"Edit Profile"),t.createElement(S,{onClick:()=>{n(Q.ShowModalAction(ee.Modal.Settings))}},"Settings & Theme"),l?s:null,l?t.createElement(S,{onClick:()=>{n(Q.ShowModalAction(ee.Modal.ServerSettings))}},"Server Settings"):null,t.createElement(S,{onClick:()=>{confirm("Are you sure you want to log out?")&&X.disconnect(o).then((()=>{$t.signOut().then((()=>{window.location.reload()}))})).catch((e=>{console.log("error signing out",e),window.location.reload()}))}},"Log Out")))}Q=Z("3Wbh2"),ee=Z("1qZWk"),Q=Z("3Wbh2"),ee=Z("1qZWk"),X=Z("3Loy2"),Q=Z("3Wbh2");function Yt(e){const n=i(An),{roomData:a,currentRoomId:o}=e;let r,l;if(e.isMiniMap?(r=8,l=13):(r=10,l=21),t.useEffect((()=>{const t=document.getElementById(`${e.isMiniMap?"minimap-":""}clickable-room-${o}`);t&&t.scrollIntoView({block:"center",inline:"center"})}),e.isMiniMap?null:[]),!a)return t.createElement("div",null);let s=Bt;qt.forEach(((e,t)=>{let n="[0]";a[e]&&a[e].users&&a[e].users.length>0&&(n=`[${a[e].users.length}]`),n=n.padEnd(4,"."),s=s.replace(`(${t.toString().padStart(2,"0")})`,n)})),s=s.replace(/\[([0-9]*)\]/g,"($1)");const c=e=>{const t=e.target&&e.target.getAttribute&&e.target.getAttribute("data-room");t&&(X.moveToRoom(t),n(Q.HideModalAction()))},d=zt.map((n=>t.createElement("div",{style:{position:"absolute",left:n.x*r+"px",top:n.y*l+"px",width:n.width*r+"px",height:n.height*l+"px",cursor:"pointer"},key:n.roomId,onClick:c,"data-room":n.roomId,id:`${e.isMiniMap?"minimap-":""}clickable-room-${n.roomId}`})));return t.createElement("div",{className:"map",style:{position:"relative",margin:"15px"}},d,t.createElement("pre",{style:{letterSpacing:"2px",fontFamily:"IBM Plex Mono"}},t.createElement("code",null,s)))}const Bt="                        ┌────────────────────────────────────────────┐                                        \n┌────────────────┐      │............................................│   ┌──────────┐     ┌──────────┐        \n│................│      │.................Theater....................│   │.Warrior..│     │.. Mage...│        \n│.Robot Labs.....│      │...................(05).....................│   │...(12)...│     │...(13)...│        \n│...(00).........│      │............................................│   └─────#────┘     └─────#────┘        \n│................│      │............................................│         #                #             \n│................│      │............................................############################             \n└──────────#─────┘      │............................................│         #                #             \n┌──────────#─────┐      │............................................│   ┌─────#────┐     ┌─────#────┐        \n│............... │      │............................................│   │..Rogue...│     │.Tourist..│        \n│.Space.Hangar...│      │............................................│   │...(14)...│     │...(15)...│        \n│.Lounge.........│      │............................................│   └──────────┘     └──────────┘        \n│...(01).........│      │............................................│                                        \n│................│      │............................................│                                        \n│┌────────────┐..│      │............................................│                                        \n││.Vending....│..###    │............................................│                                        \n││.Machine....│..│ ##   └────────────────────#───────────────────────┘                                        \n││...(02).....│..│  ###                      #           ┌──────────────────────────────────────────────────┐ \n│└────────────┘..│     ###        ┌──────────#────────┐  │..................Unconferencing..................│ \n└────────────────┘       ###      │...................####..................Lobby ..(16)....................│ \n┌────────────┐         ┌────────────┐.................│  └──────────────#───────────────────#───────────────┘ \n│.Office Of..│         │Destinations│..Central Hall...│  ┌──────────┐   #    ┌──────────┐   #   ┌──────────┐  \n│.Steam......│         │..(06)......│.....(10)........│  │Cockatrice│   #    │...Naga...│   #   │..Tengu...│  \n│...(27).....│         └────────────┘.................│  │...(17)...##########...(18)...│########...(19)...│  \n└───────#────┘         ###        │...................│  └──────────┘   #    └──────────┘   #   └──────────┘  \n┌───────#────────┐   ###          │...................│  ┌──────────┐   #    ┌──────────┐   #   ┌──────────┐  \n│................│ ###            │...................│  │..Dragon..│   #    │.Skeleton.│   #   │...Yak....│  \n│.Adventurers....│##              │..┌────────────┐...│  │...(20)...##########...(21)...#########...(22)...│  \n│.Guild..........##               │..│.Swag Table.│...│  └──────────┘        └──────────┘       └──────────┘  \n│...(03).........│   ┌──────────┐ │..│...(11).....│...│ ┌──────────────────────────────────────────────┐      \n│................│   │...Paint..│ │..└────────────┘...│ │....................................┌───────┐.│      \n│................│   │...(07)...│ │...................###.................Bar ..(23).........│Railing│.│      \n│................│   └────#─────┘ │...................│ │....................................│..(25).│.│      \n└───────#────────┘   ┌────#─────┐ └──────────#────────┘ │..┌───────┐.....┌────────────┐......└───────┘.│      \n┌───────#────────┐   │...Dyes...│            #          │..│Stools │.....│....Stage...│................│      \n│................│  ##...(08)...│            #          │..│..(24).│.....│....(29)....│................│      \n│.Office of......│###└────#─────┘ ┌──────────#────────┐ │..└───────┘.....└────────────┘................│      \n│.Transmutation..##  ┌────#─────┐ │.....Library.......│ │.....................┌────────────┐...........│      \n│...(04).........│   │..SHOWER..│ │.......(28)........│ │.....................│Back...(26).│...........│      \n│................│   │...(09)...│ │...................│ │.....................└────────────┘...........│      \n└────────────────┘   └──────────┘ └───────────────────┘ └──────────────────────────────────────────────┘      \n",qt=["robots","sfHub","vendingMachine","exploreHub","transmute","theater","destinations","doctorPaint","dyes","shower","hall","swag","warrior","mage","rogue","tourist","unconference","cockatrice","naga","tengu","dragon","skeleton","yak","bar","stools","railing","back","steam","library","barStage"],zt=[{roomId:"robots",x:0,y:1,width:18,height:7},{roomId:"sfHub",x:0,y:8,width:18,height:12},{roomId:"vendingMachine",x:1,y:14,width:14,height:5},{roomId:"exploreHub",x:0,y:25,width:18,height:9},{roomId:"transmute",x:0,y:34,width:18,height:7},{roomId:"theater",x:24,y:0,width:46,height:17},{roomId:"destinations",x:23,y:20,width:14,height:4},{roomId:"doctorPaint",x:21,y:29,width:12,height:4},{roomId:"dyes",x:21,y:33,width:12,height:4},{roomId:"shower",x:21,y:37,width:12,height:4},{roomId:"hall",x:34,y:18,width:21,height:16},{roomId:"swag",x:37,y:27,width:14,height:4},{roomId:"warrior",x:73,y:1,width:12,height:4},{roomId:"mage",x:90,y:1,width:12,height:4},{roomId:"rogue",x:73,y:8,width:12,height:4},{roomId:"tourist",x:90,y:8,width:12,height:4},{roomId:"unconference",x:57,y:17,width:52,height:4},{roomId:"cockatrice",x:57,y:21,width:12,height:4},{roomId:"naga",x:77,y:21,width:12,height:4},{roomId:"tengu",x:96,y:21,width:12,height:4},{roomId:"dragon",x:57,y:25,width:12,height:4},{roomId:"skeleton",x:77,y:25,width:12,height:4},{roomId:"yak",x:96,y:25,width:12,height:4},{roomId:"bar",x:56,y:29,width:48,height:12},{roomId:"stools",x:59,y:33,width:9,height:4},{roomId:"railing",x:93,y:30,width:9,height:4},{roomId:"back",x:78,y:37,width:14,height:3},{roomId:"steam",x:0,y:20,width:14,height:5},{roomId:"library",x:34,y:36,width:21,height:5},{roomId:"barStage",x:73,y:33,width:14,height:4}];function _t(e){const n=i(An);return t.createElement("div",{id:"mini-map",onClickCapture:e=>{n(Q.ShowModalAction(ee.Modal.Map)),e.stopPropagation()},style:{cursor:"pointer"}},t.createElement(Yt,{roomData:e.roomData,currentRoomId:e.currentRoomId,isMiniMap:!0}))}function jt(e){const n=i(xn),a=i(An);return t.createElement("nav",{id:"side-menu",role:"navigation","aria-label":"List of rooms you can navigate to"},n?t.createElement("button",{onClick:()=>{a(Q.HideSideMenuAction())},id:"close-button",className:"close"},"x"):"",t.createElement(Vt,{username:e.username,spaceIsClosed:e.spaceIsClosed}),t.createElement("button",{id:"happening-now-button",onClick:()=>{a(Q.ShowModalAction(ee.Modal.HappeningNow))}},"Happening Now"),t.createElement("button",{id:"nav-map-button",onClick:()=>{a(Q.ShowModalAction(ee.Modal.Map))}},"Map"),t.createElement("ul",null,t.createElement(Gt,{title:"Schedule",modal:ee.Modal.Schedule}),t.createElement(Gt,{title:"Room List",modal:ee.Modal.RoomList}),t.createElement(Gt,{title:"Code of Conduct",modal:ee.Modal.CodeOfConduct}),t.createElement(Gt,{title:"Help",modal:ee.Modal.Help})),e.roomData&&e.currentRoomId?t.createElement(_t,{roomData:e.roomData,currentRoomId:e.currentRoomId}):null)}const Gt=e=>{const n=i(An);return t.createElement("li",null,t.createElement("button",{className:"nav-item",onClick:()=>{n(Q.ShowModalAction(e.modal))}},t.createElement("strong",null,e.title)))};ee=Z("1qZWk"),X=Z("3Loy2"),X=Z("3Loy2");function Jt(e){const{userMap:n,myId:a}=i(Tn),o=e.note,r=n[a].isMod||o.authorId===a,l=o.authorId!==a,s=o.likes&&o.likes.includes(a),c=o.likes?o.likes.length:0;let d;s&&(d=o.likes.map((e=>n[e].username)).join(", "));return t.createElement(W,{componentDecorator:(e,n,a)=>t.createElement("a",{href:e,key:a,target:"_blank",rel:"noopener noreferrer"},n)},t.createElement("div",{className:"note"},r?t.createElement("button",{onClick:()=>{confirm("Are you sure you would like to delete this?")&&X.deleteRoomNote(o.id)},className:"link-styled-button note-delete"},"X"):"",o.message," ",t.createElement("br",null),t.createElement("button",{className:"link-styled-button like-button "+(s||!l?"liked":"unliked"),onClick:()=>{l&&(s?X.unlikeRoomNote(o.id):X.likeRoomNote(o.id))},"data-tip":d},c,s?t.createElement(w,null):t.createElement(k,null),t.createElement(A,null)),"-",t.createElement(Oe,{userId:o.authorId,id:`noteAuthor-${o.id}`})," ",t.createElement("br",null)))}const Kt=["cockatrice","dragon","naga","skeleton","tengu","yak"];function Zt(e){return e.likes?e.likes.length:0}function Xt(e){const n=(e.notes||[]).sort(((e,t)=>{const n=e.likes?e.likes.length:0;return(t.likes?t.likes.length:0)-n})).map((e=>t.createElement(Jt,{key:e.id,note:e}))),a=e.noteWallData?e.noteWallData.noteWallDescription:"You are looking at a wall with space for people to place sticky notes.",o=e.noteWallData?e.noteWallData.addNoteLinkText:"add a note",r=e.user&&e.user.isMod?t.createElement("button",{onClick:()=>{confirm("Are you sure you want to delete all notes?")&&e.notes.map((e=>X.deleteRoomNote(e.id)))}},"Mod: Delete all notes"):"",l=e.user&&e.user.isMod?t.createElement("button",{onClick:()=>{if(confirm("This will assign the top 6 rooms to the unconferencing rooms, are you sure?")&&e.notes.length>0){const n=JSON.parse(JSON.stringify(e.serverSettings)),a=e.notes.sort(((e,t)=>Zt(e)<Zt(t)?1:-1)),o=[];for(var t=0;t<Math.min(a.length,Kt.length);t++)o.push({text:`Unconference: ${a[t].message} in the ${Kt[t]} room.`,roomId:Kt[t]});n.happeningNowEntries=o.concat(n.happeningNowEntries),X.updateServerSettings(n)}}},"Mod: Set as unconferencing topics"):"";return t.createElement("div",null,r,l,t.createElement("div",{className:"note-wall-description"},a,t.createElement("br",null),t.createElement("br",null),"If you'd like, you can ",t.createElement("button",{onClick:()=>{const t=e.noteWallData?e.noteWallData.addNotePrompt:"What do you type on the note wall?",n=prompt(t);X.addNoteToWall(n)},id:"addNote",className:"link-styled-button"},o),"."),n)}Q=Z("3Wbh2");const Qt=e=>{const n=i(An);o((()=>{function e(e){27===e.keyCode&&n(Q.HideModalAction())}return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}));const a=e=>{"modal-wrapper"!==e.target.id&&"close-button"!==e.target.id||n(Q.HideModalAction())};return c.createPortal(t.createElement("div",{id:"modal-wrapper",onClick:a,role:"dialog","aria-modal":!0},t.createElement("div",{id:"modal",className:e.fullScreen?"full-screen":null},t.createElement("button",{onClick:a,id:"close-button",className:"close"},"x"),e.children)),document.body)};Q=Z("3Wbh2"),Q=Z("3Wbh2");function en(e){const n=i(An),a=e=>{const t="true"===e.target.value;n(Q.SetKeepCameraWhenMovingAction(t))};return t.createElement("div",{className:"videoAudioSettingsContainer"},t.createElement("form",{className:"form",id:"video-audio-selection-form"},t.createElement("label",{htmlFor:"video-audio-selection-form",className:"form-header"},"Video/Audio Options:"),t.createElement("div",{className:"radio"},t.createElement("input",{type:"radio",id:"keep-camera-when-moving",value:"true",checked:!0===e.keepCameraWhenMoving,onChange:a}),"Keep video/audio status when moving rooms"),t.createElement("div",{className:"radio"},t.createElement("input",{type:"radio",id:"keep-camera-when-moving",value:"false",checked:!1===e.keepCameraWhenMoving,onChange:a}),"Always leave video/audio when moving rooms")))}function tn(e){const n=i(An),{useSimpleNames:a}=i(Dn),[r,l]=t.useState("default");o((()=>{(async()=>{l(await ce())})()}));const s=e=>{console.log(r,e.target.value),document.body.classList.replace(r,e.target.value),l(e.target.value),async function(e){await I.setItem(ye,e)}(e.target.value)},c=e=>{n(Q.SetUseSimpleNamesAction(e))},d=e=>{"captions-enabled"===e.target.value?n(Q.SetCaptionsEnabledAction(!0)):"captions-disabled"===e.target.value&&n(Q.SetCaptionsEnabledAction(!1))};return t.createElement("div",{className:"settingsContainer"},t.createElement("div",{className:"form",id:"themeSelectionForm"},t.createElement("label",{htmlFor:"themeSelectionForm",className:"form-header"},"Select Theme:"),t.createElement("div",{className:"radio"},t.createElement("input",{type:"radio",id:"default-theme",value:"default",checked:"default"===r,onChange:s}),t.createElement("label",{htmlFor:"default-theme"},"Default (Dark)")),t.createElement("div",{className:"radio"},t.createElement("input",{type:"radio",id:"solarized-dark",value:"solarized-dark",checked:"solarized-dark"===r,onChange:s}),t.createElement("label",{htmlFor:"solarized-dark"},"Solarized Dark")),t.createElement("div",{className:"radio"},t.createElement("input",{type:"radio",id:"solarized-light",value:"solarized-light",checked:"solarized-light"===r,onChange:s}),t.createElement("label",{htmlFor:"solarized-light"},"Solarized Light"))),t.createElement("div",{className:"form",id:"simpleNamesSelectionForm"},t.createElement("label",{htmlFor:"simpleNamesSelectionForm",className:"form-header"},"Username Display Mode:"),t.createElement("div",{className:"radio"},t.createElement("label",null,t.createElement("input",{type:"radio",name:"simpleNameSelection",id:"useDefaultName",checked:!a,onChange:()=>c(!1)}),"Use Default Names (shows colors, fonts, and polymorph potion emojis)")),t.createElement("div",{className:"radio"},t.createElement("label",null,t.createElement("input",{type:"radio",name:"simpleNameSelection",id:"useSimpleName",checked:a,onChange:()=>c(!0)}),"Use Simple Names (text only)"))),t.createElement("div",{className:"form",id:"captionsEnabled"},t.createElement("label",{htmlFor:"captionsEnabled",className:"form-header",style:{marginBottom:0}},"Enable Captions (Experimental):"),t.createElement("span",{style:{marginBottom:"1em"}},"This will automatically transcribe spoken audio as messages in the text chat."),t.createElement("div",{className:"radio"},t.createElement("input",{type:"radio",id:"captions-enabled",value:"captions-enabled",checked:e.captionsEnabled,onChange:d}),t.createElement("label",{htmlFor:"captions-enabled"},"Enabled")),t.createElement("div",{className:"radio"},t.createElement("input",{type:"radio",id:"captions-disabled",value:"captions-disabled",checked:!e.captionsEnabled,onChange:d}),t.createElement("label",{htmlFor:"captions-disabled"},"Disabled"))),t.createElement(en,{keepCameraWhenMoving:e.keepCameraWhenMoving}))}Q=Z("3Wbh2");function nn(e){const n=i(An),{prepareMediaDevices:a,cameras:r,mics:l,currentMic:s,setCurrentMic:c,currentCamera:d,setCurrentCamera:m,publishMedia:u,publishAudio:p,publishingCamera:h,publishingMic:g,unpublishMedia:y}=xe();o((()=>((async()=>{s||(await a(),console.log("Prepared for media chat"))})(),()=>{h&&g||y()})),[]);const E=e=>t.createElement("option",{value:e.id,key:e.id},e.name);let f;e.hideVideo||(f=t.createElement(t.Fragment,null,t.createElement("label",{htmlFor:"#video-select"},"Webcam"),t.createElement("select",{name:"Video",id:"video-select",onChange:e=>{m(e.target.value)},defaultValue:d&&d.id},(r||[]).map(E)),t.createElement("br",null)));return t.createElement("div",{id:"media-selector",style:{display:"flex","flex-direction":"column"}},t.createElement("div",null,e.hideVideo?"":t.createElement(Dt,{speaking:e.userIsSpeaking,hideUI:!0}),t.createElement("div",{className:"selects"},f,t.createElement("label",{htmlFor:"#audio-select"},"Audio"),t.createElement("select",{name:"Audio",id:"audio-select",onChange:e=>{c(e.target.value)},defaultValue:s&&s.id},(l||[]).map(E)))),t.createElement("div",null,t.createElement(en,{keepCameraWhenMoving:e.keepCameraWhenMoving})),t.createElement("button",{id:"join",onClick:()=>{n(Q.HideModalAction())}},"Use These Devices"))}function an(){return t.createElement("div",{id:"code-of-conduct"},t.createElement("p",null,"Our goal is to have a fun and welcoming celebration of roguelike games, so we have a formalized code of conduct that sets these expectations."),t.createElement("p",null,t.createElement("a",{href:"https://roguelike.club/code.html",target:"_blank",rel:"noreferrer"},"Read our Code of Conduct.")),t.createElement("p",null,"If you're being harassed, notice someone being harassed, or have any other concerns related to the code of conduct, you have a few options:"),t.createElement("ul",null,t.createElement("li",null,"Type ",t.createElement("code",null,"/mod")," into the chat box, followed by a message, to contact all moderators."),t.createElement("li",null,"Email ",t.createElement("a",{href:"mailto:contact@roguelike.club"},"contact@roguelike.club"),"."),t.createElement("li",null,"If you have a report or concern related to an organizer, please contact a different member of the ",t.createElement("a",{href:"https://roguelike.club/who.html",target:"_blank",rel:"noreferrer"},"organizing team")," outside of this tool (via email, Twitter DM, Discord, or some other service).")))}function on(e,t,n,a,o){return 1===t?{time:(r=e,new Date(`2021-10-16T${r}:00.000-07:00`)),text:n,roomIds:a,breakoutRoomId:o}:2===t?{time:(e=>new Date(`2021-10-17T${e}:00.000-07:00`))(e),text:n,roomIds:a,breakoutRoomId:o}:void console.error("Your static data is messed up, somehow.");var r}const rn=[on("09:00",2,"Doors Open"),on("09:15",2,"Kickoff",["theater"]),on("09:30",2,"Michael Langford: For the Squishies ⚡ Making Roguelikes Accessible to (Younger) Children and their Parents",["theater"],"warrior"),on("09:45",2,"Younès Rabii: Pokemon Glitch - Story of A Roguelike With No Author",["theater"],"tourist"),on("10:00",2,"Sraëka-Lillian: Procedural Phonology: Generating Name Generators",["theater"],"rogue"),on("10:15",1,"Social Time"),on("10:30",2,"Unconferencing",["unconference"]),on("11:30",2,"Alice Lai: All Together Now: Creating Multiplicative Power in Hades",["theater"],"warrior"),on("12:00",2,"Brian Cronin: Off The Rails - Lessons Learned from Monster Train Development",["theater"],"rogue"),on("12:30",2,"Social Time"),on("13:30",2,"Chris McCormick: Building Juicy Minimal Roguelikes in the Browser",["theater"],"mage"),on("14:00",2,"Rich Wilson: Roguelikes, Immersive Sims, and the Church of the Simulation",["theater"],"rogue"),on("14:30",2,"Xalavier Nelson Jr.: Building an Economic Flesh Simulation Will Make You Disassociate from Reality",["theater"],"tourist"),on("15:00",2,"Social Time"),on("15:30",2,"Kristen Yu: Video Game Quest Theory for Improved Procedural Content Generation",["theater"],"mage"),on("16:00",2,"Ally Brinken & Michelle Webb, En Rogue: Who’s the Boss (And How and Why)?",["theater"],"warrior"),on("16:30",2,"John Harris: The Lost Roguelikes",["theater"],"rogue"),on("17:00",2,"Social Time"),on("17:30",2,"Nick McConnell: Things I've Learnt from Maintaining Angband",["theater"],"rogue"),on("17:45",2,"Nathan Savant: One Quest To Rule Them All: Quest Design in Non-Games Media",["theater"],"warrior"),on("18:00",2,"Noah Swartz: The Tombs of Atuan: The Original Roguelike?",["theater"],"mage"),on("18:15",2,"Social Time"),on("19:00",2,"Doors Close")];function ln(){const e=new Intl.DateTimeFormat("en",{hour:"numeric",minute:"numeric"}),n=e.resolvedOptions().timeZone,a=rn.flatMap((n=>"Social Time"===n.text?[t.createElement("tr",{key:e.format(n.time)+"hr1"},t.createElement("th",{className:"break",colSpan:2},t.createElement("hr",null))),t.createElement("tr",{key:e.format(n.time)+"text"},t.createElement("td",{className:"time"},e.format(n.time)),t.createElement("td",{className:"segment"},"Social Time")),t.createElement("tr",{key:e.format(n.time)+"hr2"},t.createElement("th",{className:"break",colSpan:2},t.createElement("hr",null)))]:[t.createElement("tr",{key:e.format(n.time)},t.createElement("td",{className:"time"},e.format(n.time)),t.createElement("td",{className:"segment"},n.text))]));return t.createElement("div",{id:"Schedule"},t.createElement("h1",null,"Schedule"),t.createElement("p",null,"Times below should be in your local time zone. We believe your time zone is ",n,"."),t.createElement("table",null,t.createElement("tbody",null,a)))}function sn(){const e=wt.map((e=>t.createElement("tr",{key:e.type},t.createElement("td",null,e.invocations.join(", ")),t.createElement("td",null,e.description))));return t.createElement("div",null,t.createElement("h1",null,"Welcome!"),t.createElement("p",null,"Welcome to the Roguelike Celebration social space! This is an open-source chat app / virtual world built specifically for Roguelike Celebration."),t.createElement("p",null,"You can access this reference at any time by clicking the ",t.createElement("strong",null,"Help")," button in the left sidebar or by typing ",t.createElement("strong",null,"/help")," into the chat box."),t.createElement("p",null,"If you have questions, feedback, or need to report a code of conduct violation, you can contact us via the ",t.createElement("strong",null,"/mod")," command."),t.createElement("h2",null,"Command Reference"),t.createElement("p",null,"You can enter any of these commands by typing directly into the chat box."),t.createElement("table",null,e))}Q=Z("3Wbh2"),ee=Z("1qZWk");function cn(e){const n=i(An);return t.createElement("div",null,t.createElement("h1",null,"Map"),t.createElement("p",null,"Click on a room to move there!"),t.createElement("p",null,"If you find the map difficult to use, you can also view a ",t.createElement("button",{className:"link-styled-button",onClick:()=>{n(Q.ShowModalAction(ee.Modal.RoomList))}},"list of all rooms"),"."),t.createElement(Yt,{roomData:e.roomData,currentRoomId:e.currentRoomId}))}$t=Z("1REsD");const dn={callbacks:{signInSuccessWithAuthResult:function(e,t){const n=$t.currentUser();return n.shouldVerifyEmail&&$t.sendSignInLinkToEmail(n.email),!0}},signInOptions:[P.auth.EmailAuthProvider.PROVIDER_ID,P.auth.GoogleAuthProvider.PROVIDER_ID,P.auth.TwitterAuthProvider.PROVIDER_ID]};function mn(){return t.createElement("div",null,t.createElement("header",{role:"banner"},t.createElement("h1",null,"Welcome to Roguelike Celebration 2021!")),t.createElement("main",{role:"main"},t.createElement("p",null,"This is a social space for attendees of"," ",t.createElement("a",{href:"https://roguelike.club"},"Roguelike Celebration"),", a community-generated weekend of talks, games, and conversations about roguelikes and related topics, including procedural generation and game design. It's for fans, players, developers, scholars, and everyone else!"),t.createElement(F,{uiConfig:dn,firebaseAuth:P.auth()}),t.createElement("p",null,"If you log in via email, we will require you to verify that email address."),t.createElement("p",null,"No matter which service you log in with, we do not access any data other than what is needed to authenticate you. If it would make you more comfortable, feel free to sign up for and use a throwaway account on one of these services."),t.createElement("p",null,"After logging in, you will have the opportunity to pick whatever chat handle you would like before entering the space."),t.createElement("p",null,"By entering the space, you agree to our"," ",t.createElement("a",{href:"https://roguelike.club/code.html"},"Code of Conduct"),".")))}function un(e){return t.createElement("div",null,t.createElement("h1",null,"This isn't a normal chat app!"),t.createElement("p",null,"In the Roguelike Celebration conference space, you can only send/receive messages ",t.createElement("strong",null,"in the chat room you are currently in"),"."),t.createElement("p",null,"You can move from virtual room to virtual room to talk to different people."),t.createElement("p",null,"You may see or hear others on videochat, but they can't see or hear you unless you explicitly turn on your audio or video."),t.createElement("p",null,"Our hope is to facilitate smaller group conversations, to capture the feel of an in-person conference, and to give you a fun and playful space to explore with your fellow attendees."),t.createElement("p",null,"Happy wandering, and be wary of reading scrolls without identifying them first ;)"),t.createElement("p",null,"-The Roguelike Celebration team"))}function pn(){return t.createElement("div",{id:"go-home"},t.createElement("h1",null,"A magical force repels you from the entrance"),t.createElement("p",null,"Roguelike Celebration is currently closed! Check the ",t.createElement("a",{href:"https://roguelike.club/event2021.html",target:"_blank",rel:"noreferrer"},"schedule")," to see when our doors will be open again."),t.createElement("p",null,"We look forward to celebrating again with you soon :)"))}function hn(){return t.createElement("div",{id:"you-are-banned"},t.createElement("h1",null,"You are banned"),t.createElement("p",null,"You have been banned from the social space. If you believe you have been banned in error, please email ",t.createElement("b",null,"contact at roguelike.club"),"."))}X=Z("3Loy2");function gn(e){const n=e.rooms.map((e=>e.hidden?"":t.createElement(yn,{room:e,key:`room-sidebar-${e.id}`})));return t.createElement("div",null,t.createElement("h1",null,"List of Rooms"),t.createElement("ul",null,n))}const yn=e=>{const{room:n}=e,a=n.users?`(${n.users.length})`:"",o=n.videoUsers&&n.videoUsers.length>0?t.createElement(y,null):"";return t.createElement("li",{style:{listStyle:"none"}},t.createElement("button",{onClick:()=>{X.moveToRoom(n.id)},className:"link-styled-button"},t.createElement("strong",null,n.displayName)," ",a," ",o))};X=Z("3Loy2");function En(e){const[n,a]=l(JSON.stringify(e.serverSettings,null,2)),[o,r]=l(""),[i,s]=l(""),[c,d]=l(""),m=()=>{let e;try{e=function(e){try{return void 0===e.movementMessagesHideThreshold||void 0===e.movementMessagesHideRoomIds||e.happeningNowEntries&&!e.happeningNowEntries.every(te)?(console.log("Returning null in toServerSettings"),null):{movementMessagesHideThreshold:e.movementMessagesHideThreshold,movementMessagesHideRoomIds:e.movementMessagesHideRoomIds,happeningNowEntries:e.happeningNowEntries||[],spaceIsClosed:!!e.spaceIsClosed}}catch(e){return console.log("Error in toServerSettings",e),null}}(JSON.parse(n))}catch(e){return void alert("JSON parse error: "+e.toString())}e?X.updateServerSettings(e):alert("New settings were valid json but had invalid properties, please check for typos!")};return t.createElement("div",{className:"serverSettingsContainer"},t.createElement("button",{onClick:async()=>{confirm("Are you sure you'd like to reset room data?")&&await X.resetRoomData()}},"Reset Room Data"),t.createElement("h1",null,"Happening Now Controls"),t.createElement("h2",null,"Current Entries"),e.serverSettings.happeningNowEntries.map((n=>t.createElement("li",{key:n.text},JSON.stringify(n),t.createElement("button",{id:"delete-"+n.text,onClick:()=>(t=>{if(confirm("Are you sure you want to delete the happening now note?")){const n=JSON.parse(JSON.stringify(e.serverSettings));n.happeningNowEntries=e.serverSettings.happeningNowEntries.filter((e=>e.text!==t.text)),X.updateServerSettings(n)}})(n)},"Delete")))),t.createElement("div",{className:"form",id:"addHappeningNowForm"},t.createElement("div",{className:"field"},t.createElement("label",{htmlFor:"add-happening-now-text"},"Text"),t.createElement("input",{type:"text",id:"add-happening-now-text",value:o,onChange:e=>r(e.currentTarget.value)})),t.createElement("div",{className:"field"},t.createElement("label",{htmlFor:"add-happening-now-room-id"},"Room ID (blank if you want to link to an external site)"),t.createElement("input",{type:"text",id:"add-happening-now-room-id",value:i,onChange:e=>s(e.currentTarget.value)})),t.createElement("div",{className:"field"},t.createElement("label",{htmlFor:"add-happening-now-external-link"},"External Link (blank if you want to link to a room)"),t.createElement("input",{type:"text",id:"add-happening-now-external-link",value:c,onChange:e=>d(e.currentTarget.value)})),t.createElement("button",{id:"add-entry",onClick:()=>{if(0===o.length)return void alert("You need to have text!");if(i.length>0&&c.length>0)return void alert("You cannot have roomId and external link");if(i.length>0&&!e.roomData[i])return void alert("No such room as "+i);const t=JSON.parse(JSON.stringify(e.serverSettings));t.happeningNowEntries.push({text:o,roomId:i.length>0?i:void 0,externalLink:c.length>0?c:void 0}),X.updateServerSettings(t)},className:"submit"},"Add Entry")),t.createElement("h1",null,"Manual Controls (Finnicky)"),t.createElement("h3",{id:"old-settings-header"},"Old settings:"),t.createElement("pre",{id:"old-settings-pretty"},JSON.stringify(e.serverSettings,null,2)),t.createElement("h3",{id:"new-settings-header"},"New settings:"),t.createElement("div",{className:"form",id:"serverSettingsForm"},t.createElement("textarea",{id:"new-settings-textarea",defaultValue:n,cols:50,rows:30,onChange:e=>a(e.currentTarget.value)}),t.createElement("button",{onClick:e=>{m()},className:"submit"},"Save Changes")))}function fn(){return t.createElement("div",{id:"client-deployed"},t.createElement("h1",null,"New Version Available!"),t.createElement("p",null,"We just updated the social space with new features and bugfixes!"),t.createElement("p",null,"Please reload this page whenever is convenient so you can be running the latest code."),t.createElement("button",{onClick:()=>window.location.reload()},"Reload"))}Q=Z("3Wbh2"),X=Z("3Loy2");const vn=[...rn].reverse();function bn(e){const n=i(An),a=new Date,o=vn.findIndex((e=>e.time<a)),r=vn[o],l=t=>{e.roomData[t]?(X.moveToRoom(t),n(Q.HideModalAction())):console.error("Can't go to room "+t+" from link in happening now view, no such room!")};let s;if(r)if("Social Time"===r.text){var c=o+1;const n=[];for(;vn[c]&&vn[c].breakoutRoomId;){const a=vn[c],o=a.breakoutRoomId,r=`Discuss ${a.text} in `;n.push(t.createElement("li",{key:o},r,t.createElement("button",{id:`button-happening-now${o}`,onClick:()=>l(o),className:"link-styled-button"},e.roomData[o]?e.roomData[o].displayName:"unknown room"))),c++}n.push(t.createElement("li",{key:"option-chat"},"Chat!")),n.push(t.createElement("li",{key:"option-explore"},"Explore the space!")),n.push(t.createElement("li",{key:"option-hunt"},"Hunt for secrets!")),n.push(t.createElement("li",{key:"option-free"},"Just remember to beware the grues.")),s=t.createElement("div",{id:"currently-scheduled-div"},t.createElement("strong",null,"Social Time"),t.createElement("ul",null,n))}else s=t.createElement("div",{id:"currently-scheduled-div"},r.text,r.roomIds?(d=r.roomIds,t.createElement("ul",null,d.map((n=>t.createElement("li",{key:n},t.createElement("button",{id:`button-happening-now${n}`,onClick:()=>l(n),className:"link-styled-button"},e.roomData[n]?e.roomData[n].displayName:"unknown room")))))):"");else s=t.createElement("strong",null,"You're in early! Check the schedule for when the doors officially open.");var d;return t.createElement("div",{id:"happening-now"},t.createElement("h1",null,"Happening Now"),t.createElement("h2",null,"From The Schedule"),s,t.createElement("h2",null,"Other Live Activities"),t.createElement("ul",null,e.entries.map((e=>e.roomId?t.createElement("li",{key:e.text},t.createElement("button",{id:`button-${e.text}`,onClick:()=>l(e.roomId),className:"link-styled-button"},e.text)):e.externalLink?t.createElement("li",{key:e.text},t.createElement("a",{className:"nav-item",href:e.externalLink,target:"_blank",rel:"nofollow noopener noreferrer"},e.text)):t.createElement("li",{key:e.text},e.text)))))}Q=Z("3Wbh2"),$t=Z("1REsD");function wn(e){const n=e.dispatch;return t.createElement(H,{onChange:e=>{const t=$t.currentUser();e&&t&&!t.shouldVerifyEmail&&n(Q.AuthenticateAction(t.id,t.id,t.providerId,!1))}},t.createElement("div",null,t.createElement("header",{role:"banner"},t.createElement("h1",null,"Please verify your email!")),t.createElement("main",{role:"main"},t.createElement("p",null,"You're currently attempting to log in as ",t.createElement("strong",null,e.userEmail),", but your email is not yet verified. Please follow the link in your email to complete the registration process."),t.createElement("p",null,t.createElement("strong",null,"If you have verified your email and this page has not automatically logged you in, please refresh the page manually.")),t.createElement("button",{onClick:t=>{$t.sendSignInLinkToEmail(e.userEmail)}},"Resend Verification Email"),t.createElement("br",null),t.createElement("button",{onClick:()=>{$t.signOut().then((()=>{n(Q.AuthenticateAction(void 0,void 0,void 0,void 0))}))}},"Use a Different Provider or Email"))))}function kn(){const e=P.auth().currentUser;return e.emailVerified||P.auth().signInWithEmailLink(e.email,window.location.href).then((()=>{window.location.reload()})),e.emailVerified?t.createElement("div",null,t.createElement("header",{role:"banner"},t.createElement("h1",null,"Your email has been successfully verified!")),t.createElement("main",{role:"main"},t.createElement("p",null,"You may now close this window and go back to the main app."))):t.createElement("div",null,t.createElement("header",{role:"banner"},t.createElement("h1",null,"Attempting to verify email.")),t.createElement("main",{role:"main"},t.createElement("p",null,"Please wait while your email is verified.")))}function In(e){const n=e.riddles.map((function(e,n){return t.createElement("p",{className:"riddle",key:"riddle-"+n},e)})),a=e.riddles.length>1?"The engraved riddles read...":"The engraved riddle reads...";return t.createElement("div",{id:"riddle-modal",className:"riddle-div"},t.createElement("h1",null,a),n)}Q=Z("3Wbh2"),X=Z("3Loy2"),Q=Z("3Wbh2"),X=Z("3Loy2");let Cn,Mn;async function Sn(){await Cn.stopContinuousRecognitionAsync()}const Nn=e=>{const t=i(An),[a,r]=l(),[s,c]=l(),[d,m]=l(),[u,p]=l(!1),[h,g]=l(!0),[y,E]=l(!0),[f,v]=l([]),[b,w]=l([]),[k,I]=l(),[C,M]=l(),[S,N]=l(),[A,T]=l(),[D,x]=l(),[R,O]=l(),[W,L]=l(),[P,F]=l(),H=()=>{k&&async function(e,t){if(console.log("Starting recognition"),Cn&&await Cn.stopContinuousRecognitionAsync(),!Mn){const{cognitiveServicesKey:e,cognitiveServicesRegion:t}=await X.fetchCognitiveServicesKey();Mn=B.fromSubscription(e,t)}const n=q.fromMicrophoneInput(e);Cn=new _(Mn,n),Cn.recognizing=(e,t)=>{console.log("RECOGNIZING: ",t.result.text)},Cn.recognized=(e,n)=>{n.result.reason===z.RecognizedSpeech?(console.log(`RECOGNIZED: Text=${n.result.text}`),""!==n.result.text&&t(Q.SendCaptionAction(n.result.text))):n.result.reason===z.NoMatch&&console.log("NOMATCH: Speech could not be recognized.")},Cn.canceled=(e,t)=>{console.log(`CANCELED: Reason=${t.reason}`),t.reason===Y.Error&&(console.log(`"CANCELED: ErrorCode=${t.errorCode}`),console.log(`"CANCELED: ErrorDetails=${t.errorDetails}`),console.log("CANCELED: Did you update the subscription info?")),Cn.stopContinuousRecognitionAsync()},Cn.sessionStopped=(e,t)=>{console.log("\n    Session stopped event."),Cn.stopContinuousRecognitionAsync()},Cn.startContinuousRecognitionAsync()}(k.id,t)},j=()=>{Sn()},G=async()=>{d&&(t(Q.StartVideoChatAction()),T(!0),W&&(d.localParticipant.publishTrack(W),await W.restart(),H()))},J=()=>{d&&(N(!0),R&&(R.restart(),R.enable(!0),d.localParticipant.publishTrack(R),P||F(n(Rt,{track:R}))))},K=()=>{console.log("In unpublish",R),t(Q.StopVideoChatAction()),N(!1),T(!1),W&&(W.stop(),Sn(),d&&d.localParticipant.unpublishTrack(W)),R&&(R.stop(),R.detach(),R.disable(),R.mediaStreamTrack.stop(),d&&d.localParticipant.unpublishTrack(R))};async function Z(o,r){if(e.active)if(a){if(!d||d.name!==o){d&&d.name!==o&&d.disconnect();try{const e={name:o,tracks:[],maxAudioBitrate:16e3,bandwidthProfile:{video:{mode:"grid",maxTracks:10,renderDimensions:{high:{height:1080,width:1920},standard:{height:720,width:1280},low:{height:176,width:144}}}},preferredVideoCodecs:[{codec:"VP8",simulcast:!0}],dominantSpeaker:!0};r&&R&&e.tracks.push(R),r&&W&&e.tracks.push(W),m(void 0);const l=await V(a,e);p(!1),l.on("dominantSpeakerChanged",(e=>{t(e?Q.MediaReceivedSpeakingDataAction(e.identity):Q.MediaReceivedSpeakingDataAction(null))})),l.localParticipant.videoTracks.forEach((e=>{y?e.track.enable():e.track.disable()})),l.localParticipant.audioTracks.forEach((e=>{h?e.track.enable():e.track.disable()})),console.log("[TWILIO] In room?",l),console.log("[TWILIO] Attached participant count:",l.participants.size),F(n(Wt,{participant:l.localParticipant,displayVideo:y,displayAudio:h})),x(l.participants),l.on("trackPublished",((e,n)=>{t(Q.RefreshReactAction())})),l.on("trackUnpublished",((e,n)=>{t(Q.RefreshReactAction())})),l.on("participantConnected",(()=>{x(l.participants),t(Q.RefreshReactAction())})),l.on("participantDisconnected",(()=>{x(l.participants),t(Q.RefreshReactAction())})),window.addEventListener("beforeunload",(e=>{l.disconnect()})),m(l)}catch(e){console.log("[TWILIO] Could not connect to room",e),F(null),p(!0)}}}else c(o);else console.warn("joinCall was called while text-only mode was on")}return o((()=>{e.active&&(console.log("[TWILIO] In useeffect for camera"),C&&(console.log("[TWILIO] Has camera"),(async()=>{console.log("[TWILIO] Fetching local video track");const e={height:720,frameRate:24,width:1280};C&&(e.deviceId={exact:C.id});const t=await $(e);O(t),F(n(Rt,{track:t})),S&&J()})()))}),[C]),o((()=>{e.active&&k&&(async()=>{if(W)return W;const e={};k&&(e.audio={deviceId:k.id});const t=await U(e);L(t)})()}),[k]),o((()=>{e.active&&(h?H():j())}),[h]),o((()=>{e.active&&(console.log("[TWILIO] In token roomId useEffect"),a&&s&&!d&&(console.log("[TWILIO] Joining room"),Z(s,!0)))}),[a,s]),n(De.Provider,{value:{prepareForMediaChat:async function(){if(!a)return X.fetchTwilioToken().then((e=>{r(e)}))},prepareMediaDevices:async function(){const e=e=>(console.log(e),{id:e.deviceId,name:e.label});try{(await navigator.mediaDevices.getUserMedia({video:!0,audio:!0})).getTracks().forEach((e=>e.stop())),await navigator.mediaDevices.enumerateDevices().then((t=>{console.log("[TWILIO] Fetched devices");const n=t.filter((e=>"videoinput"===e.kind)).map(e),a=t.filter((e=>"audioinput"===e.kind)).map(e);v(n),w(a),console.log("[TWILIO] Setting current camera",n[0]),M(n[0]),I(a[0])}))}catch(e){console.log("[TWILIO] Error fetching media devices",e),alert("We couldn't fetch your audio and video devices. This usually means another application is using your primary webcam or mic. Close anything that might be accessing them and try again. If that fails, confirm you haven't denied webcam/mic permission to this website in your browser."),t(Q.HideModalAction())}},cameras:f,mics:b,currentMic:k,currentCamera:C,publishingCamera:S,publishingMic:A,setCurrentCamera:async e=>(console.log(`[TWILIO] Setting current camera from ${C.id} (${C.name}) to ${e}`),C&&C.id!==e&&(console.log("[TWILIO] Removing old camera",d),R.stop(),d&&(t(Q.StopVideoChatAction()),K())),M(f.find((t=>t.id===e))),R.restart(),null),setCurrentMic:e=>(k&&k.id!==e&&(W.stop(),d&&(t(Q.StopVideoChatAction()),K())),I(b.find((t=>t.id===e))),W.restart(),null),localStreamView:P,publishMedia:()=>{d&&(G(),J())},unpublishMedia:K,publishAudio:G,inCall:!!d,joinCallFailed:u,joinCall:Z,leaveCall:function(){console.log("[TWILIO] In leave call",R),d&&d.disconnect(),R&&R.stop(),W&&W.stop(),j()},callParticipants:D,micEnabled:h,setMicEnabled:e=>{g(e),d&&d.localParticipant.audioTracks.forEach((t=>{e?t.track.enable():t.track.disable()}))},cameraEnabled:y,setCameraEnabled:e=>{E(e),d&&d.localParticipant.videoTracks.forEach((t=>{e?t.track.enable():t.track.disable()}))}}},e.children)};$t=Z("1REsD");const An=a(null),Tn=a(null),Dn=a(null),xn=a(null),Rn=a(null);var On=()=>{const[e,n]=Tt.useReducerWithThunk(Ct,It);o((()=>{$t.onAuthenticationStateChange((async e=>{if(e)if(e.shouldVerifyEmail){const t=e.id,a=e.providerId;n(Q.AuthenticateAction(t,t,a,!0))}else{const e=$t.currentUser(),t=e.id,a=e.providerId,{registeredUsername:o,spaceIsClosed:r,isMod:l,isBanned:i}=await X.checkIsRegistered();if(!o){const o=e.email?t:e.displayName;return void n(Q.AuthenticateAction(t,o,a,!1))}if(n(Q.AuthenticateAction(t,o,a,!1)),i)return n(Q.PlayerBannedAction({id:t,username:o,isBanned:i})),void n(Q.IsRegisteredAction());if(r&&(n(Q.SpaceIsClosedAction()),!l))return void n(Q.IsRegisteredAction());const s=await async function(){try{const e=await I.getItem(ue),t=await I.getItem(me),n=await I.getItem(pe);if(e&&(new Date).getTime()-e.getTime()<36e5)return console.log(t,n),{messages:t,whispers:n}}catch(e){console.log("Storage error",e)}}();s&&n(Q.LoadMessageArchiveAction(s.messages,s.whispers));const c=await async function(){return await I.getItem(Ee)||!1}();n(Q.SetUseSimpleNamesAction(c));const d=await async function(){const e=await I.getItem(fe);return null!==e&&e}();n(Q.SetKeepCameraWhenMovingAction(d));const m=await async function(){const e=await I.getItem(ve);return null!=e&&e}();n(Q.SetTextOnlyModeAction(m,!1));const p=await async function(){const e=await I.getItem(be);return null!=e&&e}();n(Q.SetCaptionsEnabledAction(p)),n(Q.IsRegisteredAction()),X.connect(t,n),X.getServerSettings(n),window.addEventListener("resize",(()=>{}));const h=()=>{const e=document.getElementById("main");if(e){const t=Math.floor(e.clientWidth/180)-1;n(Q.SetNumberOfFacesAction(t))}else console.warn("Attempted to call onResize when 'main' element was null; will default to show no faces")};setTimeout(h,2e3),window.addEventListener("resize",u.throttle(h,100,{trailing:!0}))}else n(Q.AuthenticateAction(void 0,void 0,void 0,void 0))}))}),[]);const a=window.outerWidth<500,r=e.visibleProfile?t.createElement(At,{user:e.visibleProfile,whispers:e.whispers}):"";if($t.currentUser()&&$t.currentUser().isSignInWithEmailLink(window.location.href))return t.createElement(kn,null);if(!e.checkedAuthentication)return t.createElement("div",null);if(e.checkedAuthentication&&e.mustVerifyEmail)return t.createElement(wn,{userEmail:$t.currentUser().email,dispatch:n});if(e.checkedAuthentication&&!e.authenticated)return t.createElement(mn,null);if(!e.hasRegistered)return t.createElement(Ut,{isFTUE:!0,defaultHandle:e.userMap[e.userId].username,user:e.profileData,prepopulateTwitterWithDefaultHandle:"twitter"===e.authenticationProvider});if(e.isClosed&&!e.userMap[e.userId].isMod)return t.createElement(pn,null);if(e.isBanned)return t.createElement(hn,null);let l,i,s;e.roomData&&e.roomId&&e.roomData[e.roomId]&&e.roomData[e.roomId].mediaChat&&(l=t.createElement(Ft,{visibleSpeakers:e.visibleSpeakers,currentSpeaker:e.currentSpeaker,numberOfFaces:e.numberOfFaces,inMediaChat:e.inMediaChat,textOnlyMode:e.textOnlyMode,audioOnlyMode:e.audioOnlyMode,currentUser:e.userMap[e.userId]}));let c=!1;switch(e.activeModal){case ee.Modal.ProfileEdit:i=t.createElement(Ut,{isFTUE:!1,defaultHandle:e.userMap[e.userId].username,user:e.profileData});break;case ee.Modal.NoteWall:{const n=e.roomData[e.roomId];i=t.createElement(Xt,{notes:n.notes,noteWallData:n.noteWallData,user:e.profileData,serverSettings:e.serverSettings});break}case ee.Modal.Settings:i=t.createElement(tn,{keepCameraWhenMoving:e.keepCameraWhenMoving,captionsEnabled:e.captionsEnabled});break;case ee.Modal.MediaSelector:console.log("Opening media selector"),i=t.createElement(nn,{showJoinButton:!e.inMediaChat||e.activeModalOptions.showJoinButton,hideVideo:e.activeModalOptions.hideVideo,userIsSpeaking:!1,roomId:e.roomId,keepCameraWhenMoving:e.keepCameraWhenMoving});break;case ee.Modal.CodeOfConduct:i=t.createElement(an,null);break;case ee.Modal.Schedule:i=t.createElement(ln,null);break;case ee.Modal.Map:c=!0,i=t.createElement(cn,{roomData:e.roomData,currentRoomId:e.roomId});break;case ee.Modal.RoomList:i=t.createElement(gn,{rooms:Object.values(e.roomData)});break;case ee.Modal.Help:i=t.createElement(sn,null);break;case ee.Modal.Welcome:i=t.createElement(un,null);break;case ee.Modal.ServerSettings:i=t.createElement(En,{serverSettings:e.serverSettings,roomData:e.roomData});break;case ee.Modal.ClientDeployed:i=t.createElement(fn,null);break;case ee.Modal.HappeningNow:i=t.createElement(bn,{roomData:e.roomData,entries:e.serverSettings.happeningNowEntries});break;case ee.Modal.FeatureRainbowGate:i=t.createElement(ke,null);break;case ee.Modal.FeatureDullDoor:i=t.createElement(Ce,null);break;case ee.Modal.FeatureFullRoomIndex:i=t.createElement(Se,{rooms:Object.values(e.roomData)});break;case ee.Modal.Riddles:{const n=e.roomData[e.roomId];i=t.createElement(In,{riddles:n.riddles});break}}i&&(s=t.createElement(Qt,{fullScreen:c},i));const d=!a||e.mobileSideMenuIsVisible;return t.createElement(m.Provider,{value:{style:{verticalAlign:"middle"}}},t.createElement(An.Provider,{value:n},t.createElement(Nn,{active:!e.textOnlyMode},t.createElement(xn.Provider,{value:a},t.createElement(Dn.Provider,{value:{useSimpleNames:e.useSimpleNames}},t.createElement(Tn.Provider,{value:{userMap:e.userMap,myId:e.userId}},t.createElement(Rn.Provider,{value:e.roomData},t.createElement("div",{id:e.visibleProfile&&!a?"app-profile-open":"app"},d?t.createElement("span",null,t.createElement(jt,{roomData:e.roomData,currentRoomId:e.roomId,username:e.userMap[e.userId].username,spaceIsClosed:e.isClosed}),t.createElement("div",{id:"side-nav-placeholder"})):t.createElement("button",{id:"show-menu",onClick:()=>{n(Q.ShowSideMenuAction())}},t.createElement("span",{role:"img","aria-label":"menu"},"🍔")),s,t.createElement("div",{id:"main",role:"main"},e.roomData[e.roomId]?t.createElement(Ue,{room:e.roomData[e.roomId],userId:e.userId,roomData:e.roomData,inMediaChat:e.inMediaChat,keepCameraWhenMoving:e.keepCameraWhenMoving,textOnlyMode:e.textOnlyMode,mediaChatView:l,hasDismissedAModal:e.hasDismissedAModal}):null,t.createElement(yt,{messages:e.messages,autoscrollChat:e.autoscrollChat,serverSettings:e.serverSettings,captionsEnabled:e.captionsEnabled}),t.createElement(Et,{prepopulated:e.prepopulatedInput,sendMessage:e=>n(Q.SendMessageAction(e))})),r))))))))};window.addEventListener("DOMContentLoaded",(async()=>{d(n(On,null),document.getElementById("root")),document.body.classList.add(await ce())}));
//# sourceMappingURL=index.96b70499.js.map
